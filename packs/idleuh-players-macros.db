{"name":"Esoteric Check","type":"script","author":"mdv0NOLsITdkCYRq","img":"systems/pf2e/icons/features/classes/esoteric-lore.webp","scope":"global","command":"const targets = game.user.targets\n\nif (!actor || targets.size != 1) {\n    ui.notifications.warn('You must have an actor selected, and one actor targeted')\n    return\n}\n\nconst skillName = 'Esoteric'\nconst skillKey = 'esoteric'\nconst actionSlug = 'action:recall-knowledge'\nconst actionName = 'Recall Knowledge'\n\nconst modifiers = []\nconst DCbyLevel = [14, 15, 16, 18, 19, 20, 22, 23, 24, 26, 27, 28, 30, 31, 32, 34, 35, 36, 38, 39, 40, 42, 44, 46, 48, 50]\n\nconst [target] = targets\nconst targetLevel = target.actor.system.details.level.value\nconst DC = targetLevel < 0 ? 13 : DCbyLevel[targetLevel]\n\nconst options = actor.getRollOptions(['all', 'skill-check', skillName.toLowerCase()])\noptions.push(`action:${actionSlug}`)\noptions.push(`secret`)\n\nconst vulnerability = target.actor.system.traits.dv.reduce((prev, curr) => {\n    if (!prev || curr.value > prev.value) return curr\n    return prev\n}, null)\n\nconst link = `@UUID[Compendium.idleuh.effects.MqgbuaqGMJ92VRze]{Effect: Exploit Vulnerability${vulnerability ? ` ${vulnerability.value}` : ''}}`\n\ngame.pf2e.Check.roll(\n    new game.pf2e.CheckModifier(\n        `<span class=\"pf2-icon\">A</span> <b>${actionName}</b> - <p class=\"compact-text\">${skillName} Skill Check</p><p><strong>Success</strong> ${link}</p><p><strong>Failure</strong> @UUID[Compendium.idleuh.effects.MqgbuaqGMJ92VRze]{Effect: Exploit Vulnerability}</p><p><strong>Critical Failure</strong> @UUID[Compendium.pf2e.conditionitems.AJh5ex99aV6VTggg]{Flat-Footed}</p>`,\n        actor.system.skills[skillKey],\n        modifiers\n    ),\n    {\n        actor,\n        type: 'skill-check',\n        options,\n        dc: { value: DC },\n    },\n    event\n)","flags":{"exportSource":{"world":"module-test","system":"pf2e","coreVersion":"10.290","systemVersion":"4.3.4"},"core":{"sourceId":"Macro.SZnQo01wZEir8GhN"},"advanced-macros":{"runAsGM":false}},"_stats":{"systemId":"pf2e","systemVersion":"4.4.0","coreVersion":"10.290","createdTime":1668201852232,"modifiedTime":1668787716995,"lastModifiedBy":"eYRcJxNtWBHDBCJ8"},"folder":null,"sort":0,"ownership":{"default":0,"mdv0NOLsITdkCYRq":3},"_id":"6ZSrMfBeefM0dHDy"}
