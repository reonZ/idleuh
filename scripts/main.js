(()=>{var ze=Object.defineProperty;var fn=(e,t,r)=>t in e?ze(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;var n=(e,t)=>ze(e,"name",{value:t,configurable:!0});var ln=(e,t)=>{for(var r in t)ze(e,r,{get:t[r],enumerable:!0})};var Y=(e,t,r)=>(fn(e,typeof t!="symbol"?t+"":t,r),r),pn=(e,t,r)=>{if(!t.has(e))throw TypeError("Cannot "+r)};var H=(e,t,r)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,r)};var A=(e,t,r)=>(pn(e,t,"access private method"),r);function Pt(e,t){return e?t?`@UUID[${e}]{${t}}`:`@UUID[${e}]`:`<span style="background: #DDD; padding: 1px 4px; border: 1px solid var(--color-border-dark-tertiary);
border-radius: 2px; white-space: nowrap; word-break: break-all;">${t}</span>`}n(Pt,"chatUUID");function zt(e){return e.getFlag("core","sourceId")}n(zt,"getSourceId");function mn(e,t){let r=zt(e);return r?t.includes(r):!1}n(mn,"includesSourceId");function Fe(e){return Array.isArray(e)?t=>mn(t,e):t=>zt(t)===e}n(Fe,"getSourceIdCondition");var cs=(async()=>{}).constructor;function Le(e,t){if(typeof e!="object")return!1;let r=Reflect.getPrototypeOf(e);for(;r;){if(r.constructor.name===t)return!0;r=Reflect.getPrototypeOf(r)}return!1}n(Le,"isInstanceOf");function V(e,...t){return(Array.isArray(t[0])?t[0]:t).filter(o=>typeof o=="string").join(e)}n(V,"joinStr");function Ft(...e){return`modules/${b.id}/templates/${V("/",e)}.hbs`}n(Ft,"templatePath");function Lt(e,t=[]){let r=typeof t=="string"?[t]:t;return r.length?r.flatMap(o=>e.itemTypes[o]):e.items}n(Lt,"getItems");function Rt(e,t,r){return Lt(e,r).some(Fe(t))}n(Rt,"hasItemWithSourceId");function w(e,t,r){return Lt(e,r).find(Fe(t))}n(w,"getItemWithSourceId");function $t(...e){e.unshift(b.id);let t=typeof e.at(-1)=="object"?e.splice(-1)[0]:void 0;return game.i18n[t?"format":"localize"](V(".",e),t)}n($t,"localize");var $e=null,b={get id(){if(!$e)throw new Error("Module id needs to be registered.");return $e},error(e){throw new Error(`[${this.id}] ${e}`)}};function Ut(e){$e=e}n(Ut,"registerModule");function dn(e,t,r,o){let i=typeof t=="string"?t:"info",a=typeof t=="object"?t:typeof r=="object"?r:void 0,u=typeof t=="boolean"?t:typeof r=="boolean"?r:o??!1;ui.notifications.notify($t(e,a),i,{permanent:u})}n(dn,"notify");function Re(e,t,r){dn(e,"error",t,r)}n(Re,"error");function Ue(e){return game.settings.get(b.id,e)}n(Ue,"getSetting");function Bt(e){game.socket.on(`module.${b.id}`,e)}n(Bt,"socketOn");function pe(e){game.socket.emit(`module.${b.id}`,e)}n(pe,"socketEmit");var ae={};ln(ae,{_setPath:()=>Se,add:()=>yn,addProp:()=>xn,allPass:()=>bn,anyPass:()=>In,ceil:()=>On,chunk:()=>Sn,clamp:()=>An,clone:()=>_n,compact:()=>Cn,concat:()=>Dn,conditional:()=>qe,countBy:()=>We,createPipe:()=>Ln,debounce:()=>Rn,difference:()=>K,differenceWith:()=>Q,divide:()=>Bn,drop:()=>J,dropFirstBy:()=>Yn,dropLast:()=>Kn,dropLastWhile:()=>Jn,dropWhile:()=>Zn,equals:()=>Ve,evolve:()=>ro,filter:()=>F,find:()=>ye,findIndex:()=>he,findLast:()=>Qe,findLastIndex:()=>Je,first:()=>xe,firstBy:()=>io,flatMap:()=>ve,flatMapToObj:()=>Ze,flatten:()=>_,flattenDeep:()=>U,floor:()=>lo,forEach:()=>B,forEachObj:()=>et,fromPairs:()=>te,groupBy:()=>tt,hasAtLeast:()=>Xe,identity:()=>po,indexBy:()=>rt,intersection:()=>re,intersectionWith:()=>ne,invert:()=>xo,isArray:()=>nt,isBoolean:()=>bo,isDate:()=>wo,isDefined:()=>ot,isEmpty:()=>Io,isError:()=>ko,isFunction:()=>Oo,isNil:()=>So,isNonNull:()=>Eo,isNot:()=>Ao,isNumber:()=>To,isObject:()=>it,isObjectType:()=>Mo,isPlainObject:()=>_o,isPromise:()=>Co,isString:()=>at,isSymbol:()=>Do,isTruthy:()=>Ge,join:()=>No,keys:()=>st,last:()=>Po,length:()=>Fo,map:()=>G,mapKeys:()=>Ro,mapToObj:()=>ut,mapValues:()=>$o,maxBy:()=>ct,meanBy:()=>ft,merge:()=>Uo,mergeAll:()=>Go,mergeDeep:()=>qo,minBy:()=>lt,multiply:()=>Wo,noop:()=>Ho,nthBy:()=>Qo,objOf:()=>Xo,omit:()=>ti,omitBy:()=>ni,once:()=>ii,only:()=>ai,partition:()=>pt,pathOr:()=>ci,pick:()=>li,pickBy:()=>mi,pipe:()=>Ye,prop:()=>gi,purry:()=>s,randomString:()=>hi,range:()=>mt,rankBy:()=>xi,reduce:()=>dt,reject:()=>q,reverse:()=>bi,round:()=>Ii,sample:()=>ki,set:()=>Si,setPath:()=>Ai,shuffle:()=>Ti,sliceString:()=>_i,sort:()=>gt,sortBy:()=>yt,sortedIndex:()=>Pi,sortedIndexBy:()=>ht,sortedIndexWith:()=>xt,sortedLastIndex:()=>Fi,sortedLastIndexBy:()=>vt,splice:()=>Ri,splitAt:()=>bt,splitWhen:()=>Gi,stringToPath:()=>Yi,subtract:()=>Hi,sumBy:()=>wt,swapIndices:()=>Ki,swapProps:()=>Xi,take:()=>oe,takeFirstBy:()=>ra,takeLastWhile:()=>oa,takeWhile:()=>aa,tap:()=>ua,times:()=>fa,toPairs:()=>ee,type:()=>Be,uniq:()=>C,uniqBy:()=>ma,uniqWith:()=>ie,values:()=>ha,zip:()=>It,zipObj:()=>va,zipWith:()=>wa});var gn=function(e,t,r){if(r||arguments.length===2)for(var o=0,i=t.length,a;o<i;o++)(a||!(o in t))&&(a||(a=Array.prototype.slice.call(t,0,o)),a[o]=t[o]);return e.concat(a||Array.prototype.slice.call(t))};function s(e,t,r){var o=e.length-t.length,i=Array.from(t);if(o===0)return e.apply(void 0,i);if(o===1){var a=n(function(u){return e.apply(void 0,gn([u],i,!1))},"ret");return(r||e.lazy)&&(a.lazy=r||e.lazy,a.lazyArgs=t),a}throw new Error("Wrong number of arguments")}n(s,"purry");function yn(){return s(hn,arguments)}n(yn,"add");function hn(e,t){return e+t}n(hn,"_add");var me=function(){return me=Object.assign||function(e){for(var t,r=1,o=arguments.length;r<o;r++){t=arguments[r];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e},me.apply(this,arguments)};function xn(){return s(vn,arguments)}n(xn,"addProp");function vn(e,t,r){var o;return me(me({},e),(o={},o[t]=r,o))}n(vn,"_addProp");function bn(){return s(wn,arguments)}n(bn,"allPass");function wn(e,t){return t.every(function(r){return r(e)})}n(wn,"_allPass");function In(){return s(kn,arguments)}n(In,"anyPass");function kn(e,t){return t.some(function(r){return r(e)})}n(kn,"_anyPass");var Gt=15;function P(e){return function(t,r){if(r===0)return e(t);if(!Number.isInteger(r))throw new TypeError("precision must be an integer: ".concat(r));if(r>Gt||r<-Gt)throw new RangeError("precision must be between -15 and 15");if(Number.isNaN(t)||!Number.isFinite(t))return e(t);var o=Math.pow(10,r);return e(t*o)/o}}n(P,"_withPrecision");function On(){return s(P(Math.ceil),arguments)}n(On,"ceil");function Sn(){return s(En,arguments)}n(Sn,"chunk");function En(e,t){for(var r=Array.from({length:Math.ceil(e.length/t)}),o=0;o<r.length;o+=1)r[o]=e.slice(o*t,(o+1)*t);return r}n(En,"_chunk");function An(){return s(Tn,arguments)}n(An,"clamp");function Tn(e,t){return t.min!=null&&t.min>e?t.min:t.max!=null&&t.max<e?t.max:e}n(Tn,"_clamp");function Be(e){return e===null?"Null":e===void 0?"Undefined":Object.prototype.toString.call(e).slice(8,-1)}n(Be,"type");function Mn(e){return new RegExp(e.source,(e.global?"g":"")+(e.ignoreCase?"i":"")+(e.multiline?"m":"")+(e.sticky?"y":"")+(e.unicode?"u":""))}n(Mn,"_cloneRegExp");function qt(e,t,r,o){function i(a){for(var u=t.length,c=0;c<u;){if(e===t[c])return r[c];c+=1}t[c+1]=e,r[c+1]=a;for(var f in e)a[f]=o?qt(e[f],t,r,!0):e[f];return a}switch(n(i,"copy"),Be(e)){case"Object":return i({});case"Array":return i([]);case"Date":return new Date(e.valueOf());case"RegExp":return Mn(e);default:return e}}n(qt,"_clone");function _n(e){return e!=null&&typeof e.clone=="function"?e.clone():qt(e,[],[],!0)}n(_n,"clone");function Ge(e){return!!e}n(Ge,"isTruthy");function Cn(e){return e.filter(Ge)}n(Cn,"compact");function Dn(){return s(Nn,arguments)}n(Dn,"concat");function Nn(e,t){return e.concat(t)}n(Nn,"_concat");var Wt=function(e,t,r){if(r||arguments.length===2)for(var o=0,i=t.length,a;o<i;o++)(a||!(o in t))&&(a||(a=Array.prototype.slice.call(t,0,o)),a[o]=t[o]);return e.concat(a||Array.prototype.slice.call(t))};function Yt(e,t,r){var o=Array.from(r),i=o[0],a=o.slice(1);return e(i)?function(u){return t.apply(void 0,Wt([u],o,!1))}:t.apply(void 0,Wt([i],a,!1))}n(Yt,"purryOn");function qe(){return Yt(Pn,jn,arguments)}n(qe,"conditional");function jn(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];for(var o=0,i=t;o<i.length;o++){var a=i[o],u=a[0],c=a[1];if(u(e))return c(e)}throw new Error("conditional: data failed for all cases")}n(jn,"conditionalImplementation");function Pn(e){if(!Array.isArray(e))return!1;var t=e[0],r=e[1],o=e.slice(2);return typeof t=="function"&&t.length<=1&&typeof r=="function"&&r.length<=1&&o.length===0}n(Pn,"isCase");(function(e){e.defaultCase=function(t){return t===void 0&&(t=zn),[function(){return!0},t]}})(qe||(qe={}));var zn=n(function(){},"trivialDefaultCase");var Ht=n(function(e){return function(t,r){return t.reduce(function(o,i,a){var u=e?r(i,a,t):r(i);return o+(u?1:0)},0)}},"_countBy");function We(){return s(Ht(!1),arguments)}n(We,"countBy");(function(e){function t(){return s(Ht(!0),arguments)}n(t,"indexed"),e.indexed=t})(We||(We={}));function Ye(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];for(var o=e,i=t.map(function(v){var O=v,x=O.lazy,j=O.lazyArgs;if(x){var S=x.apply(void 0,j||[]);return S.indexed=x.indexed,S.single=x.single,S.index=0,S.items=[],S}return null}),a=0;a<t.length;){var u=t[a],c=i[a];if(!c){o=u(o),a++;continue}for(var f=[],l=a;l<t.length&&i[l];l++)if(f.push(i[l]),i[l].single)break;for(var m=[],p=0,y=o;p<y.length;p++){var d=y[p];if(Vt({item:d,acc:m,lazySeq:f}))break}var h=f[f.length-1];h.single?o=m[0]:o=m,a+=f.length}return o}n(Ye,"pipe");function Vt(e){var t=e.item,r=e.lazySeq,o=e.acc;if(r.length===0)return o.push(t),!1;for(var i={done:!1,hasNext:!1},a=!1,u=0;u<r.length;u++){var c=r[u],f=c.indexed,l=c.index,m=c.items;if(m.push(t),i=f?c(t,l,m):c(t),c.index++,i.hasNext)if(i.hasMany){for(var p=i.next,y=0,d=p;y<d.length;y++){var h=d[y],v=Vt({item:h,acc:o,lazySeq:r.slice(u+1)});if(v)return!0}return!1}else t=i.next;if(!i.hasNext)break;i.done&&(a=!0)}return i.hasNext&&o.push(t),!!a}n(Vt,"_processItem");var Fn=function(e,t,r){if(r||arguments.length===2)for(var o=0,i=t.length,a;o<i;o++)(a||!(o in t))&&(a||(a=Array.prototype.slice.call(t,0,o)),a[o]=t[o]);return e.concat(a||Array.prototype.slice.call(t))};function Ln(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return function(r){return Ye.apply(void 0,Fn([r],e,!1))}}n(Ln,"createPipe");function Rn(e,t){var r=t.waitMs,o=t.timing,i=o===void 0?"trailing":o,a=t.maxWaitMs;if(a!==void 0&&r!==void 0&&a<r)throw new Error("debounce: maxWaitMs (".concat(a,") cannot be less than waitMs (").concat(r,")"));var u,c,f,l,m=n(function(){if(f!==void 0){if(c!==void 0){var d=c;c=void 0,clearTimeout(d)}var h=f;f=void 0,l=e.apply(void 0,h)}},"handleInvoke"),p=n(function(){if(u!==void 0){var d=u;u=void 0,clearTimeout(d),f!==void 0&&m()}},"handleCoolDownEnd"),y=n(function(d){f=d,a!==void 0&&c===void 0&&(c=setTimeout(m,a))},"handleDebouncedCall");return{call:function(){for(var d,h=[],v=0;v<arguments.length;v++)h[v]=arguments[v];if(u===void 0)i==="trailing"?y(h):l=e.apply(void 0,h);else{i!=="leading"&&y(h);var O=u;u=void 0,clearTimeout(O)}return u=setTimeout(p,(d=r??a)!==null&&d!==void 0?d:0),l},cancel:function(){if(u!==void 0){var d=u;u=void 0,clearTimeout(d)}if(c!==void 0){var d=c;c=void 0,clearTimeout(d)}f=void 0},flush:function(){return p(),l},get isPending(){return u!==void 0},get cachedValue(){return l}}}n(Rn,"debounce");function g(e,t,r){for(var o=[],i=0;i<e.length;i++){var a=e[i],u=r?t(a,i,e):t(a);u.hasMany===!0?o.push.apply(o,u.next):u.hasNext&&o.push(u.next)}return o}n(g,"_reduceLazy");function K(){return s($n,arguments,K.lazy)}n(K,"difference");function $n(e,t){var r=K.lazy(t);return g(e,r)}n($n,"_difference");(function(e){function t(r){var o=new Set(r);return function(i){return o.has(i)?{done:!1,hasNext:!1}:{done:!1,hasNext:!0,next:i}}}n(t,"lazy"),e.lazy=t})(K||(K={}));function Q(){return s(Un,arguments,Q.lazy)}n(Q,"differenceWith");function Un(e,t,r){var o=Q.lazy(t,r);return g(e,o)}n(Un,"_differenceWith");(function(e){function t(r,o){return function(i){return r.every(function(a){return!o(i,a)})?{done:!1,hasNext:!0,next:i}:{done:!1,hasNext:!1}}}n(t,"lazy"),e.lazy=t})(Q||(Q={}));function Bn(){return s(Gn,arguments)}n(Bn,"divide");function Gn(e,t){return e/t}n(Gn,"_divide");function J(){return s(qn,arguments,J.lazy)}n(J,"drop");function qn(e,t){return g(e,J.lazy(t))}n(qn,"_drop");(function(e){function t(r){var o=r;return function(i){return o>0?(o--,{done:!1,hasNext:!1}):{done:!1,hasNext:!0,next:i}}}n(t,"lazy"),e.lazy=t})(J||(J={}));function X(e,t,r){var o;o=[e[r],e[t]],e[t]=o[0],e[r]=o[1]}n(X,"swapInPlace");function de(e,t){for(var r=Math.floor(e.length/2)-1;r>=0;r--)Kt(e,r,t)}n(de,"heapify");function ge(e,t,r){var o=e[0];if(!(t(r,o)>=0))return e[0]=r,Kt(e,0,t),o}n(ge,"heapMaybeInsert");function Kt(e,t,r){for(var o=t;o*2+1<e.length;){var i=o*2+1,a=r(e[o],e[i])<0?i:o,u=i+1;if(u<e.length&&r(e[a],e[u])<0&&(a=u),a===o)return;X(e,o,a),o=a}}n(Kt,"heapSiftDown");var z=function(e,t,r){if(r||arguments.length===2)for(var o=0,i=t.length,a;o<i;o++)(a||!(o in t))&&(a||(a=Array.prototype.slice.call(t,0,o)),a[o]=t[o]);return e.concat(a||Array.prototype.slice.call(t))},Jt={asc:function(e,t){return e>t},desc:function(e,t){return e<t}};function Z(e,t){var r=Array.isArray(t)?t:Array.from(t),o=r[0],i=r.slice(1);if(!Xt(o)){var a=He.apply(void 0,i);return e(o,a)}var u=He.apply(void 0,z([o],i,!1));return function(c){return e(c,u)}}n(Z,"purryOrderRules");function T(e,t){var r=Array.from(t),o=r[0],i=r[1],a=r.slice(2),u,c;return Xt(i)?(u=o,c=z([i],a,!0)):(u=i,c=z([o],a,!0)),Z(function(){for(var f=[],l=0;l<arguments.length;l++)f[l]=arguments[l];return e.apply(void 0,z(z([],f,!1),[u],!1))},c)}n(T,"purryOrderRulesWithArgument");function He(e,t){for(var r=[],o=2;o<arguments.length;o++)r[o-2]=arguments[o];var i=typeof e=="function"?e:e[0],a=typeof e=="function"?"asc":e[1],u=Jt[a],c=t===void 0?void 0:He.apply(void 0,z([t],r,!1));return function(f,l){var m,p=i(f),y=i(l);return u(p,y)?1:u(y,p)?-1:(m=c?.(f,l))!==null&&m!==void 0?m:0}}n(He,"orderRuleComparer");function Xt(e){if(Qt(e))return!0;if(typeof e!="object"||!Array.isArray(e))return!1;var t=e[0],r=e[1],o=e.slice(2);return Qt(t)&&r in Jt&&o.length===0}n(Xt,"isOrderRule");var Qt=n(function(e){return typeof e=="function"&&e.length===1},"isProjection");var Wn=function(e,t,r){if(r||arguments.length===2)for(var o=0,i=t.length,a;o<i;o++)(a||!(o in t))&&(a||(a=Array.prototype.slice.call(t,0,o)),a[o]=t[o]);return e.concat(a||Array.prototype.slice.call(t))};function Yn(){return T(Hn,arguments)}n(Yn,"dropFirstBy");function Hn(e,t,r){if(r>=e.length)return[];if(r<=0)return Wn([],e,!0);var o=e.slice(0,r);de(o,t);for(var i=[],a=e.slice(r),u=0,c=a;u<c.length;u++){var f=c[u],l=ge(o,t,f);i.push(l??f)}return i}n(Hn,"dropFirstByImplementation");var Vn=function(e,t,r){if(r||arguments.length===2)for(var o=0,i=t.length,a;o<i;o++)(a||!(o in t))&&(a||(a=Array.prototype.slice.call(t,0,o)),a[o]=t[o]);return e.concat(a||Array.prototype.slice.call(t))};function Kn(){return s(Qn,arguments)}n(Kn,"dropLast");function Qn(e,t){var r=Vn([],e,!0);return t>0&&r.splice(-t),r}n(Qn,"_dropLast");function Jn(){return s(Xn,arguments)}n(Jn,"dropLastWhile");function Xn(e,t){for(var r=e.length-1;r>=0;r--)if(!t(e[r]))return e.slice(0,r+1);return[]}n(Xn,"_dropLastWhile");function Zn(){return s(eo,arguments)}n(Zn,"dropWhile");function eo(e,t){for(var r=0;r<e.length;r++)if(!t(e[r]))return e.slice(r);return[]}n(eo,"_dropWhile");var Zt=Array.isArray,er=Object.keys;function Ve(){return s(to,arguments)}n(Ve,"equals");function to(e,t){if(e===t)return!0;if(e&&t&&typeof e=="object"&&typeof t=="object"){var r=Zt(e),o=Zt(t),i=void 0,a,u=void 0;if(r&&o){if(a=e.length,a!==t.length)return!1;for(i=a;i--!==0;)if(!Ve(e[i],t[i]))return!1;return!0}if(r!==o)return!1;var c=e instanceof Date,f=t instanceof Date;if(c!==f)return!1;if(c&&f)return e.getTime()===t.getTime();var l=e instanceof RegExp,m=t instanceof RegExp;if(l!==m)return!1;if(l&&m)return e.toString()===t.toString();var p=er(e);if(a=p.length,a!==er(t).length)return!1;for(i=a;i--!==0;)if(!Object.prototype.hasOwnProperty.call(t,p[i]))return!1;for(i=a;i--!==0;)if(u=p[i],!Ve(e[u],t[u]))return!1;return!0}return e!==e&&t!==t}n(to,"_equals");function ee(e){return Object.entries(e)}n(ee,"toPairs");(function(e){function t(r){return Object.entries(r)}n(t,"strict"),e.strict=t})(ee||(ee={}));var Ke=function(){return Ke=Object.assign||function(e){for(var t,r=1,o=arguments.length;r<o;r++){t=arguments[r];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e},Ke.apply(this,arguments)};function ro(){return s(tr,arguments)}n(ro,"evolve");function tr(e,t){return typeof e!="object"||e===null?e:ee.strict(t).reduce(function(r,o){var i=o[0],a=o[1];return i in r&&(r[i]=typeof a=="function"?a(r[i]):tr(r[i],a)),r},Ke({},e))}n(tr,"_evolve");var I=n(function(e){return e.indexed=!0,e},"_toLazyIndexed");function F(){return s(nr(!1),arguments,F.lazy)}n(F,"filter");var nr=n(function(e){return function(t,r){return g(t,e?F.lazyIndexed(r):F.lazy(r),e)}},"_filter"),rr=n(function(e){return function(t){return function(r,o,i){var a=e?t(r,o,i):t(r);return a?{done:!1,hasNext:!0,next:r}:{done:!1,hasNext:!1}}}},"_lazy");(function(e){function t(){return s(nr(!0),arguments,e.lazyIndexed)}n(t,"indexed"),e.indexed=t,e.lazy=rr(!1),e.lazyIndexed=I(rr(!0))})(F||(F={}));var L=n(function(e){return e.single=!0,e},"_toSingle");function ye(){return s(ir(!1),arguments,ye.lazy)}n(ye,"find");var ir=n(function(e){return function(t,r){return e?t.find(r):t.find(function(o){return r(o)})}},"_find"),or=n(function(e){return function(t){return function(r,o,i){var a=e?t(r,o,i):t(r);return{done:a,hasNext:a,next:r}}}},"_lazy");(function(e){function t(){return s(ir(!0),arguments,e.lazyIndexed)}n(t,"indexed"),e.indexed=t,e.lazy=L(or(!1)),e.lazyIndexed=L(I(or(!0)))})(ye||(ye={}));function he(){return s(sr(!1),arguments,he.lazy)}n(he,"findIndex");var sr=n(function(e){return function(t,r){return e?t.findIndex(r):t.findIndex(function(o){return r(o)})}},"_findIndex"),ar=n(function(e){return function(t){var r=0;return function(o,i,a){var u=e?t(o,i,a):t(o);return u?{done:!0,hasNext:!0,next:r}:(r++,{done:!1,hasNext:!1})}}},"_lazy");(function(e){function t(){return s(sr(!0),arguments,e.lazyIndexed)}n(t,"indexed"),e.indexed=t,e.lazy=L(ar(!1)),e.lazyIndexed=L(I(ar(!0)))})(he||(he={}));function Qe(){return s(ur(!1),arguments)}n(Qe,"findLast");var ur=n(function(e){return function(t,r){for(var o=t.length-1;o>=0;o--)if(e?r(t[o],o,t):r(t[o]))return t[o]}},"_findLast");(function(e){function t(){return s(ur(!0),arguments)}n(t,"indexed"),e.indexed=t})(Qe||(Qe={}));function Je(){return s(cr(!1),arguments)}n(Je,"findLastIndex");var cr=n(function(e){return function(t,r){for(var o=t.length-1;o>=0;o--)if(e?r(t[o],o,t):r(t[o]))return o;return-1}},"_findLastIndex");(function(e){function t(){return s(cr(!0),arguments)}n(t,"indexed"),e.indexed=t})(Je||(Je={}));function xe(){return s(no,arguments,xe.lazy)}n(xe,"first");function no(e){var t=e[0];return t}n(no,"_first");(function(e){function t(){return function(r){return{done:!0,hasNext:!0,next:r}}}n(t,"lazy"),e.lazy=t,function(r){r.single=!0}(t=e.lazy||(e.lazy={}))})(xe||(xe={}));function Xe(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return s(oo,e)}n(Xe,"hasAtLeast");var oo=n(function(e,t){return e.length>=t},"hasAtLeastImplementation");function io(){return Z(ao,arguments)}n(io,"firstBy");function ao(e,t){var r=e[0];if(!Xe(e,2))return r;for(var o=e.slice(1),i=0,a=o;i<a.length;i++){var u=a[i];t(u,r)<0&&(r=u)}return r}n(ao,"firstByImplementation");function _(){return s(so,arguments,_.lazy)}n(_,"flatten");function so(e){return g(e,_.lazy())}n(so,"_flatten");(function(e){function t(){return function(r){return Array.isArray(r)?{done:!1,hasNext:!0,hasMany:!0,next:r}:{done:!1,hasNext:!0,next:r}}}n(t,"lazy"),e.lazy=t})(_||(_={}));function ve(){return s(uo,arguments,ve.lazy)}n(ve,"flatMap");function uo(e,t){return _(e.map(function(r){return t(r)}))}n(uo,"_flatMap");(function(e){function t(r){return function(o){var i=r(o);return Array.isArray(i)?{done:!1,hasNext:!0,hasMany:!0,next:i}:{done:!1,hasNext:!0,next:i}}}n(t,"lazy"),e.lazy=t})(ve||(ve={}));function Ze(){return s(fr(!1),arguments)}n(Ze,"flatMapToObj");var fr=n(function(e){return function(t,r){return t.reduce(function(o,i,a){var u=e?r(i,a,t):r(i);return u.forEach(function(c){var f=c[0],l=c[1];o[f]=l}),o},{})}},"_flatMapToObj");(function(e){function t(){return s(fr(!0),arguments)}n(t,"indexed"),e.indexed=t})(Ze||(Ze={}));function U(){return s(co,arguments,U.lazy)}n(U,"flattenDeep");function co(e){return g(e,U.lazy())}n(co,"_flattenDeep");function fo(e){if(!Array.isArray(e))return e;var t=[];return e.forEach(function(r){Array.isArray(r)?t.push.apply(t,U(r)):t.push(r)}),t}n(fo,"_flattenDeepValue");(function(e){function t(){return function(r){var o=fo(r);return Array.isArray(o)?{done:!1,hasNext:!0,hasMany:!0,next:o}:{done:!1,hasNext:!0,next:o}}}n(t,"lazy"),e.lazy=t})(U||(U={}));function lo(){return s(P(Math.floor),arguments)}n(lo,"floor");function B(){return s(pr(!1),arguments,B.lazy)}n(B,"forEach");var pr=n(function(e){return function(t,r){return g(t,e?B.lazyIndexed(r):B.lazy(r),e)}},"_forEach"),lr=n(function(e){return function(t){return function(r,o,i){return e?t(r,o,i):t(r),{done:!1,hasNext:!0,next:r}}}},"_lazy");(function(e){function t(){return s(pr(!0),arguments,e.lazyIndexed)}n(t,"indexed"),e.indexed=t,e.lazy=lr(!1),e.lazyIndexed=I(lr(!0))})(B||(B={}));function et(){return s(mr(!1),arguments)}n(et,"forEachObj");var mr=n(function(e){return function(t,r){for(var o in t)if(Object.prototype.hasOwnProperty.call(t,o)){var i=t[o];e?r(i,o,t):r(i)}return t}},"_forEachObj");(function(e){function t(){return s(mr(!0),arguments)}n(t,"indexed"),e.indexed=t})(et||(et={}));function te(e){for(var t={},r=0,o=e;r<o.length;r++){var i=o[r],a=i[0],u=i[1];t[a]=u}return t}n(te,"fromPairs");(function(e){e.strict=e})(te||(te={}));function tt(){return s(dr(!1),arguments)}n(tt,"groupBy");var dr=n(function(e){return function(t,r){var o={};return t.forEach(function(i,a){var u=e?r(i,a,t):r(i);if(u!==void 0){var c=String(u);o[c]||(o[c]=[]),o[c].push(i)}}),o}},"_groupBy");(function(e){function t(){return s(dr(!0),arguments)}n(t,"indexed"),e.indexed=t,e.strict=e})(tt||(tt={}));function po(e){return e}n(po,"identity");function rt(){return s(gr(!1),arguments)}n(rt,"indexBy");var gr=n(function(e){return function(t,r){return t.reduce(function(o,i,a){var u=e?r(i,a,t):r(i),c=String(u);return o[c]=i,o},{})}},"_indexBy");function mo(){return s(go,arguments)}n(mo,"indexByStrict");var go=n(function(e,t){return e.reduce(function(r,o){var i=t(o);return r[i]=o,r},{})},"_indexByStrict");(function(e){function t(){return s(gr(!0),arguments)}n(t,"indexed"),e.indexed=t,e.strict=mo})(rt||(rt={}));function re(){return s(yo,arguments,re.lazy)}n(re,"intersection");function yo(e,t){var r=re.lazy(t);return g(e,r)}n(yo,"_intersection");(function(e){function t(r){return function(o){var i=new Set(r);return i.has(o)?{done:!1,hasNext:!0,next:o}:{done:!1,hasNext:!1}}}n(t,"lazy"),e.lazy=t})(re||(re={}));function ne(){return s(ho,arguments,ne.lazy)}n(ne,"intersectionWith");function ho(e,t,r){var o=ne.lazy(t,r);return g(e,o)}n(ho,"_intersectionWith");(function(e){function t(r,o){return function(i){return r.some(function(a){return o(i,a)})?{done:!1,hasNext:!0,next:i}:{done:!1,hasNext:!1}}}n(t,"lazy"),e.lazy=t})(ne||(ne={}));function xo(){return s(vo,arguments)}n(xo,"invert");function vo(e){var t={};for(var r in e)t[e[r]]=r;return t}n(vo,"_invert");function nt(e){return Array.isArray(e)}n(nt,"isArray");function bo(e){return typeof e=="boolean"}n(bo,"isBoolean");function wo(e){return e instanceof Date}n(wo,"isDate");function ot(e){return typeof e<"u"&&e!==null}n(ot,"isDefined");(function(e){function t(r){return r!==void 0}n(t,"strict"),e.strict=t})(ot||(ot={}));function it(e){return!!e&&!Array.isArray(e)&&typeof e=="object"}n(it,"isObject");function at(e){return typeof e=="string"}n(at,"isString");function Io(e){return e===void 0?!0:nt(e)||at(e)?e.length===0:it(e)?Object.keys(e).length===0:!1}n(Io,"isEmpty");function ko(e){return e instanceof Error}n(ko,"isError");function Oo(e){return typeof e=="function"}n(Oo,"isFunction");function So(e){return e==null}n(So,"isNil");function Eo(e){return e!==null}n(Eo,"isNonNull");function Ao(e){return function(t){return!e(t)}}n(Ao,"isNot");function To(e){return typeof e=="number"&&!isNaN(e)}n(To,"isNumber");var Mo=n(function(e){return typeof e=="object"&&e!==null},"isObjectType");function _o(e){if(typeof e!="object"||e===null)return!1;var t=Object.getPrototypeOf(e);return t===null||t===Object.prototype}n(_o,"isPlainObject");function Co(e){return e instanceof Promise}n(Co,"isPromise");function Do(e){return typeof e=="symbol"}n(Do,"isSymbol");function No(){return s(jo,arguments)}n(No,"join");var jo=n(function(e,t){return e.join(t)},"joinImplementation");function st(e){return Object.keys(e)}n(st,"keys");(function(e){e.strict=e})(st||(st={}));function Po(){return s(zo,arguments)}n(Po,"last");function zo(e){return e[e.length-1]}n(zo,"_last");function Fo(){return s(Lo,arguments)}n(Fo,"length");function Lo(e){return"length"in e?e.length:Array.from(e).length}n(Lo,"_length");function G(){return s(hr(!1),arguments,G.lazy)}n(G,"map");var hr=n(function(e){return function(t,r){return g(t,e?G.lazyIndexed(r):G.lazy(r),e)}},"_map"),yr=n(function(e){return function(t){return function(r,o,i){return{done:!1,hasNext:!0,next:e?t(r,o,i):t(r)}}}},"_lazy");(function(e){function t(){return s(hr(!0),arguments,e.lazyIndexed)}n(t,"indexed"),e.indexed=t,e.lazy=yr(!1),e.lazyIndexed=I(yr(!0)),e.strict=e})(G||(G={}));function Ro(e,t){return arguments.length===1?function(r){return xr(r,e)}:xr(e,t)}n(Ro,"mapKeys");function xr(e,t){return Object.keys(e).reduce(function(r,o){return r[t(o,e[o])]=e[o],r},{})}n(xr,"_mapKeys");function ut(){return s(vr(!1),arguments)}n(ut,"mapToObj");var vr=n(function(e){return function(t,r){return t.reduce(function(o,i,a){var u=e?r(i,a,t):r(i),c=u[0],f=u[1];return o[c]=f,o},{})}},"_mapToObj");(function(e){function t(){return s(vr(!0),arguments)}n(t,"indexed"),e.indexed=t})(ut||(ut={}));function $o(e,t){return arguments.length===1?function(r){return br(r,e)}:br(e,t)}n($o,"mapValues");function br(e,t){return Object.keys(e).reduce(function(r,o){return r[o]=t(e[o],o),r},{})}n(br,"_mapValues");var wr=n(function(e){return function(t,r){var o=void 0,i=void 0;return t.forEach(function(a,u){var c=e?r(a,u,t):r(a);(i===void 0||c>i)&&(o=a,i=c)}),o}},"_maxBy");function ct(){return s(wr(!1),arguments)}n(ct,"maxBy");(function(e){function t(){return s(wr(!0),arguments)}n(t,"indexed"),e.indexed=t})(ct||(ct={}));var Ir=n(function(e){return function(t,r){if(t.length===0)return NaN;var o=0;return t.forEach(function(i,a){o+=e?r(i,a,t):r(i)}),o/t.length}},"_meanBy");function ft(){return s(Ir(!1),arguments)}n(ft,"meanBy");(function(e){function t(){return s(Ir(!0),arguments)}n(t,"indexed"),e.indexed=t})(ft||(ft={}));function Uo(){return s(Bo,arguments)}n(Uo,"merge");function Bo(e,t){return Object.assign({},e,t)}n(Bo,"_merge");var be=function(){return be=Object.assign||function(e){for(var t,r=1,o=arguments.length;r<o;r++){t=arguments[r];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e},be.apply(this,arguments)};function Go(e){return e.reduce(function(t,r){return be(be({},t),r)},{})}n(Go,"mergeAll");var we=function(){return we=Object.assign||function(e){for(var t,r=1,o=arguments.length;r<o;r++){t=arguments[r];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e},we.apply(this,arguments)};function qo(){return s(Or,arguments)}n(qo,"mergeDeep");function Or(e,t){var r=we(we({},e),t);for(var o in t)if(o in e){var i=e[o];if(kr(i)){var a=t[o];kr(a)&&(r[o]=Or(i,a))}}return r}n(Or,"mergeDeepImplementation");function kr(e){return typeof e=="object"&&e!==null&&Object.getPrototypeOf(e)===Object.prototype}n(kr,"isRecord");var Sr=n(function(e){return function(t,r){var o=void 0,i=void 0;return t.forEach(function(a,u){var c=e?r(a,u,t):r(a);(i===void 0||c<i)&&(o=a,i=c)}),o}},"_minBy");function lt(){return s(Sr(!1),arguments)}n(lt,"minBy");(function(e){function t(){return s(Sr(!0),arguments)}n(t,"indexed"),e.indexed=t})(lt||(lt={}));function Wo(){return s(Yo,arguments)}n(Wo,"multiply");function Yo(e,t){return e*t}n(Yo,"_multiply");var Ho=n(function(){},"noop");var Vo=function(e,t,r){if(r||arguments.length===2)for(var o=0,i=t.length,a;o<i;o++)(a||!(o in t))&&(a||(a=Array.prototype.slice.call(t,0,o)),a[o]=t[o]);return e.concat(a||Array.prototype.slice.call(t))},Er=n(function(e,t,r){return t<0||t>=e.length?void 0:Ar(Vo([],e,!0),0,e.length-1,t,r)},"quickSelect");function Ar(e,t,r,o,i){if(t===r)return e[t];var a=Ko(e,t,r,i);return o===a?e[o]:Ar(e,o<a?t:a+1,o<a?a-1:r,o,i)}n(Ar,"quickSelectImplementation");function Ko(e,t,r,o){for(var i=e[r],a=t,u=t;u<r;u++)o(e[u],i)<0&&(X(e,a,u),a++);return X(e,a,r),a}n(Ko,"partition");function Qo(){return T(Jo,arguments)}n(Qo,"nthBy");var Jo=n(function(e,t,r){return Er(e,r>=0?r:e.length+r,t)},"nthByImplementation");function Xo(){return s(Zo,arguments)}n(Xo,"objOf");function Zo(e,t){var r;return r={},r[t]=e,r}n(Zo,"_objOf");var Ie=function(){return Ie=Object.assign||function(e){for(var t,r=1,o=arguments.length;r<o;r++){t=arguments[r];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e},Ie.apply(this,arguments)},ei=function(e,t){var r={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(r[o]=e[o]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,o=Object.getOwnPropertySymbols(e);i<o.length;i++)t.indexOf(o[i])<0&&Object.prototype.propertyIsEnumerable.call(e,o[i])&&(r[o[i]]=e[o[i]]);return r};function ti(){return s(ri,arguments)}n(ti,"omit");function ri(e,t){if(t.length===0)return Ie({},e);if(t.length===1){var r=t[0],o=e,i=r,a=o[i],u=ei(o,[typeof i=="symbol"?i:i+""]);return u}if(!t.some(function(f){return f in e}))return Ie({},e);var c=new Set(t);return te(Object.entries(e).filter(function(f){var l=f[0];return!c.has(l)}))}n(ri,"_omit");function ni(){return s(oi,arguments)}n(ni,"omitBy");function oi(e,t){return Object.keys(e).reduce(function(r,o){return t(e[o],o)||(r[o]=e[o]),r},{})}n(oi,"_omitBy");function ii(e){var t=!1,r;return function(){return t||(r=e(),t=!0),r}}n(ii,"once");function ai(){return s(si,arguments)}n(ai,"only");function si(e){if(e.length===1)return e[0]}n(si,"_only");function pt(){return s(Tr(!1),arguments)}n(pt,"partition");var Tr=n(function(e){return function(t,r){var o=[[],[]];return t.forEach(function(i,a){var u=e?r(i,a,t):r(i);o[u?0:1].push(i)}),o}},"_partition");(function(e){function t(){return s(Tr(!0),arguments)}n(t,"indexed"),e.indexed=t})(pt||(pt={}));function ci(){return s(fi,arguments)}n(ci,"pathOr");function fi(e,t,r){for(var o=e,i=0,a=t;i<a.length;i++){var u=a[i];if(o==null||o[u]==null)return r;o=o[u]}return o}n(fi,"_pathOr");function li(){return s(pi,arguments)}n(li,"pick");function pi(e,t){return e==null?{}:t.reduce(function(r,o){return o in e&&(r[o]=e[o]),r},{})}n(pi,"_pick");function mi(){return s(di,arguments)}n(mi,"pickBy");function di(e,t){return e==null?{}:Object.keys(e).reduce(function(r,o){return t(e[o],o)&&(r[o]=e[o]),r},{})}n(di,"_pickBy");var gi=n(function(e){return function(t){var r=e,o=t[r];return o}},"prop");function mt(){return s(yi,arguments)}n(mt,"range");function yi(e,t){for(var r=[],o=e;o<t;o++)r.push(o);return r}n(yi,"_range");function hi(e){var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",r=n(function(){return t[Math.floor(Math.random()*t.length)]},"randomChar");return mt(0,e).reduce(function(o){return o+r()},"")}n(hi,"randomString");function xi(){return T(vi,arguments)}n(xi,"rankBy");function vi(e,t,r){for(var o=0,i=0,a=e;i<a.length;i++){var u=a[i];t(r,u)>0&&o++}return o}n(vi,"rankByImplementation");function dt(){return s(Mr(!1),arguments)}n(dt,"reduce");var Mr=n(function(e){return function(t,r,o){return t.reduce(function(i,a,u){return e?r(i,a,u,t):r(i,a)},o)}},"_reduce");(function(e){function t(){return s(Mr(!0),arguments)}n(t,"indexed"),e.indexed=t})(dt||(dt={}));function q(){return s(Cr(!1),arguments,q.lazy)}n(q,"reject");var Cr=n(function(e){return function(t,r){return g(t,e?q.lazyIndexed(r):q.lazy(r),e)}},"_reject"),_r=n(function(e){return function(t){return function(r,o,i){var a=e?t(r,o,i):t(r);return a?{done:!1,hasNext:!1}:{done:!1,hasNext:!0,next:r}}}},"_lazy");(function(e){function t(){return s(Cr(!0),arguments,e.lazyIndexed)}n(t,"indexed"),e.indexed=t,e.lazy=_r(!1),e.lazyIndexed=I(_r(!0))})(q||(q={}));function bi(){return s(wi,arguments)}n(bi,"reverse");function wi(e){return e.slice().reverse()}n(wi,"_reverse");function Ii(){return s(P(Math.round),arguments)}n(Ii,"round");function ki(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return s(Oi,e)}n(ki,"sample");function Oi(e,t){if(t<0)throw new RangeError("sampleSize must cannot be negative: ".concat(t));if(!Number.isInteger(t))throw new TypeError("sampleSize must be an integer: ".concat(t));if(t>=e.length)return e;if(t===0)return[];for(var r=Math.min(t,e.length-t),o=new Set;o.size<r;){var i=Math.floor(Math.random()*e.length);o.add(i)}return t===r?Array.from(o).sort(function(a,u){return a-u}).map(function(a){return e[a]}):e.filter(function(a,u){return!o.has(u)})}n(Oi,"sampleImplementation");var ke=function(){return ke=Object.assign||function(e){for(var t,r=1,o=arguments.length;r<o;r++){t=arguments[r];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e},ke.apply(this,arguments)};function Si(){return s(Ei,arguments)}n(Si,"set");function Ei(e,t,r){var o;return ke(ke({},e),(o={},o[t]=r,o))}n(Ei,"_set");var Oe=function(){return Oe=Object.assign||function(e){for(var t,r=1,o=arguments.length;r<o;r++){t=arguments[r];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e},Oe.apply(this,arguments)};function Ai(){return s(Se,arguments)}n(Ai,"setPath");function Se(e,t,r){var o;return t.length===0?r:Array.isArray(e)?e.map(function(i,a){return a===t[0]?Se(i,t.slice(1),r):i}):Oe(Oe({},e),(o={},o[t[0]]=Se(e[t[0]],t.slice(1),r),o))}n(Se,"_setPath");function Ti(){return s(Mi,arguments)}n(Ti,"shuffle");function Mi(e){for(var t=e.slice(),r=0;r<e.length;r+=1){var o=r+Math.floor(Math.random()*(e.length-r)),i=t[o];t[o]=t[r],t[r]=i}return t}n(Mi,"_shuffle");var _i=n(function(e,t){return function(r){return r.slice(e,t)}},"sliceString");var Ci=function(e,t,r){if(r||arguments.length===2)for(var o=0,i=t.length,a;o<i;o++)(a||!(o in t))&&(a||(a=Array.prototype.slice.call(t,0,o)),a[o]=t[o]);return e.concat(a||Array.prototype.slice.call(t))};function gt(){return s(Di,arguments)}n(gt,"sort");function Di(e,t){var r=Ci([],e,!0);return r.sort(t),r}n(Di,"_sort");(function(e){e.strict=e})(gt||(gt={}));var Ni=function(e,t,r){if(r||arguments.length===2)for(var o=0,i=t.length,a;o<i;o++)(a||!(o in t))&&(a||(a=Array.prototype.slice.call(t,0,o)),a[o]=t[o]);return e.concat(a||Array.prototype.slice.call(t))};function yt(){return Z(ji,arguments)}n(yt,"sortBy");var ji=n(function(e,t){return Ni([],e,!0).sort(t)},"_sortBy");(function(e){e.strict=e})(yt||(yt={}));function E(e,t){for(var r=0,o=e.length;r<o;){var i=r+o>>>1,a=e[i];t(a,i)?r=i+1:o=i}return o}n(E,"_binarySearchCutoffIndex");function Pi(){return s(zi,arguments)}n(Pi,"sortedIndex");var zi=n(function(e,t){return E(e,function(r){return r<t})},"sortedIndexImplementation");function ht(){return s(Dr,arguments)}n(ht,"sortedIndexBy");(function(e){function t(){return s(Dr,arguments)}n(t,"indexed"),e.indexed=t})(ht||(ht={}));function Dr(e,t,r){var o=r(t);return E(e,function(i,a){return r(i,a)<o})}n(Dr,"sortedIndexByImplementation");function xt(){return s(E,arguments)}n(xt,"sortedIndexWith");(function(e){function t(){return s(E,arguments)}n(t,"indexed"),e.indexed=t})(xt||(xt={}));function Fi(){return s(Li,arguments)}n(Fi,"sortedLastIndex");var Li=n(function(e,t){return E(e,function(r){return r<=t})},"sortedLastIndexImplementation");function vt(){return s(Nr,arguments)}n(vt,"sortedLastIndexBy");(function(e){function t(){return s(Nr,arguments)}n(t,"indexed"),e.indexed=t})(vt||(vt={}));function Nr(e,t,r){var o=r(t);return E(e,function(i,a){return r(i,a)<=o})}n(Nr,"sortedLastIndexByImplementation");var jr=function(e,t,r){if(r||arguments.length===2)for(var o=0,i=t.length,a;o<i;o++)(a||!(o in t))&&(a||(a=Array.prototype.slice.call(t,0,o)),a[o]=t[o]);return e.concat(a||Array.prototype.slice.call(t))};function Ri(){return s($i,arguments)}n(Ri,"splice");function $i(e,t,r,o){var i=jr([],e,!0);return i.splice.apply(i,jr([t,r],o,!1)),i}n($i,"_splice");var Ui=function(e,t,r){if(r||arguments.length===2)for(var o=0,i=t.length,a;o<i;o++)(a||!(o in t))&&(a||(a=Array.prototype.slice.call(t,0,o)),a[o]=t[o]);return e.concat(a||Array.prototype.slice.call(t))};function bt(){return s(Bi,arguments)}n(bt,"splitAt");function Bi(e,t){var r=Ui([],e,!0),o=r.splice(t);return[r,o]}n(Bi,"_splitAt");function Gi(){return s(qi,arguments)}n(Gi,"splitWhen");function qi(e,t){for(var r=0;r<e.length;r++)if(t(e[r]))return bt(e,r);return[e,[]]}n(qi,"_splitWhen");var Wi=function(e,t,r){if(r||arguments.length===2)for(var o=0,i=t.length,a;o<i;o++)(a||!(o in t))&&(a||(a=Array.prototype.slice.call(t,0,o)),a[o]=t[o]);return e.concat(a||Array.prototype.slice.call(t))};function Yi(e){return Pr(e)}n(Yi,"stringToPath");function Pr(e){var t;if(e.length===0)return[];var r=(t=e.match(/^\[(.+?)\](.*)$/))!==null&&t!==void 0?t:e.match(/^\.?([^.[\]]+)(.*)$/);if(r){var o=r[1],i=r[2];return Wi([o],Pr(i),!0)}return[e]}n(Pr,"_stringToPath");function Hi(){return s(Vi,arguments)}n(Hi,"subtract");function Vi(e,t){return e-t}n(Vi,"_subtract");var zr=n(function(e){return function(t,r){var o=0;return t.forEach(function(i,a){var u=e?r(i,a,t):r(i);o+=u}),o}},"_sumBy");function wt(){return s(zr(!1),arguments)}n(wt,"sumBy");(function(e){function t(){return s(zr(!0),arguments)}n(t,"indexed"),e.indexed=t})(wt||(wt={}));function Ki(){return s(Qi,arguments)}n(Ki,"swapIndices");function Qi(e,t,r){return typeof e=="string"?Ji(e,t,r):Fr(e,t,r)}n(Qi,"_swapIndices");function Fr(e,t,r){var o=e.slice();if(isNaN(t)||isNaN(r))return o;var i=t<0?e.length+t:t,a=r<0?e.length+r:r;return i<0||i>e.length||a<0||a>e.length||(o[i]=e[a],o[a]=e[i]),o}n(Fr,"_swapArray");function Ji(e,t,r){var o=Fr(e.split(""),t,r);return o.join("")}n(Ji,"_swapString");var Ee=function(){return Ee=Object.assign||function(e){for(var t,r=1,o=arguments.length;r<o;r++){t=arguments[r];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e},Ee.apply(this,arguments)};function Xi(){return s(Zi,arguments)}n(Xi,"swapProps");function Zi(e,t,r){var o,i=e,a=t,u=i[a],c=r,f=i[c];return Ee(Ee({},e),(o={},o[t]=f,o[r]=u,o))}n(Zi,"_swapProps");function oe(){return s(ea,arguments,oe.lazy)}n(oe,"take");function ea(e,t){return g(e,oe.lazy(t))}n(ea,"_take");(function(e){function t(r){return function(o){return r===0?{done:!0,hasNext:!1}:(r--,r===0?{done:!0,hasNext:!0,next:o}:{done:!1,hasNext:!0,next:o})}}n(t,"lazy"),e.lazy=t})(oe||(oe={}));var ta=function(e,t,r){if(r||arguments.length===2)for(var o=0,i=t.length,a;o<i;o++)(a||!(o in t))&&(a||(a=Array.prototype.slice.call(t,0,o)),a[o]=t[o]);return e.concat(a||Array.prototype.slice.call(t))};function ra(){return T(na,arguments)}n(ra,"takeFirstBy");function na(e,t,r){if(r<=0)return[];if(r>=e.length)return ta([],e,!0);var o=e.slice(0,r);de(o,t);for(var i=e.slice(r),a=0,u=i;a<u.length;a++){var c=u[a];ge(o,t,c)}return o}n(na,"takeFirstByImplementation");function oa(){return s(ia,arguments)}n(oa,"takeLastWhile");function ia(e,t){for(var r=e.length-1;r>=0;r--)if(!t(e[r]))return e.slice(r+1);return e.slice()}n(ia,"_takeLastWhile");function aa(){return s(sa,arguments)}n(aa,"takeWhile");function sa(e,t){for(var r=[],o=0,i=e;o<i.length;o++){var a=i[o];if(!t(a))break;r.push(a)}return r}n(sa,"_takeWhile");function ua(){return s(ca,arguments)}n(ua,"tap");function ca(e,t){return t(e),e}n(ca,"_tap");function fa(){return s(la,arguments)}n(fa,"times");function la(e,t){if(e<0)throw new RangeError("n must be a non-negative number");for(var r=[],o=0;o<e;o++)r.push(t(o));return r}n(la,"_times");function C(){return s(pa,arguments,C.lazy)}n(C,"uniq");function pa(e){return g(e,C.lazy())}n(pa,"_uniq");(function(e){function t(){var r=new Set;return function(o){return r.has(o)?{done:!1,hasNext:!1}:(r.add(o),{done:!1,hasNext:!0,next:o})}}n(t,"lazy"),e.lazy=t})(C||(C={}));function ma(){return s(da,arguments,Lr)}n(ma,"uniqBy");function da(e,t){return g(e,Lr(t))}n(da,"_uniqBy");function Lr(e){var t=new Set;return function(r){var o=e(r);return t.has(o)?{done:!1,hasNext:!1}:(t.add(o),{done:!1,hasNext:!0,next:r})}}n(Lr,"lazyUniqBy");function ie(){return s(ga,arguments,ie.lazy)}n(ie,"uniqWith");function ga(e,t){var r=ie.lazy(t);return g(e,r,!0)}n(ga,"_uniqWith");function ya(e){return function(t,r,o){return o&&o.findIndex(function(i){return e(t,i)})===r?{done:!1,hasNext:!0,next:t}:{done:!1,hasNext:!1}}}n(ya,"_lazy");(function(e){e.lazy=I(ya)})(ie||(ie={}));function ha(e){return Object.values(e)}n(ha,"values");function It(){return s(xa,arguments)}n(It,"zip");function xa(e,t){for(var r=e.length>t.length?t.length:e.length,o=[],i=0;i<r;i++)o.push([e[i],t[i]]);return o}n(xa,"_zip");(function(e){e.strict=e})(It||(It={}));function va(){return s(ba,arguments)}n(va,"zipObj");function ba(e,t){for(var r=e.length>t.length?t.length:e.length,o={},i=0;i<r;i++)o[e[i]]=t[i];return o}n(ba,"_zipObj");function wa(){var e=Array.from(arguments);if(typeof e[0]=="function"&&e.length===1)return function(t,r){return kt(t,r,e[0])};if(typeof e[0]=="function"&&e.length===2)return function(t){return kt(t,e[1],e[0])};if(e.length===3)return kt(e[0],e[1],e[2])}n(wa,"zipWith");function kt(e,t,r){for(var o=e.length>t.length?t.length:e.length,i=[],a=0;a<o;a++)i.push(r(e[a],t[a]));return i}n(kt,"_zipWith");function Ae(e){return Error(`PF2e System | ${e}`)}n(Ae,"ErrorPF2e");function se(e,t){return e.has(t)}n(se,"setHasElement");var Ia=new Map([["incredibly-easy",-10],["very-easy",-5],["easy",-2],["normal",0],["hard",2],["very-hard",5],["incredibly-hard",10]]),ka=new Map([[-1,13],[0,14],[1,15],[2,16],[3,18],[4,19],[5,20],[6,22],[7,23],[8,24],[9,26],[10,27],[11,28],[12,30],[13,31],[14,32],[15,34],[16,35],[17,36],[18,38],[19,39],[20,40],[21,42],[22,44],[23,46],[24,48],[25,50]]);function Ot(e,{pwol:t,rarity:r="common"}={}){t??=game.pf2e.settings.variants.pwol.enabled;let o=ka.get(e)??14;return Te(t?o-Math.max(e,0):o,r)}n(Ot,"calculateDC");function Te(e,t="common"){return Oa(e,Sa(t))}n(Te,"adjustDCByRarity");function Oa(e,t="normal"){return e+(Ia.get(t)??0)}n(Oa,"adjustDC");function Sa(e="common"){switch(e){case"uncommon":return"hard";case"rare":return"very-hard";case"unique":return"incredibly-hard";default:return"normal"}}n(Sa,"rarityToDCAdjustment");var ue=new Set(["arcane","divine","occult","primal"]);var St=class extends FormApplication{static get defaultOptions(){return{...FormApplication.defaultOptions,id:"identify-item",title:game.i18n.localize("PF2E.identification.Identify"),template:"systems/pf2e/templates/actors/identify-item.hbs",width:"auto",classes:["identify-popup"]}}dcs=Et(this.object,{pwol:game.pf2e.settings.variants.pwol.enabled,notMatchingTraditionModifier:game.settings.get("pf2e","identifyMagicNotMatchingTraditionModifier")});async getData(){let t=this.object;return{...await super.getData(),isMagic:t.isMagical,isAlchemical:t.isAlchemical,dcs:this.dcs}}activateListeners(t){let r=t[0],o=r.querySelector<HTMLButtonElement>"button.update-identification";o?.addEventListener("click",()=>{this.submit({updateData:{status:o.value}})}),r.querySelector("button.post-skill-checks")?.addEventListener("click",async()=>{let i=this.object,a=i.system.identification.identified.name,u=this.dcs,c=i.isMagical?"identify-magic":i.isAlchemical?"identify-alchemy":"recall-knowledge",f=await renderTemplate("systems/pf2e/templates/actors/identify-item-chat-skill-checks.hbs",{identifiedName:a,action:c,skills:R.omit(u,["dc"]),unidentified:i.system.identification.unidentified,uuid:i.uuid});await ChatMessage.implementation.create({user:game.user.id,content:f})})}async _updateObject(t,r){let o=r.status;if(o==="identified")return this.object.setIdentificationStatus(o)}};n(St,"IdentifyItemPopup");function Et(e,{pwol:t=!1,notMatchingTraditionModifier:r}){let o=Ot(e.level,{pwol:t}),i=Ea(e),a=Te(o,i);return e.isMagical?Aa(e,a,r):{crafting:a}}n(Et,"getItemIdentificationDCs");function Ea(e){return e.traits.has("cursed")?"unique":e.rarity}n(Ea,"getDcRarity");function Aa(e,t,r){let o={occult:t,primal:t,divine:t,arcane:t},i=Ta(e);for(let a of ue)i.size>0&&!i.has(a)&&(o[a]=t+r);return{arcana:o.arcane,nature:o.primal,religion:o.divine,occultism:o.occult}}n(Aa,"getIdentifyMagicDCs");function Ta(e){let t=e.system.traits.value;return new Set(t.filter(r=>se(ue,r)))}n(Ta,"getMagicTraditions");var At=class extends FormApplication{constructor(t,r,o){super(t,r),this.onSubmitCallback=o}async getData(){let[t,r]=this.options.isPurchase?["PF2E.loot.PurchaseLootMessage","PF2E.loot.PurchaseLoot"]:["PF2E.loot.MoveLootMessage","PF2E.loot.MoveLoot"];return{...await super.getData(),quantity:{default:this.options.quantity.default,max:this.options.quantity.max},newStack:this.options.newStack,lockStack:this.options.lockStack,prompt:t,buttonLabel:r}}static get defaultOptions(){return{...FormApplication.defaultOptions,id:"MoveLootPopup",classes:[],title:game.i18n.localize("PF2E.loot.MoveLootPopupTitle"),template:"systems/pf2e/templates/popups/loot/move-loot-popup.hbs",width:"auto",quantity:{default:1,max:1},newStack:!1,lockStack:!1,isPurchase:!1}}async _updateObject(t,r){this.onSubmitCallback(r.quantity,r.newStack)}};n(At,"MoveLootPopup");var Ma="tLa4bewBhyqzi6Ow",_a={1:"RjuupS9xyXDLgyIr",2:"Y7UD64foDbDMV9sx",3:"ZmefGBXGJF3CFDbn",4:"QSQZJ5BC3DeHv153",5:"tjLvRWklAylFhBHQ",6:"4sGIy77COooxhQuC",7:"fomEZZ4MxVVK3uVu",8:"iPki3yuoucnj7bIt",9:"cFHomF3tty8Wi1e5",10:"o1XIHJ4MJyroAHfF"};var Ca={cantripDeck5:"PF2E.Item.Physical.FromSpell.CantripDeck5",scroll:"PF2E.Item.Physical.FromSpell.Scroll",wand:"PF2E.Item.Physical.FromSpell.Wand"},Da={1:"UJWiN0K3jqVjxvKk",2:"vJZ49cgi8szuQXAD",3:"wrDmWkGxmwzYtfiA",4:"Sn7v9SsbEDMUIwrO",5:"5BF7zMnrPYzyigCs",6:"kiXh4SUWKr166ZeM",7:"nmXPj9zuMRQBNT60",8:"Qs8RgNH6thRPv2jt",9:"Fgv722039TVM5JTc"};async function Rr(e,{type:t,heightenedLevel:r=e.baseRank,mystified:o=!1,temp:i=!1,itemImg:a,itemName:u=t}){let c=game.packs.find(d=>d.collection==="pf2e.equipment-srd"),f=Na(t,r),l=await c?.getDocument(f??"");if(!Le(l,"ConsumablePF2e"))throw Ae("Failed to retrieve consumable item");let m={...l.toObject(),_id:null},{traits:p}=m.system;p.value=C([...p.value,...e.traits]),p.rarity=e.rarity,p.value.includes("magical")&&p.value.some(d=>se(ue,d))&&p.value.splice(p.value.indexOf("magical"),1),p.value.sort(),m.name=ja(u,e.name,r);let y=m.system.description.value;return m.system.description.value=(()=>{let d=document.createElement("p");d.append(e.sourceId?`@UUID[${e.sourceId}]{${e.name}}`:e.description);let h=document.createElement("div"),v=document.createElement("hr");return h.append(d,v),v.insertAdjacentHTML("afterend",y),h.innerHTML})(),t!=="cantripDeck5"&&(m.system.spell=e.clone({_id:randomID(),"system.location.heightenedLevel":r},{keepId:!0}).toObject()),o&&(m.system.identification.status="unidentified"),typeof a=="string"&&(m.img=a),i&&(m.system.temporary=!0),m}n(Rr,"createConsumableFromSpell");function Na(e,t){switch(e){case"cantripDeck5":return Ma;case"scroll":return _a[t]??null;default:return Da[t]??null}}n(Na,"getIdForSpellConsumable");function ja(e,t,r){let o=Ca[e]||`${e} of {name} (Level {level})`;return game.i18n.format(o,{name:t,level:r})}n(ja,"getNameForSpellConsumable");var Me={LOWER_BY_TWO:-2,LOWER:-1,INCREASE:1,INCREASE_BY_TWO:2,TO_CRITICAL_FAILURE:"criticalFailure",TO_FAILURE:"failure",TO_SUCCESS:"success",TO_CRITICAL_SUCCESS:"criticalSuccess"},$r=["criticalFailure","failure","success","criticalSuccess"],Ce,Ur,W,_e,N,ce,De,Br,M=class{constructor(t,r,o=null){H(this,Ce);H(this,W);H(this,N);H(this,De);t instanceof Roll?(this.dieResult=(t.isDeterministic?t.terms.find(i=>i instanceof NumericTerm):t.dice.find(i=>i instanceof Die&&i.faces===20))?.total??1,this.rollTotal=t.total):(this.dieResult=t.dieValue,this.rollTotal=t.dieValue+t.modifier),this.dc=typeof r=="number"?{value:r}:r,this.unadjusted=A(this,De,Br).call(this),this.adjustment=A(this,Ce,Ur).call(this,this.unadjusted,o),this.value=this.adjustment?A(this,W,_e).call(this,this.adjustment.amount,this.unadjusted):this.unadjusted}},D=M;n(D,"DegreeOfSuccess"),Ce=new WeakSet,Ur=n(function(t,r){if(!r)return null;for(let o of["all",...$r]){let{label:i,amount:a}=r[o]??{};if(a&&i&&!(t===M.CRITICAL_SUCCESS&&a===Me.INCREASE)&&!(t===M.CRITICAL_FAILURE&&a===Me.LOWER)&&(o==="all"||$r.indexOf(o)===t))return{label:i,amount:a}}return null},"#getDegreeAdjustment"),W=new WeakSet,_e=n(function(t,r){switch(t){case"criticalFailure":return 0;case"failure":return 1;case"success":return 2;case"criticalSuccess":return 3;default:return Math.clamped(r+t,0,3)}},"#adjustDegreeOfSuccess"),N=new WeakSet,ce=n(function(t){return this.dieResult===20?A(this,W,_e).call(this,Me.INCREASE,t):this.dieResult===1?A(this,W,_e).call(this,Me.LOWER,t):t},"#adjustDegreeByDieValue"),De=new WeakSet,Br=n(function(){let t=this.dc.value;return this.rollTotal-t>=10?A(this,N,ce).call(this,M.CRITICAL_SUCCESS):t-this.rollTotal>=10?A(this,N,ce).call(this,M.CRITICAL_FAILURE):this.rollTotal>=t?A(this,N,ce).call(this,M.SUCCESS):A(this,N,ce).call(this,M.FAILURE)},"#calculateDegreeOfSuccess"),Y(D,"CRITICAL_FAILURE",0),Y(D,"FAILURE",1),Y(D,"SUCCESS",2),Y(D,"CRITICAL_SUCCESS",3);function Ne(e){let t=["esoteric","esoteric-lore","lore-esoteric"],r=Object.values(e.skills).find(o=>t.includes(o.slug));return r||ui.notifications.warn("This character doesn't have the 'Esoteric' skill"),r}n(Ne,"getEsotericSkill");function Gr(e,t){if(!t||!t.isOwner||!t.isOfType("character")){ui.notifications.warn("You must select a character token you own.");return}let r=Ne(t);if(!r)return;let o=new Set,i=[{text:`Can be used to Recall Knowledge regarding haunts, curses 
    and creatures of any type, but can't be used to Recall Knowledge of other topics.`}];r.roll({rollMode:"blindroll",extraRollNotes:i,options:o})}n(Gr,"esotericCheck");var Pa="Compendium.pf2e.classfeatures.Item.jyCEC3eC4B6YaGoy",Tt="Compendium.idleuh.effects.Item.9IapmSGjH0hDaVMv",Wr=["bludgeoning","slashing","piercing"],qr=["fire","earth",...Wr];async function Yr(e,t){if(!t?.isOfType("character")){ui.notifications.warn("You need to select a character");return}if(!w(t,Pa,["feat"])){ui.notifications.warn("Your selected character needs to have the feat <strong>Extract Element</strong>");return}let o=game.user.targets.first(),i=o?.actor;if(!i||i===t){ui.notifications.warn("You need to target another actor");return}if(w(i,Tt,["effect"])){ui.notifications.warn("Your target's elements have already been extracted");return}let u=await i.saves.fortitude.roll({event:e,label:"Fortitude Save - Extract Element",dc:{slug:"class",label:"Kineticist DC",value:t.classDC.dc.value}});if(u.degreeOfSuccess>2)return;let c=(await fromUuid(Tt))?.toObject(),f=c.system.rules;c.flags.core.sourceId=Tt;let l={};f.push({key:"Immunity",mode:"remove",type:qr.slice(),predicate:["origin:effect:kinetic-aura"]});let m=!1,p=i.attributes.resistances.filter(({type:x})=>qr.includes(x));for(let{type:x,value:j,exceptions:S,doubleVs:k}of p)x==="earth"?m={value:j,exceptions:S}:f.push({key:"Weakness",type:x,value:j,exceptions:S,predicate:["origin:effect:kinetic-aura"]}),k.length&&(l.doubleVs=!0);if(m)for(let x of Wr)f.push({key:"Weakness",type:x,value:m.value,exceptions:m.exceptions,predicate:["origin:effect:kinetic-aura"]});i.createEmbeddedDocuments("Item",[c]);let y=[];l.doubleVs&&y.push("The creature has some resistances that are doubled versus criticals, this can't be automated and will have to be manually handled by the GM.");let d=`${Math.ceil(t.level/2)+1}d4`,h=CONFIG.Dice.rolls.find(x=>x.name==="DamageRoll"),v=await new h(d).evaluate({async:!0}),O=`
<h4 class="action">
    <strong>Extract Element</strong>
    <span class="action-glyph">1</span>
</h4>
<div class="target-dc-result" data-tooltip-class="pf2e" data-tooltip-direction="UP">
    <div class="target-dc"><span data-visibility="all" data-whose="target">Target: ${i.name}</span></div>
</div>
`;for(let x of y)O+=`<p>${x}</p>`;v.toMessage({flavor:O,speaker:ChatMessage.getSpeaker({actor:t}),flags:{pf2e:{context:{target:{token:o.document.uuid,actor:i.uuid}}}}}),console.log({saveRoll:u,damageRoll:v,source:c})}n(Yr,"extractElement");var fe=class extends Application{constructor(t,r){super(r),this.items=t}static get defaultOptions(){return mergeObject(Application.defaultOptions,{id:"idleuh-identify",title:"Identify Items",template:Ft("identify"),width:500})}getData(t){return mergeObject(super.getData(t),{items:this.items.map(r=>{let o=r.system.identification.identified,i=r.isIdentified,a=!i&&r.getFlag("world","identify.checked"),u=[];return i&&u.push("identified"),a&&u.push("checked"),{uuid:r.uuid,img:o.img,name:r.isOfType("treasure")?`($) ${o.name}`:o.name,css:u.join(" "),identified:i,checked:a}})})}activateListeners(t){t.find('[data-action="chat"]').on("click",this.#e.bind(this)),t.find('[data-action="checks"]').on("click",this.#t.bind(this)),t.find('[data-action="identify"]').on("click",this.#r.bind(this)),t.find('[data-action="remove"]').on("click",this.#n.bind(this)),t.find('[data-action="reset"]').on("click",this.#o.bind(this))}async#e(t){(await je(t))?.toMessage(void 0,{create:!0})}async#t(t){let r=await je(t),o=r.system.identification.identified.name,i=Et(r,{pwol:game.pf2e.settings.variants.pwol.enabled,notMatchingTraditionModifier:game.settings.get("pf2e","identifyMagicNotMatchingTraditionModifier")}),a=r.isMagical?"identify-magic":r.isAlchemical?"identify-alchemy":"recall-knowledge",u=await renderTemplate("systems/pf2e/templates/actors/identify-item-chat-skill-checks.hbs",{identifiedName:o,action:a,skills:ae.omit(i,["dc"]),unidentified:r.system.identification.unidentified,uuid:r.uuid});await ChatMessage.implementation.create({user:game.user.id,content:u})}async#r(t){let r=await je(t);r&&(await r.setIdentificationStatus(r.isIdentified?"unidentified":"identified"),this.render())}async#n(t){let r=await je(t);if(!r)return;let o=r.getFlag("world","identify.checked");await r.setFlag("world","identify.checked",!o),this.render()}async#o(t){t.preventDefault();for(let r of this.items)r.isIdentified||!r.getFlag("world","identify.checked")||await r.setFlag("world","identify.checked",!1);this.render()}};n(fe,"Identify");async function je(e){let t=$(e.currentTarget).closest("[data-item]"),r=t.attr("data-item"),o=await fromUuid(r);return o||t.remove(),o}n(je,"getItemFromEvent");function Hr(){if(!game.user.isGM){ui.notifications.warn("You not the GM yo!");return}let t=game.actors.reduce((r,o)=>{if(!o.hasPlayerOwner)return r;let i=o.items.filter(a=>a.isOfType("physical")&&!a.isIdentified);return r.push(...i),r},[]);new fe(t).render(!0)}n(Hr,"identify");var za="pf2e.spells-srd",Fa="Item.dcALVAyJbYSovzqt";async function Vr(e){if(!e)return ui.notifications.warn("You must select an actor with the Imaginarium");let t=e.itemTypes.equipment.find(p=>p.getFlag("core","sourceId")===Fa);if(!t||t.system.equipped.carryType==="dropped")return ui.notifications.warn("This actor doesn't have the Imaginarium in their possession");let r=Math.floor(e.level/2)||1,o=game.packs.get(za),a=(await o.getIndex({fields:["system.level.value","system.traits","system.ritual"]})).filter(p=>p.system.level.value<=r&&!p.system.traits.value.includes("cantrip")&&!p.system.traits.value.includes("focus")&&!p.system.ritual&&p.system.traits.rarity==="common"),u=Math.floor(Math.random()*a.length),c=await o.getDocument(a[u]._id),f=await Rr(c,{type:"scroll",heightenedLevel:r});if(!f){Re("An error occured while creating an imaginarium scroll");return}f.name=`${f.name} *`;let[l]=await e.createEmbeddedDocuments("Item",[f]),m=Pt(c.uuid,l.name);ChatMessage.create({content:`<p>Ripped the last page of the Imaginarium:</p><p>${m}</p>`,speaker:ChatMessage.getSpeaker({actor:e})})}n(Vr,"ripImaginarium");var Kr="Compendium.idleuh.effects.Item.jjFsfolNR04KzPVh",La="Compendium.idleuh.feats.Item.X3SZ0gTpBkGw3UGX",Qr="Compendium.idleuh.effects.Item.r0hicuQPY0OEAC6g";async function Jr(e,t){if(!t||!t.isOwner||!t.isOfType("character")){ui.notifications.warn("You must select a character token you own.");return}if(!w(t,La,["feat"])){ui.notifications.warn("This character doesn't have <strong>Inspiring Marshal Stance</strong> feat.");return}if(w(t,Qr,["effect"])){ui.notifications.warn("This character cannot enter <strong>Inspiring Marshal Stance</strong>.");return}let r=getDcByLevel(t.level),i=(await t.skills.diplomacy.roll({dc:{value:r},rollMode:"roll",label:'<span class="pf2-icon">A</span> <b>Marshal Inspiration</b> <span>(Diplomacy Check)</span>',extraRollNotes:[{outcome:["criticalFailure"],text:"<strong>Critical Failure</strong> You fail to enter the stance and can't take this action again for 1 minute."},{outcome:["failure"],text:"<strong>Failure</strong> You fail to enter the stance."},{outcome:["success"],text:"<strong>Success</strong> Your marshal's aura grants you and allies a +1 status bonus to attack rolls and saves against mental effects."},{outcome:["criticalSuccess"],text:"<strong>Critical Success</strong> Your marshal's aura increases to a 20ft. emanation and grants you and allies a +1 status bonus to attack rolls and saves against mental effects."}]})).degreeOfSuccess;i>=2?await $a(t,i):(await(await Xr(t))?.delete(),i===0&&await Ra(t))}n(Jr,"marshalInspiration");async function Ra(e){let t=await fromUuid(Qr);t&&await e.createEmbeddedDocuments("Item",[t.toObject()])}n(Ra,"setDebuff");async function $a(e,t){let r=t===3?20:10,o=await Xr(e);if(o){let c=deepClone(o._source.system.rules),f=c.find(l=>l.key==="ChoiceSet");if(f.selection===r)return;f.selection=r,o.update({"system.rules":c});return}let i=await fromUuid(Kr);if(!i)return;let a=i.toObject(),u=a.system.rules.find(c=>c.key==="ChoiceSet");u.selection=r,await e.createEmbeddedDocuments("Item",[a])}n($a,"setEffect");async function Xr(e){return w(e,Kr,["effect"])}n(Xr,"getEffect");async function Pe({actor:e,token:t,item:r,formula:o}){let i=CONFIG.Dice.rolls.find(l=>l.name==="DamageRoll"),a=await new i(o).evaluate({async:!0}),u=Array.from(r.traits),c={type:"damage-roll",sourceType:"attack",actor:e.id,token:t?.id,target:null,domains:[],options:[u,e.getRollOptions(),r.getRollOptions("item")].flat(),mapIncreases:void 0,notes:[],secret:!1,rollMode:"roll",traits:u,skipDialog:!1,outcome:null,unadjustedOutcome:null},f=`<h4 class="action"><strong>${r.name}</strong></h4>`;return f+='<div class="tags" data-tooltip-class="pf2e">',f+=u.map(l=>{let m=game.i18n.localize(CONFIG.PF2E.actionTraits[l]),p=CONFIG.PF2E.traitsDescriptions[l];return`<span class="tag" data-trait="${l}" data-tooltip="${p}">${m}</span>`}).join(""),f+="</div><hr>",a.toMessage({flavor:f,speaker:ChatMessage.implementation.getSpeaker({actor:e,token:t}),flags:{pf2e:{context:c,origin:r.getOriginData()}}})}n(Pe,"rollDamage");var Ua="Compendium.pf2e.feats-srd.Item.XJCsa3UbQtsKcqve";async function Zr(e,t){let r=e?.itemTypes.feat.find(i=>i.sourceId===Ua);if(!r){ui.notifications.warn("You need to select a kineticist with the <strong>Thermal Nimbus</strong> feat.");return}let o=`${Math.floor(e.level/2)}[fire]`;await Pe({actor:e,token:t,item:r,formula:o})}n(Zr,"thermalNimbus");var Ba=["untrained","trained","expert","master","legendary"];async function en(){if(!game.user.isGM){ui.notifications.warn("You not the GM yo!");return}let e="",t=game.actors.party?.members??[];await Promise.all(t.map(async r=>{if(!r.isOfType("character"))return;let o=await r.perception.roll({createMessage:!1}),i=o.dice[0].total;e+=`<div style="display:flex;justify-content:space-between;" title="${o.result}">`,e+=`<span>${r.name} (${Ba[r.perception.rank]})</span><span`,i===20?e+=' style="color: green;"':i===1&&(e+=' style="color: red;"'),e+=`>${o.total}</span></div>`})),e&&ChatMessage.create({content:e,flavor:"Group Perception Checks<hr>",whisper:[game.user.id]})}n(en,"groupPerception");var Ga="Compendium.pf2e.feats-srd.Item.40mZVDnIP5qBNhTH";function tn(e,t){if(!t?.isOfType("character")){ui.notifications.warn("You need to select a character");return}if(!w(t,Ga,["feat"])){ui.notifications.warn("Your selected character needs to have the feat <strong>Sand Snatcher</strong>");return}let o=game.user.targets.first()?.actor;t.getStatistic("impulse").roll({event:e,label:"Sand Snatcher - Grapple",target:o,dc:{slug:"fortitude",label:"Fortitude DC",value:o?.saves.fortitude.dc.value},traits:["attack","impulse","kineticist"],extraRollNotes:[{text:game.i18n.localize("PF2E.Actions.Grapple.Notes.criticalSuccess"),outcome:["criticalSuccess"]},{text:game.i18n.localize("PF2E.Actions.Grapple.Notes.success"),outcome:["success"]},{text:game.i18n.localize("PF2E.Actions.Grapple.Notes.failure"),outcome:["failure"]},{text:game.i18n.localize("PF2E.Actions.Grapple.Notes.criticalFailure"),outcome:["criticalFailure"]}]})}n(tn,"sandSnatcher");var Mt="<strong>Spike Skin</strong> effect",qa="Compendium.idleuh.effects.Item.aJWj25WLTiG67a1y",Wa="Compendium.pf2e.feats-srd.Item.9p28s0zg4Vv4r5i2";function rn(e){return e?.itemTypes.effect.find(t=>t.sourceId===qa)}n(rn,"getEffect");function nn(){ui.notifications.warn(`You need to select an actor with the ${Mt}.`)}n(nn,"effectMissing");async function on(e){let t=rn(e);if(!t)return nn();let r=t.system.duration.value;if(r<=0){ui.notifications.warn(`The ${Mt} is already expired on the selected actor.`);return}await t.update({"system.duration.value":Math.max(0,r-1)}),ui.notifications.info(`The ${Mt} duration has been reduced by 1 minute.`)}n(on,"spikeSkinDuration");async function an(e,t){if(!rn(e))return nn();let o=await fromUuid(Wa),i=`${Math.floor((e.level-8)/2)*2+2}[piercing]`;await Pe({actor:e,token:t,item:o,formula:i})}n(an,"spikeSkinDamage");var _t="Compendium.idleuh.effects.Item.MqgbuaqGMJ92VRze",Ct="Compendium.idleuh.effects.Item.Lz5hNf4dbXKjDWBa",Dt="Compendium.idleuh.effects.Item.8BxBB5ztfRI9vFfZ",sn="Compendium.pf2e.conditionitems.Item.AJh5ex99aV6VTggg";async function un(e,t,r){if(e.ctrlKey){game.user.isGM?jt():pe({type:"clean-exploit-vulnerability"}),ui.notifications.notify("All effects are being removed.");return}let o=game.user.targets,[i]=o,a=i?.actor;if(!t||!t.isOwner||!t.isOfType("character")||o.size!==1||!a||!a.isOfType("creature")){ui.notifications.warn("You must select a character token you own and target another one.");return}let u=Ne(t);if(!u)return;let c="action:recall-knowledge",f=getDcByLevel(a.level),l=t.getRollOptions(["all","skill-check","Esoteric"]);l.push(c),l.push("secret");let m=a.system.attributes.weaknesses,p=m.reduce((k,le)=>le.value>k?le.value:k,0),y=m.filter(k=>k.value===p).map(k=>k.type),d=y.join(", "),h=d?`<strong>[ ${d} ]</strong> = ${p}<br>`:"",O=(await u.roll({extraRollOptions:l,dc:{value:f},rollMode:"roll",label:'<span class="pf2-icon">A</span> <b>Exploit Vulnerability</b> <span">(Esoteric Check)</span>',extraRollNotes:[{outcome:["criticalFailure"],text:"<strong>Critical Failure</strong> You couldn't remember the right object to use and become distracted while you rummage through your esoterica. You become flat-footed until the beginning of your next turn."},{outcome:["failure"],text:"<strong>Failure</strong> Failing to recall a salient weakness about the creature, you instead attempt to exploit a more personal vulnerability. You can exploit only the creature's personal antithesis. Your unarmed and weapon Strikes against the creature also become magical if they weren't already."},{outcome:["success"],text:`${h}<strong>Success</strong> You recall an important fact about the creature, learning its highest weakness (or one of its highest weaknesses, if it has multiple with the same value) but not its other weaknesses, resistances, or immunities. You can exploit either the creature's mortal weakness or personal antithesis. Your unarmed and weapon Strikes against the creature also become magical if they weren't already.`},{outcome:["criticalSuccess"],text:`${h}<strong>Critical Success</strong> You remember the creature's weaknesses, and as you empower your esoterica, you have a flash of insight that grants even more knowledge about the creature. You learn all of the creature's resistances, weaknesses, and immunities, including the amounts of the resistances and weaknesses and any unusual weaknesses or vulnerabilities, such as what spells will pass through a golem's antimagic. You can exploit either the creature's mortal weakness or personal antithesis (see the Exploit Vulnerability class feature). Your unarmed and weapon Strikes against the creature also become magical if they weren't already.`}]})).degreeOfSuccess,x=w(t,_t,["effect"]);if(O>=1&&!x){let k=(await fromUuid(_t)).toObject();t.createEmbeddedDocuments("Item",[k])}else if(O<1&&(x?.delete(),!Rt(t,sn,["condition"]))){let le=(await fromUuid(sn)).toObject();t.createEmbeddedDocuments("Item",[le])}let j=y.filter(k=>!r.includes(k)),S={type:"exploit-vulnerability",actorId:t.id,targetId:i.id,vulnerability:j.length?p:0,success:O};game.user.isGM?Nt(S):pe(S)}n(un,"exploitVulnerability");async function Nt({actorId:e,targetId:t,vulnerability:r,success:o}){let i=game.actors.get(e),a=canvas.tokens.get(t)?.actor;if(!i||!a)return;let u=2+Math.floor(i.level/2),c=o>1&&r>=u,f=(await fromUuid(Dt)).toObject(),l={key:"Weakness",type:"piercing",value:r,predicate:["origin:effect:exploit-vulnerability"]};f.system.rules.push(l);for(let m of canvas.tokens.placeables){let p=m.actor;if(!p||p===i)continue;let y=w(p,Ct,["effect"]),d=w(p,Dt,["effect"]);if(await y?.delete(),await d?.delete(),!(o<1))if(p===a){let h=(await fromUuid(Ct)).toObject(),v={key:"Weakness",type:"piercing",value:c?r:u,predicate:["origin:effect:exploit-vulnerability"]};h.system.rules.push(v),p.createEmbeddedDocuments("Item",[h])}else c&&p.id===a.id&&p.createEmbeddedDocuments("Item",[f])}}n(Nt,"exploitVulnerabilityGM");function jt(){for(let e of canvas.tokens.placeables){let t=e.actor;if(!t)continue;let r=w(t,_t,["effect"]),o=w(t,Ct,["effect"]),i=w(t,Dt,["effect"]);r?.delete(),o?.delete(),i?.delete()}}n(jt,"cleanExploitVulnerabilityGM");Ut("idleuh");Hooks.once("init",()=>{game.modules.get(b.id).api={macros:{exploitVulnerability:un,esotericCheck:Gr,groupPerception:en,identify:Hr,ripImaginarium:Vr,marshalInspiration:Jr,sandSnatcher:tn,extractElement:Yr,thermalNimbus:Zr,spikeSkinDuration:on,spikeSkinDamage:an}},game.settings.register(b.id,"jquery",{name:"Disable JQuery Animations",hint:"Will cancel sliding animations on different parts of the UI.",type:Boolean,default:!1,config:!0,scope:"client",onChange:cn})});Hooks.once("ready",()=>{game.user.isGM&&Bt(Ya),Ue("jquery")&&cn(!0)});function cn(e){jQuery.fx.off=e}n(cn,"setJQueryFx");function Ya(e){e.type==="exploit-vulnerability"?Nt(e):e.type==="clean-exploit-vulnerability"&&jt()}n(Ya,"onPacketReceived");})();
//# sourceMappingURL=main.js.map
