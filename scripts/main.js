(()=>{var Le=Object.defineProperty;var fn=(e,t,r)=>t in e?Le(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;var n=(e,t)=>Le(e,"name",{value:t,configurable:!0});var ln=(e,t)=>{for(var r in t)Le(e,r,{get:t[r],enumerable:!0})};var H=(e,t,r)=>(fn(e,typeof t!="symbol"?t+"":t,r),r),pn=(e,t,r)=>{if(!t.has(e))throw TypeError("Cannot "+r)};var Y=(e,t,r)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,r)};var S=(e,t,r)=>(pn(e,t,"access private method"),r);function Dt(e,t){return e?t?`@UUID[${e}]{${t}}`:`@UUID[${e}]`:`<span style="background: #DDD; padding: 1px 4px; border: 1px solid var(--color-border-dark-tertiary);
border-radius: 2px; white-space: nowrap; word-break: break-all;">${t}</span>`}n(Dt,"chatUUID");function jt(e){return e.getFlag("core","sourceId")}n(jt,"getSourceId");function mn(e,t){let r=jt(e);return r?t.includes(r):!1}n(mn,"includesSourceId");function Re(e){return Array.isArray(e)?t=>mn(t,e):t=>jt(t)===e}n(Re,"getSourceIdCondition");var ps=(async()=>{}).constructor;function ze(e,t){if(typeof e!="object")return!1;let r=Reflect.getPrototypeOf(e);for(;r;){if(r.constructor.name===t)return!0;r=Reflect.getPrototypeOf(r)}return!1}n(ze,"isInstanceOf");function V(e,...t){return(Array.isArray(t[0])?t[0]:t).filter(o=>typeof o=="string").join(e)}n(V,"joinStr");function Lt(...e){return`modules/${b.id}/templates/${V("/",e)}.hbs`}n(Lt,"templatePath");function Rt(e,t=[]){let r=typeof t=="string"?[t]:t;return r.length?r.flatMap(o=>e.itemTypes[o]):e.items}n(Rt,"getItems");function zt(e,t,r){return Rt(e,r).some(Re(t))}n(zt,"hasItemWithSourceId");function w(e,t,r){return Rt(e,r).find(Re(t))}n(w,"getItemWithSourceId");function Ut(...e){e.unshift(b.id);let t=typeof e.at(-1)=="object"?e.splice(-1)[0]:void 0;return game.i18n[t?"format":"localize"](V(".",e),t)}n(Ut,"localize");var $e=null,b={get id(){if(!$e)throw new Error("Module id needs to be registered.");return $e},error(e){throw new Error(`[${this.id}] ${e}`)}};function $t(e){$e=e}n($t,"registerModule");function dn(e,t,r,o){let i=typeof t=="string"?t:"info",a=typeof t=="object"?t:typeof r=="object"?r:void 0,u=typeof t=="boolean"?t:typeof r=="boolean"?r:o??!1;ui.notifications.notify(Ut(e,a),i,{permanent:u})}n(dn,"notify");function Ue(e,t,r){dn(e,"error",t,r)}n(Ue,"error");function Ge(e){return game.settings.get(b.id,e)}n(Ge,"getSetting");function Gt(e){game.socket.on(`module.${b.id}`,e)}n(Gt,"socketOn");function me(e){game.socket.emit(`module.${b.id}`,e)}n(me,"socketEmit");var ae={};ln(ae,{_setPath:()=>Oe,add:()=>yn,addProp:()=>xn,allPass:()=>bn,anyPass:()=>kn,ceil:()=>An,chunk:()=>En,clamp:()=>Sn,clone:()=>Mn,compact:()=>_n,concat:()=>Nn,conditional:()=>We,countBy:()=>He,createPipe:()=>Rn,debounce:()=>zn,difference:()=>K,differenceWith:()=>Q,divide:()=>Gn,drop:()=>J,dropFirstBy:()=>Hn,dropLast:()=>Kn,dropLastWhile:()=>Jn,dropWhile:()=>Zn,equals:()=>Ke,evolve:()=>ro,filter:()=>L,find:()=>he,findIndex:()=>xe,findLast:()=>Je,findLastIndex:()=>Xe,first:()=>ve,firstBy:()=>io,flatMap:()=>be,flatMapToObj:()=>et,flatten:()=>M,flattenDeep:()=>U,floor:()=>lo,forEach:()=>G,forEachObj:()=>tt,fromPairs:()=>te,groupBy:()=>rt,hasAtLeast:()=>Ze,identity:()=>po,indexBy:()=>nt,intersection:()=>re,intersectionWith:()=>ne,invert:()=>xo,isArray:()=>ot,isBoolean:()=>bo,isDate:()=>wo,isDefined:()=>it,isEmpty:()=>ko,isError:()=>Io,isFunction:()=>Ao,isNil:()=>Eo,isNonNull:()=>Oo,isNot:()=>So,isNumber:()=>To,isObject:()=>at,isObjectType:()=>Co,isPlainObject:()=>Mo,isPromise:()=>_o,isString:()=>st,isSymbol:()=>No,isTruthy:()=>qe,join:()=>Po,keys:()=>ut,last:()=>Do,length:()=>Lo,map:()=>B,mapKeys:()=>zo,mapToObj:()=>ct,mapValues:()=>Uo,maxBy:()=>ft,meanBy:()=>lt,merge:()=>$o,mergeAll:()=>Bo,mergeDeep:()=>qo,minBy:()=>pt,multiply:()=>Wo,noop:()=>Yo,nthBy:()=>Qo,objOf:()=>Xo,omit:()=>ti,omitBy:()=>ni,once:()=>ii,only:()=>ai,partition:()=>mt,pathOr:()=>ci,pick:()=>li,pickBy:()=>mi,pipe:()=>Ye,prop:()=>gi,purry:()=>s,randomString:()=>hi,range:()=>dt,rankBy:()=>xi,reduce:()=>gt,reject:()=>q,reverse:()=>bi,round:()=>ki,sample:()=>Ii,set:()=>Ei,setPath:()=>Si,shuffle:()=>Ti,sliceString:()=>Mi,sort:()=>yt,sortBy:()=>ht,sortedIndex:()=>Di,sortedIndexBy:()=>xt,sortedIndexWith:()=>vt,sortedLastIndex:()=>Li,sortedLastIndexBy:()=>bt,splice:()=>zi,splitAt:()=>wt,splitWhen:()=>Bi,stringToPath:()=>Hi,subtract:()=>Yi,sumBy:()=>kt,swapIndices:()=>Ki,swapProps:()=>Xi,take:()=>oe,takeFirstBy:()=>ra,takeLastWhile:()=>oa,takeWhile:()=>aa,tap:()=>ua,times:()=>fa,toPairs:()=>ee,type:()=>Be,uniq:()=>_,uniqBy:()=>ma,uniqWith:()=>ie,values:()=>ha,zip:()=>It,zipObj:()=>va,zipWith:()=>wa});var gn=function(e,t,r){if(r||arguments.length===2)for(var o=0,i=t.length,a;o<i;o++)(a||!(o in t))&&(a||(a=Array.prototype.slice.call(t,0,o)),a[o]=t[o]);return e.concat(a||Array.prototype.slice.call(t))};function s(e,t,r){var o=e.length-t.length,i=Array.from(t);if(o===0)return e.apply(void 0,i);if(o===1){var a=n(function(u){return e.apply(void 0,gn([u],i,!1))},"ret");return(r||e.lazy)&&(a.lazy=r||e.lazy,a.lazyArgs=t),a}throw new Error("Wrong number of arguments")}n(s,"purry");function yn(){return s(hn,arguments)}n(yn,"add");function hn(e,t){return e+t}n(hn,"_add");var de=function(){return de=Object.assign||function(e){for(var t,r=1,o=arguments.length;r<o;r++){t=arguments[r];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e},de.apply(this,arguments)};function xn(){return s(vn,arguments)}n(xn,"addProp");function vn(e,t,r){var o;return de(de({},e),(o={},o[t]=r,o))}n(vn,"_addProp");function bn(){return s(wn,arguments)}n(bn,"allPass");function wn(e,t){return t.every(function(r){return r(e)})}n(wn,"_allPass");function kn(){return s(In,arguments)}n(kn,"anyPass");function In(e,t){return t.some(function(r){return r(e)})}n(In,"_anyPass");var Bt=15;function D(e){return function(t,r){if(r===0)return e(t);if(!Number.isInteger(r))throw new TypeError("precision must be an integer: ".concat(r));if(r>Bt||r<-Bt)throw new RangeError("precision must be between -15 and 15");if(Number.isNaN(t)||!Number.isFinite(t))return e(t);var o=Math.pow(10,r);return e(t*o)/o}}n(D,"_withPrecision");function An(){return s(D(Math.ceil),arguments)}n(An,"ceil");function En(){return s(On,arguments)}n(En,"chunk");function On(e,t){for(var r=Array.from({length:Math.ceil(e.length/t)}),o=0;o<r.length;o+=1)r[o]=e.slice(o*t,(o+1)*t);return r}n(On,"_chunk");function Sn(){return s(Tn,arguments)}n(Sn,"clamp");function Tn(e,t){return t.min!=null&&t.min>e?t.min:t.max!=null&&t.max<e?t.max:e}n(Tn,"_clamp");function Be(e){return e===null?"Null":e===void 0?"Undefined":Object.prototype.toString.call(e).slice(8,-1)}n(Be,"type");function Cn(e){return new RegExp(e.source,(e.global?"g":"")+(e.ignoreCase?"i":"")+(e.multiline?"m":"")+(e.sticky?"y":"")+(e.unicode?"u":""))}n(Cn,"_cloneRegExp");function qt(e,t,r,o){function i(a){for(var u=t.length,c=0;c<u;){if(e===t[c])return r[c];c+=1}t[c+1]=e,r[c+1]=a;for(var f in e)a[f]=o?qt(e[f],t,r,!0):e[f];return a}switch(n(i,"copy"),Be(e)){case"Object":return i({});case"Array":return i([]);case"Date":return new Date(e.valueOf());case"RegExp":return Cn(e);default:return e}}n(qt,"_clone");function Mn(e){return e!=null&&typeof e.clone=="function"?e.clone():qt(e,[],[],!0)}n(Mn,"clone");function qe(e){return!!e}n(qe,"isTruthy");function _n(e){return e.filter(qe)}n(_n,"compact");function Nn(){return s(Pn,arguments)}n(Nn,"concat");function Pn(e,t){return e.concat(t)}n(Pn,"_concat");var Wt=function(e,t,r){if(r||arguments.length===2)for(var o=0,i=t.length,a;o<i;o++)(a||!(o in t))&&(a||(a=Array.prototype.slice.call(t,0,o)),a[o]=t[o]);return e.concat(a||Array.prototype.slice.call(t))};function Ht(e,t,r){var o=Array.from(r),i=o[0],a=o.slice(1);return e(i)?function(u){return t.apply(void 0,Wt([u],o,!1))}:t.apply(void 0,Wt([i],a,!1))}n(Ht,"purryOn");function We(){return Ht(Dn,Fn,arguments)}n(We,"conditional");function Fn(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];for(var o=0,i=t;o<i.length;o++){var a=i[o],u=a[0],c=a[1];if(u(e))return c(e)}throw new Error("conditional: data failed for all cases")}n(Fn,"conditionalImplementation");function Dn(e){if(!Array.isArray(e))return!1;var t=e[0],r=e[1],o=e.slice(2);return typeof t=="function"&&t.length<=1&&typeof r=="function"&&r.length<=1&&o.length===0}n(Dn,"isCase");(function(e){e.defaultCase=function(t){return t===void 0&&(t=jn),[function(){return!0},t]}})(We||(We={}));var jn=n(function(){},"trivialDefaultCase");var Yt=n(function(e){return function(t,r){return t.reduce(function(o,i,a){var u=e?r(i,a,t):r(i);return o+(u?1:0)},0)}},"_countBy");function He(){return s(Yt(!1),arguments)}n(He,"countBy");(function(e){function t(){return s(Yt(!0),arguments)}n(t,"indexed"),e.indexed=t})(He||(He={}));function Ye(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];for(var o=e,i=t.map(function(v){var A=v,x=A.lazy,F=A.lazyArgs;if(x){var E=x.apply(void 0,F||[]);return E.indexed=x.indexed,E.single=x.single,E.index=0,E.items=[],E}return null}),a=0;a<t.length;){var u=t[a],c=i[a];if(!c){o=u(o),a++;continue}for(var f=[],l=a;l<t.length&&i[l];l++)if(f.push(i[l]),i[l].single)break;for(var m=[],p=0,y=o;p<y.length;p++){var d=y[p];if(Vt({item:d,acc:m,lazySeq:f}))break}var h=f[f.length-1];h.single?o=m[0]:o=m,a+=f.length}return o}n(Ye,"pipe");function Vt(e){var t=e.item,r=e.lazySeq,o=e.acc;if(r.length===0)return o.push(t),!1;for(var i={done:!1,hasNext:!1},a=!1,u=0;u<r.length;u++){var c=r[u],f=c.indexed,l=c.index,m=c.items;if(m.push(t),i=f?c(t,l,m):c(t),c.index++,i.hasNext)if(i.hasMany){for(var p=i.next,y=0,d=p;y<d.length;y++){var h=d[y],v=Vt({item:h,acc:o,lazySeq:r.slice(u+1)});if(v)return!0}return!1}else t=i.next;if(!i.hasNext)break;i.done&&(a=!0)}return i.hasNext&&o.push(t),!!a}n(Vt,"_processItem");var Ln=function(e,t,r){if(r||arguments.length===2)for(var o=0,i=t.length,a;o<i;o++)(a||!(o in t))&&(a||(a=Array.prototype.slice.call(t,0,o)),a[o]=t[o]);return e.concat(a||Array.prototype.slice.call(t))};function Rn(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return function(r){return Ye.apply(void 0,Ln([r],e,!1))}}n(Rn,"createPipe");function zn(e,t){var r=t.waitMs,o=t.timing,i=o===void 0?"trailing":o,a=t.maxWaitMs;if(a!==void 0&&r!==void 0&&a<r)throw new Error("debounce: maxWaitMs (".concat(a,") cannot be less than waitMs (").concat(r,")"));var u,c,f,l,m=n(function(){if(f!==void 0){if(c!==void 0){var d=c;c=void 0,clearTimeout(d)}var h=f;f=void 0,l=e.apply(void 0,h)}},"handleInvoke"),p=n(function(){if(u!==void 0){var d=u;u=void 0,clearTimeout(d),f!==void 0&&m()}},"handleCoolDownEnd"),y=n(function(d){f=d,a!==void 0&&c===void 0&&(c=setTimeout(m,a))},"handleDebouncedCall");return{call:function(){for(var d,h=[],v=0;v<arguments.length;v++)h[v]=arguments[v];if(u===void 0)i==="trailing"?y(h):l=e.apply(void 0,h);else{i!=="leading"&&y(h);var A=u;u=void 0,clearTimeout(A)}return u=setTimeout(p,(d=r??a)!==null&&d!==void 0?d:0),l},cancel:function(){if(u!==void 0){var d=u;u=void 0,clearTimeout(d)}if(c!==void 0){var d=c;c=void 0,clearTimeout(d)}f=void 0},flush:function(){return p(),l},get isPending(){return u!==void 0},get cachedValue(){return l}}}n(zn,"debounce");function g(e,t,r){for(var o=[],i=0;i<e.length;i++){var a=e[i],u=r?t(a,i,e):t(a);u.hasMany===!0?o.push.apply(o,u.next):u.hasNext&&o.push(u.next)}return o}n(g,"_reduceLazy");function K(){return s(Un,arguments,K.lazy)}n(K,"difference");function Un(e,t){var r=K.lazy(t);return g(e,r)}n(Un,"_difference");(function(e){function t(r){var o=new Set(r);return function(i){return o.has(i)?{done:!1,hasNext:!1}:{done:!1,hasNext:!0,next:i}}}n(t,"lazy"),e.lazy=t})(K||(K={}));function Q(){return s($n,arguments,Q.lazy)}n(Q,"differenceWith");function $n(e,t,r){var o=Q.lazy(t,r);return g(e,o)}n($n,"_differenceWith");(function(e){function t(r,o){return function(i){return r.every(function(a){return!o(i,a)})?{done:!1,hasNext:!0,next:i}:{done:!1,hasNext:!1}}}n(t,"lazy"),e.lazy=t})(Q||(Q={}));function Gn(){return s(Bn,arguments)}n(Gn,"divide");function Bn(e,t){return e/t}n(Bn,"_divide");function J(){return s(qn,arguments,J.lazy)}n(J,"drop");function qn(e,t){return g(e,J.lazy(t))}n(qn,"_drop");(function(e){function t(r){var o=r;return function(i){return o>0?(o--,{done:!1,hasNext:!1}):{done:!1,hasNext:!0,next:i}}}n(t,"lazy"),e.lazy=t})(J||(J={}));function X(e,t,r){var o;o=[e[r],e[t]],e[t]=o[0],e[r]=o[1]}n(X,"swapInPlace");function ge(e,t){for(var r=Math.floor(e.length/2)-1;r>=0;r--)Kt(e,r,t)}n(ge,"heapify");function ye(e,t,r){var o=e[0];if(!(t(r,o)>=0))return e[0]=r,Kt(e,0,t),o}n(ye,"heapMaybeInsert");function Kt(e,t,r){for(var o=t;o*2+1<e.length;){var i=o*2+1,a=r(e[o],e[i])<0?i:o,u=i+1;if(u<e.length&&r(e[a],e[u])<0&&(a=u),a===o)return;X(e,o,a),o=a}}n(Kt,"heapSiftDown");var j=function(e,t,r){if(r||arguments.length===2)for(var o=0,i=t.length,a;o<i;o++)(a||!(o in t))&&(a||(a=Array.prototype.slice.call(t,0,o)),a[o]=t[o]);return e.concat(a||Array.prototype.slice.call(t))},Jt={asc:function(e,t){return e>t},desc:function(e,t){return e<t}};function Z(e,t){var r=Array.isArray(t)?t:Array.from(t),o=r[0],i=r.slice(1);if(!Xt(o)){var a=Ve.apply(void 0,i);return e(o,a)}var u=Ve.apply(void 0,j([o],i,!1));return function(c){return e(c,u)}}n(Z,"purryOrderRules");function T(e,t){var r=Array.from(t),o=r[0],i=r[1],a=r.slice(2),u,c;return Xt(i)?(u=o,c=j([i],a,!0)):(u=i,c=j([o],a,!0)),Z(function(){for(var f=[],l=0;l<arguments.length;l++)f[l]=arguments[l];return e.apply(void 0,j(j([],f,!1),[u],!1))},c)}n(T,"purryOrderRulesWithArgument");function Ve(e,t){for(var r=[],o=2;o<arguments.length;o++)r[o-2]=arguments[o];var i=typeof e=="function"?e:e[0],a=typeof e=="function"?"asc":e[1],u=Jt[a],c=t===void 0?void 0:Ve.apply(void 0,j([t],r,!1));return function(f,l){var m,p=i(f),y=i(l);return u(p,y)?1:u(y,p)?-1:(m=c?.(f,l))!==null&&m!==void 0?m:0}}n(Ve,"orderRuleComparer");function Xt(e){if(Qt(e))return!0;if(typeof e!="object"||!Array.isArray(e))return!1;var t=e[0],r=e[1],o=e.slice(2);return Qt(t)&&r in Jt&&o.length===0}n(Xt,"isOrderRule");var Qt=n(function(e){return typeof e=="function"&&e.length===1},"isProjection");var Wn=function(e,t,r){if(r||arguments.length===2)for(var o=0,i=t.length,a;o<i;o++)(a||!(o in t))&&(a||(a=Array.prototype.slice.call(t,0,o)),a[o]=t[o]);return e.concat(a||Array.prototype.slice.call(t))};function Hn(){return T(Yn,arguments)}n(Hn,"dropFirstBy");function Yn(e,t,r){if(r>=e.length)return[];if(r<=0)return Wn([],e,!0);var o=e.slice(0,r);ge(o,t);for(var i=[],a=e.slice(r),u=0,c=a;u<c.length;u++){var f=c[u],l=ye(o,t,f);i.push(l??f)}return i}n(Yn,"dropFirstByImplementation");var Vn=function(e,t,r){if(r||arguments.length===2)for(var o=0,i=t.length,a;o<i;o++)(a||!(o in t))&&(a||(a=Array.prototype.slice.call(t,0,o)),a[o]=t[o]);return e.concat(a||Array.prototype.slice.call(t))};function Kn(){return s(Qn,arguments)}n(Kn,"dropLast");function Qn(e,t){var r=Vn([],e,!0);return t>0&&r.splice(-t),r}n(Qn,"_dropLast");function Jn(){return s(Xn,arguments)}n(Jn,"dropLastWhile");function Xn(e,t){for(var r=e.length-1;r>=0;r--)if(!t(e[r]))return e.slice(0,r+1);return[]}n(Xn,"_dropLastWhile");function Zn(){return s(eo,arguments)}n(Zn,"dropWhile");function eo(e,t){for(var r=0;r<e.length;r++)if(!t(e[r]))return e.slice(r);return[]}n(eo,"_dropWhile");var Zt=Array.isArray,er=Object.keys;function Ke(){return s(to,arguments)}n(Ke,"equals");function to(e,t){if(e===t)return!0;if(e&&t&&typeof e=="object"&&typeof t=="object"){var r=Zt(e),o=Zt(t),i=void 0,a,u=void 0;if(r&&o){if(a=e.length,a!==t.length)return!1;for(i=a;i--!==0;)if(!Ke(e[i],t[i]))return!1;return!0}if(r!==o)return!1;var c=e instanceof Date,f=t instanceof Date;if(c!==f)return!1;if(c&&f)return e.getTime()===t.getTime();var l=e instanceof RegExp,m=t instanceof RegExp;if(l!==m)return!1;if(l&&m)return e.toString()===t.toString();var p=er(e);if(a=p.length,a!==er(t).length)return!1;for(i=a;i--!==0;)if(!Object.prototype.hasOwnProperty.call(t,p[i]))return!1;for(i=a;i--!==0;)if(u=p[i],!Ke(e[u],t[u]))return!1;return!0}return e!==e&&t!==t}n(to,"_equals");function ee(e){return Object.entries(e)}n(ee,"toPairs");(function(e){function t(r){return Object.entries(r)}n(t,"strict"),e.strict=t})(ee||(ee={}));var Qe=function(){return Qe=Object.assign||function(e){for(var t,r=1,o=arguments.length;r<o;r++){t=arguments[r];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e},Qe.apply(this,arguments)};function ro(){return s(tr,arguments)}n(ro,"evolve");function tr(e,t){return typeof e!="object"||e===null?e:ee.strict(t).reduce(function(r,o){var i=o[0],a=o[1];return i in r&&(r[i]=typeof a=="function"?a(r[i]):tr(r[i],a)),r},Qe({},e))}n(tr,"_evolve");var k=n(function(e){return e.indexed=!0,e},"_toLazyIndexed");function L(){return s(nr(!1),arguments,L.lazy)}n(L,"filter");var nr=n(function(e){return function(t,r){return g(t,e?L.lazyIndexed(r):L.lazy(r),e)}},"_filter"),rr=n(function(e){return function(t){return function(r,o,i){var a=e?t(r,o,i):t(r);return a?{done:!1,hasNext:!0,next:r}:{done:!1,hasNext:!1}}}},"_lazy");(function(e){function t(){return s(nr(!0),arguments,e.lazyIndexed)}n(t,"indexed"),e.indexed=t,e.lazy=rr(!1),e.lazyIndexed=k(rr(!0))})(L||(L={}));var z=n(function(e){return e.single=!0,e},"_toSingle");function he(){return s(ir(!1),arguments,he.lazy)}n(he,"find");var ir=n(function(e){return function(t,r){return e?t.find(r):t.find(function(o){return r(o)})}},"_find"),or=n(function(e){return function(t){return function(r,o,i){var a=e?t(r,o,i):t(r);return{done:a,hasNext:a,next:r}}}},"_lazy");(function(e){function t(){return s(ir(!0),arguments,e.lazyIndexed)}n(t,"indexed"),e.indexed=t,e.lazy=z(or(!1)),e.lazyIndexed=z(k(or(!0)))})(he||(he={}));function xe(){return s(sr(!1),arguments,xe.lazy)}n(xe,"findIndex");var sr=n(function(e){return function(t,r){return e?t.findIndex(r):t.findIndex(function(o){return r(o)})}},"_findIndex"),ar=n(function(e){return function(t){var r=0;return function(o,i,a){var u=e?t(o,i,a):t(o);return u?{done:!0,hasNext:!0,next:r}:(r++,{done:!1,hasNext:!1})}}},"_lazy");(function(e){function t(){return s(sr(!0),arguments,e.lazyIndexed)}n(t,"indexed"),e.indexed=t,e.lazy=z(ar(!1)),e.lazyIndexed=z(k(ar(!0)))})(xe||(xe={}));function Je(){return s(ur(!1),arguments)}n(Je,"findLast");var ur=n(function(e){return function(t,r){for(var o=t.length-1;o>=0;o--)if(e?r(t[o],o,t):r(t[o]))return t[o]}},"_findLast");(function(e){function t(){return s(ur(!0),arguments)}n(t,"indexed"),e.indexed=t})(Je||(Je={}));function Xe(){return s(cr(!1),arguments)}n(Xe,"findLastIndex");var cr=n(function(e){return function(t,r){for(var o=t.length-1;o>=0;o--)if(e?r(t[o],o,t):r(t[o]))return o;return-1}},"_findLastIndex");(function(e){function t(){return s(cr(!0),arguments)}n(t,"indexed"),e.indexed=t})(Xe||(Xe={}));function ve(){return s(no,arguments,ve.lazy)}n(ve,"first");function no(e){var t=e[0];return t}n(no,"_first");(function(e){function t(){return function(r){return{done:!0,hasNext:!0,next:r}}}n(t,"lazy"),e.lazy=t,function(r){r.single=!0}(t=e.lazy||(e.lazy={}))})(ve||(ve={}));function Ze(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return s(oo,e)}n(Ze,"hasAtLeast");var oo=n(function(e,t){return e.length>=t},"hasAtLeastImplementation");function io(){return Z(ao,arguments)}n(io,"firstBy");function ao(e,t){var r=e[0];if(!Ze(e,2))return r;for(var o=e.slice(1),i=0,a=o;i<a.length;i++){var u=a[i];t(u,r)<0&&(r=u)}return r}n(ao,"firstByImplementation");function M(){return s(so,arguments,M.lazy)}n(M,"flatten");function so(e){return g(e,M.lazy())}n(so,"_flatten");(function(e){function t(){return function(r){return Array.isArray(r)?{done:!1,hasNext:!0,hasMany:!0,next:r}:{done:!1,hasNext:!0,next:r}}}n(t,"lazy"),e.lazy=t})(M||(M={}));function be(){return s(uo,arguments,be.lazy)}n(be,"flatMap");function uo(e,t){return M(e.map(function(r){return t(r)}))}n(uo,"_flatMap");(function(e){function t(r){return function(o){var i=r(o);return Array.isArray(i)?{done:!1,hasNext:!0,hasMany:!0,next:i}:{done:!1,hasNext:!0,next:i}}}n(t,"lazy"),e.lazy=t})(be||(be={}));function et(){return s(fr(!1),arguments)}n(et,"flatMapToObj");var fr=n(function(e){return function(t,r){return t.reduce(function(o,i,a){var u=e?r(i,a,t):r(i);return u.forEach(function(c){var f=c[0],l=c[1];o[f]=l}),o},{})}},"_flatMapToObj");(function(e){function t(){return s(fr(!0),arguments)}n(t,"indexed"),e.indexed=t})(et||(et={}));function U(){return s(co,arguments,U.lazy)}n(U,"flattenDeep");function co(e){return g(e,U.lazy())}n(co,"_flattenDeep");function fo(e){if(!Array.isArray(e))return e;var t=[];return e.forEach(function(r){Array.isArray(r)?t.push.apply(t,U(r)):t.push(r)}),t}n(fo,"_flattenDeepValue");(function(e){function t(){return function(r){var o=fo(r);return Array.isArray(o)?{done:!1,hasNext:!0,hasMany:!0,next:o}:{done:!1,hasNext:!0,next:o}}}n(t,"lazy"),e.lazy=t})(U||(U={}));function lo(){return s(D(Math.floor),arguments)}n(lo,"floor");function G(){return s(pr(!1),arguments,G.lazy)}n(G,"forEach");var pr=n(function(e){return function(t,r){return g(t,e?G.lazyIndexed(r):G.lazy(r),e)}},"_forEach"),lr=n(function(e){return function(t){return function(r,o,i){return e?t(r,o,i):t(r),{done:!1,hasNext:!0,next:r}}}},"_lazy");(function(e){function t(){return s(pr(!0),arguments,e.lazyIndexed)}n(t,"indexed"),e.indexed=t,e.lazy=lr(!1),e.lazyIndexed=k(lr(!0))})(G||(G={}));function tt(){return s(mr(!1),arguments)}n(tt,"forEachObj");var mr=n(function(e){return function(t,r){for(var o in t)if(Object.prototype.hasOwnProperty.call(t,o)){var i=t[o];e?r(i,o,t):r(i)}return t}},"_forEachObj");(function(e){function t(){return s(mr(!0),arguments)}n(t,"indexed"),e.indexed=t})(tt||(tt={}));function te(e){for(var t={},r=0,o=e;r<o.length;r++){var i=o[r],a=i[0],u=i[1];t[a]=u}return t}n(te,"fromPairs");(function(e){e.strict=e})(te||(te={}));function rt(){return s(dr(!1),arguments)}n(rt,"groupBy");var dr=n(function(e){return function(t,r){var o={};return t.forEach(function(i,a){var u=e?r(i,a,t):r(i);if(u!==void 0){var c=String(u);o[c]||(o[c]=[]),o[c].push(i)}}),o}},"_groupBy");(function(e){function t(){return s(dr(!0),arguments)}n(t,"indexed"),e.indexed=t,e.strict=e})(rt||(rt={}));function po(e){return e}n(po,"identity");function nt(){return s(gr(!1),arguments)}n(nt,"indexBy");var gr=n(function(e){return function(t,r){return t.reduce(function(o,i,a){var u=e?r(i,a,t):r(i),c=String(u);return o[c]=i,o},{})}},"_indexBy");function mo(){return s(go,arguments)}n(mo,"indexByStrict");var go=n(function(e,t){return e.reduce(function(r,o){var i=t(o);return r[i]=o,r},{})},"_indexByStrict");(function(e){function t(){return s(gr(!0),arguments)}n(t,"indexed"),e.indexed=t,e.strict=mo})(nt||(nt={}));function re(){return s(yo,arguments,re.lazy)}n(re,"intersection");function yo(e,t){var r=re.lazy(t);return g(e,r)}n(yo,"_intersection");(function(e){function t(r){return function(o){var i=new Set(r);return i.has(o)?{done:!1,hasNext:!0,next:o}:{done:!1,hasNext:!1}}}n(t,"lazy"),e.lazy=t})(re||(re={}));function ne(){return s(ho,arguments,ne.lazy)}n(ne,"intersectionWith");function ho(e,t,r){var o=ne.lazy(t,r);return g(e,o)}n(ho,"_intersectionWith");(function(e){function t(r,o){return function(i){return r.some(function(a){return o(i,a)})?{done:!1,hasNext:!0,next:i}:{done:!1,hasNext:!1}}}n(t,"lazy"),e.lazy=t})(ne||(ne={}));function xo(){return s(vo,arguments)}n(xo,"invert");function vo(e){var t={};for(var r in e)t[e[r]]=r;return t}n(vo,"_invert");function ot(e){return Array.isArray(e)}n(ot,"isArray");function bo(e){return typeof e=="boolean"}n(bo,"isBoolean");function wo(e){return e instanceof Date}n(wo,"isDate");function it(e){return typeof e<"u"&&e!==null}n(it,"isDefined");(function(e){function t(r){return r!==void 0}n(t,"strict"),e.strict=t})(it||(it={}));function at(e){return!!e&&!Array.isArray(e)&&typeof e=="object"}n(at,"isObject");function st(e){return typeof e=="string"}n(st,"isString");function ko(e){return e===void 0?!0:ot(e)||st(e)?e.length===0:at(e)?Object.keys(e).length===0:!1}n(ko,"isEmpty");function Io(e){return e instanceof Error}n(Io,"isError");function Ao(e){return typeof e=="function"}n(Ao,"isFunction");function Eo(e){return e==null}n(Eo,"isNil");function Oo(e){return e!==null}n(Oo,"isNonNull");function So(e){return function(t){return!e(t)}}n(So,"isNot");function To(e){return typeof e=="number"&&!isNaN(e)}n(To,"isNumber");var Co=n(function(e){return typeof e=="object"&&e!==null},"isObjectType");function Mo(e){if(typeof e!="object"||e===null)return!1;var t=Object.getPrototypeOf(e);return t===null||t===Object.prototype}n(Mo,"isPlainObject");function _o(e){return e instanceof Promise}n(_o,"isPromise");function No(e){return typeof e=="symbol"}n(No,"isSymbol");function Po(){return s(Fo,arguments)}n(Po,"join");var Fo=n(function(e,t){return e.join(t)},"joinImplementation");function ut(e){return Object.keys(e)}n(ut,"keys");(function(e){e.strict=e})(ut||(ut={}));function Do(){return s(jo,arguments)}n(Do,"last");function jo(e){return e[e.length-1]}n(jo,"_last");function Lo(){return s(Ro,arguments)}n(Lo,"length");function Ro(e){return"length"in e?e.length:Array.from(e).length}n(Ro,"_length");function B(){return s(hr(!1),arguments,B.lazy)}n(B,"map");var hr=n(function(e){return function(t,r){return g(t,e?B.lazyIndexed(r):B.lazy(r),e)}},"_map"),yr=n(function(e){return function(t){return function(r,o,i){return{done:!1,hasNext:!0,next:e?t(r,o,i):t(r)}}}},"_lazy");(function(e){function t(){return s(hr(!0),arguments,e.lazyIndexed)}n(t,"indexed"),e.indexed=t,e.lazy=yr(!1),e.lazyIndexed=k(yr(!0)),e.strict=e})(B||(B={}));function zo(e,t){return arguments.length===1?function(r){return xr(r,e)}:xr(e,t)}n(zo,"mapKeys");function xr(e,t){return Object.keys(e).reduce(function(r,o){return r[t(o,e[o])]=e[o],r},{})}n(xr,"_mapKeys");function ct(){return s(vr(!1),arguments)}n(ct,"mapToObj");var vr=n(function(e){return function(t,r){return t.reduce(function(o,i,a){var u=e?r(i,a,t):r(i),c=u[0],f=u[1];return o[c]=f,o},{})}},"_mapToObj");(function(e){function t(){return s(vr(!0),arguments)}n(t,"indexed"),e.indexed=t})(ct||(ct={}));function Uo(e,t){return arguments.length===1?function(r){return br(r,e)}:br(e,t)}n(Uo,"mapValues");function br(e,t){return Object.keys(e).reduce(function(r,o){return r[o]=t(e[o],o),r},{})}n(br,"_mapValues");var wr=n(function(e){return function(t,r){var o=void 0,i=void 0;return t.forEach(function(a,u){var c=e?r(a,u,t):r(a);(i===void 0||c>i)&&(o=a,i=c)}),o}},"_maxBy");function ft(){return s(wr(!1),arguments)}n(ft,"maxBy");(function(e){function t(){return s(wr(!0),arguments)}n(t,"indexed"),e.indexed=t})(ft||(ft={}));var kr=n(function(e){return function(t,r){if(t.length===0)return NaN;var o=0;return t.forEach(function(i,a){o+=e?r(i,a,t):r(i)}),o/t.length}},"_meanBy");function lt(){return s(kr(!1),arguments)}n(lt,"meanBy");(function(e){function t(){return s(kr(!0),arguments)}n(t,"indexed"),e.indexed=t})(lt||(lt={}));function $o(){return s(Go,arguments)}n($o,"merge");function Go(e,t){return Object.assign({},e,t)}n(Go,"_merge");var we=function(){return we=Object.assign||function(e){for(var t,r=1,o=arguments.length;r<o;r++){t=arguments[r];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e},we.apply(this,arguments)};function Bo(e){return e.reduce(function(t,r){return we(we({},t),r)},{})}n(Bo,"mergeAll");var ke=function(){return ke=Object.assign||function(e){for(var t,r=1,o=arguments.length;r<o;r++){t=arguments[r];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e},ke.apply(this,arguments)};function qo(){return s(Ar,arguments)}n(qo,"mergeDeep");function Ar(e,t){var r=ke(ke({},e),t);for(var o in t)if(o in e){var i=e[o];if(Ir(i)){var a=t[o];Ir(a)&&(r[o]=Ar(i,a))}}return r}n(Ar,"mergeDeepImplementation");function Ir(e){return typeof e=="object"&&e!==null&&Object.getPrototypeOf(e)===Object.prototype}n(Ir,"isRecord");var Er=n(function(e){return function(t,r){var o=void 0,i=void 0;return t.forEach(function(a,u){var c=e?r(a,u,t):r(a);(i===void 0||c<i)&&(o=a,i=c)}),o}},"_minBy");function pt(){return s(Er(!1),arguments)}n(pt,"minBy");(function(e){function t(){return s(Er(!0),arguments)}n(t,"indexed"),e.indexed=t})(pt||(pt={}));function Wo(){return s(Ho,arguments)}n(Wo,"multiply");function Ho(e,t){return e*t}n(Ho,"_multiply");var Yo=n(function(){},"noop");var Vo=function(e,t,r){if(r||arguments.length===2)for(var o=0,i=t.length,a;o<i;o++)(a||!(o in t))&&(a||(a=Array.prototype.slice.call(t,0,o)),a[o]=t[o]);return e.concat(a||Array.prototype.slice.call(t))},Or=n(function(e,t,r){return t<0||t>=e.length?void 0:Sr(Vo([],e,!0),0,e.length-1,t,r)},"quickSelect");function Sr(e,t,r,o,i){if(t===r)return e[t];var a=Ko(e,t,r,i);return o===a?e[o]:Sr(e,o<a?t:a+1,o<a?a-1:r,o,i)}n(Sr,"quickSelectImplementation");function Ko(e,t,r,o){for(var i=e[r],a=t,u=t;u<r;u++)o(e[u],i)<0&&(X(e,a,u),a++);return X(e,a,r),a}n(Ko,"partition");function Qo(){return T(Jo,arguments)}n(Qo,"nthBy");var Jo=n(function(e,t,r){return Or(e,r>=0?r:e.length+r,t)},"nthByImplementation");function Xo(){return s(Zo,arguments)}n(Xo,"objOf");function Zo(e,t){var r;return r={},r[t]=e,r}n(Zo,"_objOf");var Ie=function(){return Ie=Object.assign||function(e){for(var t,r=1,o=arguments.length;r<o;r++){t=arguments[r];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e},Ie.apply(this,arguments)},ei=function(e,t){var r={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(r[o]=e[o]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,o=Object.getOwnPropertySymbols(e);i<o.length;i++)t.indexOf(o[i])<0&&Object.prototype.propertyIsEnumerable.call(e,o[i])&&(r[o[i]]=e[o[i]]);return r};function ti(){return s(ri,arguments)}n(ti,"omit");function ri(e,t){if(t.length===0)return Ie({},e);if(t.length===1){var r=t[0],o=e,i=r,a=o[i],u=ei(o,[typeof i=="symbol"?i:i+""]);return u}if(!t.some(function(f){return f in e}))return Ie({},e);var c=new Set(t);return te(Object.entries(e).filter(function(f){var l=f[0];return!c.has(l)}))}n(ri,"_omit");function ni(){return s(oi,arguments)}n(ni,"omitBy");function oi(e,t){return Object.keys(e).reduce(function(r,o){return t(e[o],o)||(r[o]=e[o]),r},{})}n(oi,"_omitBy");function ii(e){var t=!1,r;return function(){return t||(r=e(),t=!0),r}}n(ii,"once");function ai(){return s(si,arguments)}n(ai,"only");function si(e){if(e.length===1)return e[0]}n(si,"_only");function mt(){return s(Tr(!1),arguments)}n(mt,"partition");var Tr=n(function(e){return function(t,r){var o=[[],[]];return t.forEach(function(i,a){var u=e?r(i,a,t):r(i);o[u?0:1].push(i)}),o}},"_partition");(function(e){function t(){return s(Tr(!0),arguments)}n(t,"indexed"),e.indexed=t})(mt||(mt={}));function ci(){return s(fi,arguments)}n(ci,"pathOr");function fi(e,t,r){for(var o=e,i=0,a=t;i<a.length;i++){var u=a[i];if(o==null||o[u]==null)return r;o=o[u]}return o}n(fi,"_pathOr");function li(){return s(pi,arguments)}n(li,"pick");function pi(e,t){return e==null?{}:t.reduce(function(r,o){return o in e&&(r[o]=e[o]),r},{})}n(pi,"_pick");function mi(){return s(di,arguments)}n(mi,"pickBy");function di(e,t){return e==null?{}:Object.keys(e).reduce(function(r,o){return t(e[o],o)&&(r[o]=e[o]),r},{})}n(di,"_pickBy");var gi=n(function(e){return function(t){var r=e,o=t[r];return o}},"prop");function dt(){return s(yi,arguments)}n(dt,"range");function yi(e,t){for(var r=[],o=e;o<t;o++)r.push(o);return r}n(yi,"_range");function hi(e){var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",r=n(function(){return t[Math.floor(Math.random()*t.length)]},"randomChar");return dt(0,e).reduce(function(o){return o+r()},"")}n(hi,"randomString");function xi(){return T(vi,arguments)}n(xi,"rankBy");function vi(e,t,r){for(var o=0,i=0,a=e;i<a.length;i++){var u=a[i];t(r,u)>0&&o++}return o}n(vi,"rankByImplementation");function gt(){return s(Cr(!1),arguments)}n(gt,"reduce");var Cr=n(function(e){return function(t,r,o){return t.reduce(function(i,a,u){return e?r(i,a,u,t):r(i,a)},o)}},"_reduce");(function(e){function t(){return s(Cr(!0),arguments)}n(t,"indexed"),e.indexed=t})(gt||(gt={}));function q(){return s(_r(!1),arguments,q.lazy)}n(q,"reject");var _r=n(function(e){return function(t,r){return g(t,e?q.lazyIndexed(r):q.lazy(r),e)}},"_reject"),Mr=n(function(e){return function(t){return function(r,o,i){var a=e?t(r,o,i):t(r);return a?{done:!1,hasNext:!1}:{done:!1,hasNext:!0,next:r}}}},"_lazy");(function(e){function t(){return s(_r(!0),arguments,e.lazyIndexed)}n(t,"indexed"),e.indexed=t,e.lazy=Mr(!1),e.lazyIndexed=k(Mr(!0))})(q||(q={}));function bi(){return s(wi,arguments)}n(bi,"reverse");function wi(e){return e.slice().reverse()}n(wi,"_reverse");function ki(){return s(D(Math.round),arguments)}n(ki,"round");function Ii(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return s(Ai,e)}n(Ii,"sample");function Ai(e,t){if(t<0)throw new RangeError("sampleSize must cannot be negative: ".concat(t));if(!Number.isInteger(t))throw new TypeError("sampleSize must be an integer: ".concat(t));if(t>=e.length)return e;if(t===0)return[];for(var r=Math.min(t,e.length-t),o=new Set;o.size<r;){var i=Math.floor(Math.random()*e.length);o.add(i)}return t===r?Array.from(o).sort(function(a,u){return a-u}).map(function(a){return e[a]}):e.filter(function(a,u){return!o.has(u)})}n(Ai,"sampleImplementation");var Ae=function(){return Ae=Object.assign||function(e){for(var t,r=1,o=arguments.length;r<o;r++){t=arguments[r];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e},Ae.apply(this,arguments)};function Ei(){return s(Oi,arguments)}n(Ei,"set");function Oi(e,t,r){var o;return Ae(Ae({},e),(o={},o[t]=r,o))}n(Oi,"_set");var Ee=function(){return Ee=Object.assign||function(e){for(var t,r=1,o=arguments.length;r<o;r++){t=arguments[r];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e},Ee.apply(this,arguments)};function Si(){return s(Oe,arguments)}n(Si,"setPath");function Oe(e,t,r){var o;return t.length===0?r:Array.isArray(e)?e.map(function(i,a){return a===t[0]?Oe(i,t.slice(1),r):i}):Ee(Ee({},e),(o={},o[t[0]]=Oe(e[t[0]],t.slice(1),r),o))}n(Oe,"_setPath");function Ti(){return s(Ci,arguments)}n(Ti,"shuffle");function Ci(e){for(var t=e.slice(),r=0;r<e.length;r+=1){var o=r+Math.floor(Math.random()*(e.length-r)),i=t[o];t[o]=t[r],t[r]=i}return t}n(Ci,"_shuffle");var Mi=n(function(e,t){return function(r){return r.slice(e,t)}},"sliceString");var _i=function(e,t,r){if(r||arguments.length===2)for(var o=0,i=t.length,a;o<i;o++)(a||!(o in t))&&(a||(a=Array.prototype.slice.call(t,0,o)),a[o]=t[o]);return e.concat(a||Array.prototype.slice.call(t))};function yt(){return s(Ni,arguments)}n(yt,"sort");function Ni(e,t){var r=_i([],e,!0);return r.sort(t),r}n(Ni,"_sort");(function(e){e.strict=e})(yt||(yt={}));var Pi=function(e,t,r){if(r||arguments.length===2)for(var o=0,i=t.length,a;o<i;o++)(a||!(o in t))&&(a||(a=Array.prototype.slice.call(t,0,o)),a[o]=t[o]);return e.concat(a||Array.prototype.slice.call(t))};function ht(){return Z(Fi,arguments)}n(ht,"sortBy");var Fi=n(function(e,t){return Pi([],e,!0).sort(t)},"_sortBy");(function(e){e.strict=e})(ht||(ht={}));function O(e,t){for(var r=0,o=e.length;r<o;){var i=r+o>>>1,a=e[i];t(a,i)?r=i+1:o=i}return o}n(O,"_binarySearchCutoffIndex");function Di(){return s(ji,arguments)}n(Di,"sortedIndex");var ji=n(function(e,t){return O(e,function(r){return r<t})},"sortedIndexImplementation");function xt(){return s(Nr,arguments)}n(xt,"sortedIndexBy");(function(e){function t(){return s(Nr,arguments)}n(t,"indexed"),e.indexed=t})(xt||(xt={}));function Nr(e,t,r){var o=r(t);return O(e,function(i,a){return r(i,a)<o})}n(Nr,"sortedIndexByImplementation");function vt(){return s(O,arguments)}n(vt,"sortedIndexWith");(function(e){function t(){return s(O,arguments)}n(t,"indexed"),e.indexed=t})(vt||(vt={}));function Li(){return s(Ri,arguments)}n(Li,"sortedLastIndex");var Ri=n(function(e,t){return O(e,function(r){return r<=t})},"sortedLastIndexImplementation");function bt(){return s(Pr,arguments)}n(bt,"sortedLastIndexBy");(function(e){function t(){return s(Pr,arguments)}n(t,"indexed"),e.indexed=t})(bt||(bt={}));function Pr(e,t,r){var o=r(t);return O(e,function(i,a){return r(i,a)<=o})}n(Pr,"sortedLastIndexByImplementation");var Fr=function(e,t,r){if(r||arguments.length===2)for(var o=0,i=t.length,a;o<i;o++)(a||!(o in t))&&(a||(a=Array.prototype.slice.call(t,0,o)),a[o]=t[o]);return e.concat(a||Array.prototype.slice.call(t))};function zi(){return s(Ui,arguments)}n(zi,"splice");function Ui(e,t,r,o){var i=Fr([],e,!0);return i.splice.apply(i,Fr([t,r],o,!1)),i}n(Ui,"_splice");var $i=function(e,t,r){if(r||arguments.length===2)for(var o=0,i=t.length,a;o<i;o++)(a||!(o in t))&&(a||(a=Array.prototype.slice.call(t,0,o)),a[o]=t[o]);return e.concat(a||Array.prototype.slice.call(t))};function wt(){return s(Gi,arguments)}n(wt,"splitAt");function Gi(e,t){var r=$i([],e,!0),o=r.splice(t);return[r,o]}n(Gi,"_splitAt");function Bi(){return s(qi,arguments)}n(Bi,"splitWhen");function qi(e,t){for(var r=0;r<e.length;r++)if(t(e[r]))return wt(e,r);return[e,[]]}n(qi,"_splitWhen");var Wi=function(e,t,r){if(r||arguments.length===2)for(var o=0,i=t.length,a;o<i;o++)(a||!(o in t))&&(a||(a=Array.prototype.slice.call(t,0,o)),a[o]=t[o]);return e.concat(a||Array.prototype.slice.call(t))};function Hi(e){return Dr(e)}n(Hi,"stringToPath");function Dr(e){var t;if(e.length===0)return[];var r=(t=e.match(/^\[(.+?)\](.*)$/))!==null&&t!==void 0?t:e.match(/^\.?([^.[\]]+)(.*)$/);if(r){var o=r[1],i=r[2];return Wi([o],Dr(i),!0)}return[e]}n(Dr,"_stringToPath");function Yi(){return s(Vi,arguments)}n(Yi,"subtract");function Vi(e,t){return e-t}n(Vi,"_subtract");var jr=n(function(e){return function(t,r){var o=0;return t.forEach(function(i,a){var u=e?r(i,a,t):r(i);o+=u}),o}},"_sumBy");function kt(){return s(jr(!1),arguments)}n(kt,"sumBy");(function(e){function t(){return s(jr(!0),arguments)}n(t,"indexed"),e.indexed=t})(kt||(kt={}));function Ki(){return s(Qi,arguments)}n(Ki,"swapIndices");function Qi(e,t,r){return typeof e=="string"?Ji(e,t,r):Lr(e,t,r)}n(Qi,"_swapIndices");function Lr(e,t,r){var o=e.slice();if(isNaN(t)||isNaN(r))return o;var i=t<0?e.length+t:t,a=r<0?e.length+r:r;return i<0||i>e.length||a<0||a>e.length||(o[i]=e[a],o[a]=e[i]),o}n(Lr,"_swapArray");function Ji(e,t,r){var o=Lr(e.split(""),t,r);return o.join("")}n(Ji,"_swapString");var Se=function(){return Se=Object.assign||function(e){for(var t,r=1,o=arguments.length;r<o;r++){t=arguments[r];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e},Se.apply(this,arguments)};function Xi(){return s(Zi,arguments)}n(Xi,"swapProps");function Zi(e,t,r){var o,i=e,a=t,u=i[a],c=r,f=i[c];return Se(Se({},e),(o={},o[t]=f,o[r]=u,o))}n(Zi,"_swapProps");function oe(){return s(ea,arguments,oe.lazy)}n(oe,"take");function ea(e,t){return g(e,oe.lazy(t))}n(ea,"_take");(function(e){function t(r){return function(o){return r===0?{done:!0,hasNext:!1}:(r--,r===0?{done:!0,hasNext:!0,next:o}:{done:!1,hasNext:!0,next:o})}}n(t,"lazy"),e.lazy=t})(oe||(oe={}));var ta=function(e,t,r){if(r||arguments.length===2)for(var o=0,i=t.length,a;o<i;o++)(a||!(o in t))&&(a||(a=Array.prototype.slice.call(t,0,o)),a[o]=t[o]);return e.concat(a||Array.prototype.slice.call(t))};function ra(){return T(na,arguments)}n(ra,"takeFirstBy");function na(e,t,r){if(r<=0)return[];if(r>=e.length)return ta([],e,!0);var o=e.slice(0,r);ge(o,t);for(var i=e.slice(r),a=0,u=i;a<u.length;a++){var c=u[a];ye(o,t,c)}return o}n(na,"takeFirstByImplementation");function oa(){return s(ia,arguments)}n(oa,"takeLastWhile");function ia(e,t){for(var r=e.length-1;r>=0;r--)if(!t(e[r]))return e.slice(r+1);return e.slice()}n(ia,"_takeLastWhile");function aa(){return s(sa,arguments)}n(aa,"takeWhile");function sa(e,t){for(var r=[],o=0,i=e;o<i.length;o++){var a=i[o];if(!t(a))break;r.push(a)}return r}n(sa,"_takeWhile");function ua(){return s(ca,arguments)}n(ua,"tap");function ca(e,t){return t(e),e}n(ca,"_tap");function fa(){return s(la,arguments)}n(fa,"times");function la(e,t){if(e<0)throw new RangeError("n must be a non-negative number");for(var r=[],o=0;o<e;o++)r.push(t(o));return r}n(la,"_times");function _(){return s(pa,arguments,_.lazy)}n(_,"uniq");function pa(e){return g(e,_.lazy())}n(pa,"_uniq");(function(e){function t(){var r=new Set;return function(o){return r.has(o)?{done:!1,hasNext:!1}:(r.add(o),{done:!1,hasNext:!0,next:o})}}n(t,"lazy"),e.lazy=t})(_||(_={}));function ma(){return s(da,arguments,Rr)}n(ma,"uniqBy");function da(e,t){return g(e,Rr(t))}n(da,"_uniqBy");function Rr(e){var t=new Set;return function(r){var o=e(r);return t.has(o)?{done:!1,hasNext:!1}:(t.add(o),{done:!1,hasNext:!0,next:r})}}n(Rr,"lazyUniqBy");function ie(){return s(ga,arguments,ie.lazy)}n(ie,"uniqWith");function ga(e,t){var r=ie.lazy(t);return g(e,r,!0)}n(ga,"_uniqWith");function ya(e){return function(t,r,o){return o&&o.findIndex(function(i){return e(t,i)})===r?{done:!1,hasNext:!0,next:t}:{done:!1,hasNext:!1}}}n(ya,"_lazy");(function(e){e.lazy=k(ya)})(ie||(ie={}));function ha(e){return Object.values(e)}n(ha,"values");function It(){return s(xa,arguments)}n(It,"zip");function xa(e,t){for(var r=e.length>t.length?t.length:e.length,o=[],i=0;i<r;i++)o.push([e[i],t[i]]);return o}n(xa,"_zip");(function(e){e.strict=e})(It||(It={}));function va(){return s(ba,arguments)}n(va,"zipObj");function ba(e,t){for(var r=e.length>t.length?t.length:e.length,o={},i=0;i<r;i++)o[e[i]]=t[i];return o}n(ba,"_zipObj");function wa(){var e=Array.from(arguments);if(typeof e[0]=="function"&&e.length===1)return function(t,r){return At(t,r,e[0])};if(typeof e[0]=="function"&&e.length===2)return function(t){return At(t,e[1],e[0])};if(e.length===3)return At(e[0],e[1],e[2])}n(wa,"zipWith");function At(e,t,r){for(var o=e.length>t.length?t.length:e.length,i=[],a=0;a<o;a++)i.push(r(e[a],t[a]));return i}n(At,"_zipWith");function se(e){return Error(`PF2e System | ${e}`)}n(se,"ErrorPF2e");function ue(e,t){return e.has(t)}n(ue,"setHasElement");var Ia=new Map([["incredibly-easy",-10],["very-easy",-5],["easy",-2],["normal",0],["hard",2],["very-hard",5],["incredibly-hard",10]]),Aa=new Map([[-1,13],[0,14],[1,15],[2,16],[3,18],[4,19],[5,20],[6,22],[7,23],[8,24],[9,26],[10,27],[11,28],[12,30],[13,31],[14,32],[15,34],[16,35],[17,36],[18,38],[19,39],[20,40],[21,42],[22,44],[23,46],[24,48],[25,50]]);function Ce(e,{pwol:t,rarity:r="common"}={}){t??=game.pf2e.settings.variants.pwol.enabled;let o=Aa.get(e)??14;return Te(t?o-Math.max(e,0):o,r)}n(Ce,"calculateDC");function Te(e,t="common"){return Ea(e,Oa(t))}n(Te,"adjustDCByRarity");function Ea(e,t="normal"){return e+(Ia.get(t)??0)}n(Ea,"adjustDC");function Oa(e="common"){switch(e){case"uncommon":return"hard";case"rare":return"very-hard";case"unique":return"incredibly-hard";default:return"normal"}}n(Oa,"rarityToDCAdjustment");var ce=new Set(["arcane","divine","occult","primal"]);var Et=class extends FormApplication{static get defaultOptions(){return{...FormApplication.defaultOptions,id:"identify-item",title:game.i18n.localize("PF2E.identification.Identify"),template:"systems/pf2e/templates/actors/identify-item.hbs",width:"auto",classes:["identify-popup"]}}dcs=Ot(this.object,{pwol:game.pf2e.settings.variants.pwol.enabled,notMatchingTraditionModifier:game.settings.get("pf2e","identifyMagicNotMatchingTraditionModifier")});async getData(){let t=this.object;return{...await super.getData(),isMagic:t.isMagical,isAlchemical:t.isAlchemical,dcs:this.dcs}}activateListeners(t){let r=t[0],o=r.querySelector<HTMLButtonElement>"button.update-identification";o?.addEventListener("click",()=>{this.submit({updateData:{status:o.value}})}),r.querySelector("button.post-skill-checks")?.addEventListener("click",async()=>{let i=this.object,a=i.system.identification.identified.name,u=this.dcs,c=i.isMagical?"identify-magic":i.isAlchemical?"identify-alchemy":"recall-knowledge",f=await renderTemplate("systems/pf2e/templates/actors/identify-item-chat-skill-checks.hbs",{identifiedName:a,action:c,skills:R.omit(u,["dc"]),unidentified:i.system.identification.unidentified,uuid:i.uuid});await ChatMessage.implementation.create({user:game.user.id,content:f})})}async _updateObject(t,r){let o=r.status;if(o==="identified")return this.object.setIdentificationStatus(o)}};n(Et,"IdentifyItemPopup");function Ot(e,{pwol:t=!1,notMatchingTraditionModifier:r}){let o=Ce(e.level,{pwol:t}),i=Sa(e),a=Te(o,i);return e.isMagical?Ta(e,a,r):{crafting:a}}n(Ot,"getItemIdentificationDCs");function Sa(e){return e.traits.has("cursed")?"unique":e.rarity}n(Sa,"getDcRarity");function Ta(e,t,r){let o={occult:t,primal:t,divine:t,arcane:t},i=Ca(e);for(let a of ce)i.size>0&&!i.has(a)&&(o[a]=t+r);return{arcana:o.arcane,nature:o.primal,religion:o.divine,occultism:o.occult}}n(Ta,"getIdentifyMagicDCs");function Ca(e){let t=e.system.traits.value;return new Set(t.filter(r=>ue(ce,r)))}n(Ca,"getMagicTraditions");var rb=["action","check","effect-area"].map(e=>`[data-pf2-${e}]`).join(",");var St=class extends FormApplication{constructor(t,r,o){super(t,r),this.onSubmitCallback=o}async getData(){let[t,r]=this.options.isPurchase?["PF2E.loot.PurchaseLootMessage","PF2E.loot.PurchaseLoot"]:["PF2E.loot.MoveLootMessage","PF2E.loot.MoveLoot"];return{...await super.getData(),quantity:{default:this.options.quantity.default,max:this.options.quantity.max},newStack:this.options.newStack,lockStack:this.options.lockStack,prompt:t,buttonLabel:r}}static get defaultOptions(){return{...FormApplication.defaultOptions,id:"MoveLootPopup",classes:[],title:game.i18n.localize("PF2E.loot.MoveLootPopupTitle"),template:"systems/pf2e/templates/popups/loot/move-loot-popup.hbs",width:"auto",quantity:{default:1,max:1},newStack:!1,lockStack:!1,isPurchase:!1}}async _updateObject(t,r){this.onSubmitCallback(r.quantity,r.newStack)}};n(St,"MoveLootPopup");var Na="tLa4bewBhyqzi6Ow",Pa={1:"RjuupS9xyXDLgyIr",2:"Y7UD64foDbDMV9sx",3:"ZmefGBXGJF3CFDbn",4:"QSQZJ5BC3DeHv153",5:"tjLvRWklAylFhBHQ",6:"4sGIy77COooxhQuC",7:"fomEZZ4MxVVK3uVu",8:"iPki3yuoucnj7bIt",9:"cFHomF3tty8Wi1e5",10:"o1XIHJ4MJyroAHfF"};var Fa={cantripDeck5:"PF2E.Item.Physical.FromSpell.CantripDeck5",scroll:"PF2E.Item.Physical.FromSpell.Scroll",wand:"PF2E.Item.Physical.FromSpell.Wand"},Da={1:"UJWiN0K3jqVjxvKk",2:"vJZ49cgi8szuQXAD",3:"wrDmWkGxmwzYtfiA",4:"Sn7v9SsbEDMUIwrO",5:"5BF7zMnrPYzyigCs",6:"kiXh4SUWKr166ZeM",7:"nmXPj9zuMRQBNT60",8:"Qs8RgNH6thRPv2jt",9:"Fgv722039TVM5JTc"};async function zr(e,{type:t,heightenedLevel:r=e.baseRank,mystified:o=!1,temp:i=!1,itemImg:a,itemName:u=t}){let c=game.packs.find(d=>d.collection==="pf2e.equipment-srd"),f=ja(t,r),l=await c?.getDocument(f??"");if(!ze(l,"ConsumablePF2e"))throw se("Failed to retrieve consumable item");let m={...l.toObject(),_id:null},{traits:p}=m.system;p.value=_([...p.value,...e.traits]),p.rarity=e.rarity,p.value.includes("magical")&&p.value.some(d=>ue(ce,d))&&p.value.splice(p.value.indexOf("magical"),1),p.value.sort(),m.name=La(u,e.name,r);let y=m.system.description.value;return m.system.description.value=(()=>{let d=document.createElement("p");d.append(e.sourceId?`@UUID[${e.sourceId}]{${e.name}}`:e.description);let h=document.createElement("div"),v=document.createElement("hr");return h.append(d,v),v.insertAdjacentHTML("afterend",y),h.innerHTML})(),t!=="cantripDeck5"&&(m.system.spell=e.clone({_id:randomID(),"system.location.heightenedLevel":r},{keepId:!0}).toObject()),o&&(m.system.identification.status="unidentified"),typeof a=="string"&&(m.img=a),i&&(m.system.temporary=!0),m}n(zr,"createConsumableFromSpell");function ja(e,t){switch(e){case"cantripDeck5":return Na;case"scroll":return Pa[t]??null;default:return Da[t]??null}}n(ja,"getIdForSpellConsumable");function La(e,t,r){let o=Fa[e]||`${e} of {name} (Level {level})`;return game.i18n.format(o,{name:t,level:r})}n(La,"getNameForSpellConsumable");var Me={LOWER_BY_TWO:-2,LOWER:-1,INCREASE:1,INCREASE_BY_TWO:2,TO_CRITICAL_FAILURE:"criticalFailure",TO_FAILURE:"failure",TO_SUCCESS:"success",TO_CRITICAL_SUCCESS:"criticalSuccess"},Ur=["criticalFailure","failure","success","criticalSuccess"],Ne,$r,W,_e,P,fe,Pe,Gr,C=class{constructor(t,r,o=null){Y(this,Ne);Y(this,W);Y(this,P);Y(this,Pe);t instanceof Roll?(this.dieResult=(t.isDeterministic?t.terms.find(i=>i instanceof NumericTerm):t.dice.find(i=>i instanceof Die&&i.faces===20))?.total??1,this.rollTotal=t.total):(this.dieResult=t.dieValue,this.rollTotal=t.dieValue+t.modifier),this.dc=typeof r=="number"?{value:r}:r,this.unadjusted=S(this,Pe,Gr).call(this),this.adjustment=S(this,Ne,$r).call(this,this.unadjusted,o),this.value=this.adjustment?S(this,W,_e).call(this,this.adjustment.amount,this.unadjusted):this.unadjusted}},N=C;n(N,"DegreeOfSuccess"),Ne=new WeakSet,$r=n(function(t,r){if(!r)return null;for(let o of["all",...Ur]){let{label:i,amount:a}=r[o]??{};if(a&&i&&!(t===C.CRITICAL_SUCCESS&&a===Me.INCREASE)&&!(t===C.CRITICAL_FAILURE&&a===Me.LOWER)&&(o==="all"||Ur.indexOf(o)===t))return{label:i,amount:a}}return null},"#getDegreeAdjustment"),W=new WeakSet,_e=n(function(t,r){switch(t){case"criticalFailure":return 0;case"failure":return 1;case"success":return 2;case"criticalSuccess":return 3;default:return Math.clamped(r+t,0,3)}},"#adjustDegreeOfSuccess"),P=new WeakSet,fe=n(function(t){return this.dieResult===20?S(this,W,_e).call(this,Me.INCREASE,t):this.dieResult===1?S(this,W,_e).call(this,Me.LOWER,t):t},"#adjustDegreeByDieValue"),Pe=new WeakSet,Gr=n(function(){let t=this.dc.value;return this.rollTotal-t>=10?S(this,P,fe).call(this,C.CRITICAL_SUCCESS):t-this.rollTotal>=10?S(this,P,fe).call(this,C.CRITICAL_FAILURE):this.rollTotal>=t?S(this,P,fe).call(this,C.SUCCESS):S(this,P,fe).call(this,C.FAILURE)},"#calculateDegreeOfSuccess"),H(N,"CRITICAL_FAILURE",0),H(N,"FAILURE",1),H(N,"SUCCESS",2),H(N,"CRITICAL_SUCCESS",3);function Fe(e){let t=["esoteric","esoteric-lore","lore-esoteric"],r=Object.values(e.skills).find(o=>t.includes(o.slug));return r||ui.notifications.warn("This character doesn't have the 'Esoteric' skill"),r}n(Fe,"getEsotericSkill");function Br(e,t){if(!t||!t.isOwner||!t.isOfType("character")){ui.notifications.warn("You must select a character token you own.");return}let r=Fe(t);if(!r)return;let o=new Set,i=[{text:`Can be used to Recall Knowledge regarding haunts, curses 
    and creatures of any type, but can't be used to Recall Knowledge of other topics.`}];r.roll({rollMode:"blindroll",extraRollNotes:i,options:o})}n(Br,"esotericCheck");var Ra="Compendium.pf2e.classfeatures.Item.jyCEC3eC4B6YaGoy",Tt="Compendium.idleuh.effects.Item.9IapmSGjH0hDaVMv",Wr=["bludgeoning","slashing","piercing"],qr=["fire","earth",...Wr];async function Hr(e,t){if(!t?.isOfType("character")){ui.notifications.warn("You need to select a character");return}if(!w(t,Ra,["feat"])){ui.notifications.warn("Your selected character needs to have the feat <strong>Extract Element</strong>");return}let o=game.user.targets.first(),i=o?.actor;if(!i||i===t){ui.notifications.warn("You need to target another actor");return}if(w(i,Tt,["effect"])){ui.notifications.warn("Your target's elements have already been extracted");return}let u=await i.saves.fortitude.roll({event:e,label:"Fortitude Save - Extract Element",dc:{slug:"class",label:"Kineticist DC",value:t.classDC.dc.value}});if(u.degreeOfSuccess>2)return;let c=(await fromUuid(Tt))?.toObject(),f=c.system.rules;c.flags.core.sourceId=Tt;let l={};f.push({key:"Immunity",mode:"remove",type:qr.slice(),predicate:["origin:effect:kinetic-aura"]});let m=!1,p=i.attributes.resistances.filter(({type:x})=>qr.includes(x));for(let{type:x,value:F,exceptions:E,doubleVs:I}of p)x==="earth"?m={value:F,exceptions:E}:f.push({key:"Weakness",type:x,value:F,exceptions:E,predicate:["origin:effect:kinetic-aura"]}),I.length&&(l.doubleVs=!0);if(m)for(let x of Wr)f.push({key:"Weakness",type:x,value:m.value,exceptions:m.exceptions,predicate:["origin:effect:kinetic-aura"]});i.createEmbeddedDocuments("Item",[c]);let y=[];l.doubleVs&&y.push("The creature has some resistances that are doubled versus criticals, this can't be automated and will have to be manually handled by the GM.");let d=`${Math.ceil(t.level/2)+1}d4`,h=CONFIG.Dice.rolls.find(x=>x.name==="DamageRoll"),v=await new h(d).evaluate({async:!0}),A=`
<h4 class="action">
    <strong>Extract Element</strong>
    <span class="action-glyph">1</span>
</h4>
<div class="target-dc-result" data-tooltip-class="pf2e" data-tooltip-direction="UP">
    <div class="target-dc"><span data-visibility="all" data-whose="target">Target: ${i.name}</span></div>
</div>
`;for(let x of y)A+=`<p>${x}</p>`;v.toMessage({flavor:A,speaker:ChatMessage.getSpeaker({actor:t}),flags:{pf2e:{context:{target:{token:o.document.uuid,actor:i.uuid}}}}}),console.log({saveRoll:u,damageRoll:v,source:c})}n(Hr,"extractElement");var le=class extends Application{constructor(t,r){super(r),this.items=t}static get defaultOptions(){return mergeObject(Application.defaultOptions,{id:"idleuh-identify",title:"Identify Items",template:Lt("identify"),width:500})}getData(t){return mergeObject(super.getData(t),{items:this.items.map(r=>{let o=r.system.identification.identified,i=r.isIdentified,a=!i&&r.getFlag("world","identify.checked"),u=[];return i&&u.push("identified"),a&&u.push("checked"),{uuid:r.uuid,img:o.img,name:r.isOfType("treasure")?`($) ${o.name}`:o.name,css:u.join(" "),identified:i,checked:a}})})}activateListeners(t){t.find('[data-action="chat"]').on("click",this.#e.bind(this)),t.find('[data-action="checks"]').on("click",this.#t.bind(this)),t.find('[data-action="identify"]').on("click",this.#r.bind(this)),t.find('[data-action="remove"]').on("click",this.#n.bind(this)),t.find('[data-action="reset"]').on("click",this.#o.bind(this))}async#e(t){(await De(t))?.toMessage(void 0,{create:!0})}async#t(t){let r=await De(t),o=r.system.identification.identified.name,i=Ot(r,{pwol:game.pf2e.settings.variants.pwol.enabled,notMatchingTraditionModifier:game.settings.get("pf2e","identifyMagicNotMatchingTraditionModifier")}),a=r.isMagical?"identify-magic":r.isAlchemical?"identify-alchemy":"recall-knowledge",u=await renderTemplate("systems/pf2e/templates/actors/identify-item-chat-skill-checks.hbs",{identifiedName:o,action:a,skills:ae.omit(i,["dc"]),unidentified:r.system.identification.unidentified,uuid:r.uuid});await ChatMessage.implementation.create({user:game.user.id,content:u})}async#r(t){let r=await De(t);r&&(await r.setIdentificationStatus(r.isIdentified?"unidentified":"identified"),this.render())}async#n(t){let r=await De(t);if(!r)return;let o=r.getFlag("world","identify.checked");await r.setFlag("world","identify.checked",!o),this.render()}async#o(t){t.preventDefault();for(let r of this.items)r.isIdentified||!r.getFlag("world","identify.checked")||await r.setFlag("world","identify.checked",!1);this.render()}};n(le,"Identify");async function De(e){let t=$(e.currentTarget).closest("[data-item]"),r=t.attr("data-item"),o=await fromUuid(r);return o||t.remove(),o}n(De,"getItemFromEvent");function Yr(){if(!game.user.isGM){ui.notifications.warn("You not the GM yo!");return}let t=game.actors.reduce((r,o)=>{if(!o.hasPlayerOwner)return r;let i=o.items.filter(a=>a.isOfType("physical")&&!a.isIdentified);return r.push(...i),r},[]);new le(t).render(!0)}n(Yr,"identify");var za="pf2e.spells-srd",Ua="Item.dcALVAyJbYSovzqt";async function Vr(e){if(!e)return ui.notifications.warn("You must select an actor with the Imaginarium");let t=e.itemTypes.equipment.find(p=>p.getFlag("core","sourceId")===Ua);if(!t||t.system.equipped.carryType==="dropped")return ui.notifications.warn("This actor doesn't have the Imaginarium in their possession");let r=Math.floor(e.level/2)||1,o=game.packs.get(za),a=(await o.getIndex({fields:["system.level.value","system.traits","system.ritual"]})).filter(p=>p.system.level.value<=r&&!p.system.traits.value.includes("cantrip")&&!p.system.traits.value.includes("focus")&&!p.system.ritual&&p.system.traits.rarity==="common"),u=Math.floor(Math.random()*a.length),c=await o.getDocument(a[u]._id),f=await zr(c,{type:"scroll",heightenedLevel:r});if(!f){Ue("An error occured while creating an imaginarium scroll");return}f.name=`${f.name} *`;let[l]=await e.createEmbeddedDocuments("Item",[f]),m=Dt(c.uuid,l.name);ChatMessage.create({content:`<p>Ripped the last page of the Imaginarium:</p><p>${m}</p>`,speaker:ChatMessage.getSpeaker({actor:e})})}n(Vr,"ripImaginarium");var Kr="Compendium.idleuh.effects.Item.jjFsfolNR04KzPVh",$a="Compendium.idleuh.feats.Item.X3SZ0gTpBkGw3UGX",Qr="Compendium.idleuh.effects.Item.r0hicuQPY0OEAC6g";async function Jr(e,t){if(!t||!t.isOwner||!t.isOfType("character")){ui.notifications.warn("You must select a character token you own.");return}if(!w(t,$a,["feat"])){ui.notifications.warn("This character doesn't have <strong>Inspiring Marshal Stance</strong> feat.");return}if(w(t,Qr,["effect"])){ui.notifications.warn("This character cannot enter <strong>Inspiring Marshal Stance</strong>.");return}let r=getDcByLevel(t.level),i=(await t.skills.diplomacy.roll({dc:{value:r},rollMode:"roll",label:'<span class="pf2-icon">A</span> <b>Marshal Inspiration</b> <span>(Diplomacy Check)</span>',extraRollNotes:[{outcome:["criticalFailure"],text:"<strong>Critical Failure</strong> You fail to enter the stance and can't take this action again for 1 minute."},{outcome:["failure"],text:"<strong>Failure</strong> You fail to enter the stance."},{outcome:["success"],text:"<strong>Success</strong> Your marshal's aura grants you and allies a +1 status bonus to attack rolls and saves against mental effects."},{outcome:["criticalSuccess"],text:"<strong>Critical Success</strong> Your marshal's aura increases to a 20ft. emanation and grants you and allies a +1 status bonus to attack rolls and saves against mental effects."}]})).degreeOfSuccess;i>=2?await Ba(t,i):(await(await Xr(t))?.delete(),i===0&&await Ga(t))}n(Jr,"marshalInspiration");async function Ga(e){let t=await fromUuid(Qr);t&&await e.createEmbeddedDocuments("Item",[t.toObject()])}n(Ga,"setDebuff");async function Ba(e,t){let r=t===3?20:10,o=await Xr(e);if(o){let c=deepClone(o._source.system.rules),f=c.find(l=>l.key==="ChoiceSet");if(f.selection===r)return;f.selection=r,o.update({"system.rules":c});return}let i=await fromUuid(Kr);if(!i)return;let a=i.toObject(),u=a.system.rules.find(c=>c.key==="ChoiceSet");u.selection=r,await e.createEmbeddedDocuments("Item",[a])}n(Ba,"setEffect");async function Xr(e){return w(e,Kr,["effect"])}n(Xr,"getEffect");async function je({actor:e,token:t,item:r,formula:o}){let i=CONFIG.Dice.rolls.find(l=>l.name==="DamageRoll"),a=await new i(o).evaluate({async:!0}),u=Array.from(r.traits),c={type:"damage-roll",sourceType:"attack",actor:e.id,token:t?.id,target:null,domains:[],options:[u,e.getRollOptions(),r.getRollOptions("item")].flat(),mapIncreases:void 0,notes:[],secret:!1,rollMode:"roll",traits:u,skipDialog:!1,outcome:null,unadjustedOutcome:null},f=`<h4 class="action"><strong>${r.name}</strong></h4>`;return f+='<div class="tags" data-tooltip-class="pf2e">',f+=u.map(l=>{let m=game.i18n.localize(CONFIG.PF2E.actionTraits[l]),p=CONFIG.PF2E.traitsDescriptions[l];return`<span class="tag" data-trait="${l}" data-tooltip="${p}">${m}</span>`}).join(""),f+="</div><hr>",a.toMessage({flavor:f,speaker:ChatMessage.implementation.getSpeaker({actor:e,token:t}),flags:{pf2e:{context:c,origin:r.getOriginData()}}})}n(je,"rollDamage");var qa="Compendium.pf2e.feats-srd.Item.XJCsa3UbQtsKcqve";async function Zr(e,t){let r=e?.itemTypes.feat.find(i=>i.sourceId===qa);if(!r){ui.notifications.warn("You need to select a kineticist with the <strong>Thermal Nimbus</strong> feat.");return}let o=`${Math.floor(e.level/2)}[fire]`;await je({actor:e,token:t,item:r,formula:o})}n(Zr,"thermalNimbus");var Wa=["untrained","trained","expert","master","legendary"];async function en(){if(!game.user.isGM){ui.notifications.warn("You not the GM yo!");return}let e="",t=game.actors.party?.members??[];await Promise.all(t.map(async r=>{if(!r.isOfType("character"))return;let o=await r.perception.roll({createMessage:!1}),i=o.dice[0].total;e+=`<div style="display:flex;justify-content:space-between;" title="${o.result}">`,e+=`<span>${r.name} (${Wa[r.perception.rank]})</span><span`,i===20?e+=' style="color: green;"':i===1&&(e+=' style="color: red;"'),e+=`>${o.total}</span></div>`})),e&&ChatMessage.create({content:e,flavor:"Group Perception Checks<hr>",whisper:[game.user.id]})}n(en,"groupPerception");var Ha="Compendium.pf2e.feats-srd.Item.40mZVDnIP5qBNhTH";function tn(e,t){if(!t?.isOfType("character")){ui.notifications.warn("You need to select a character");return}if(!w(t,Ha,["feat"])){ui.notifications.warn("Your selected character needs to have the feat <strong>Sand Snatcher</strong>");return}let o=game.user.targets.first()?.actor;t.getStatistic("impulse").roll({event:e,label:"Sand Snatcher - Grapple",target:o,dc:{slug:"fortitude",label:"Fortitude DC",value:o?.saves.fortitude.dc.value},traits:["attack","impulse","kineticist"],extraRollNotes:[{text:game.i18n.localize("PF2E.Actions.Grapple.Notes.criticalSuccess"),outcome:["criticalSuccess"]},{text:game.i18n.localize("PF2E.Actions.Grapple.Notes.success"),outcome:["success"]},{text:game.i18n.localize("PF2E.Actions.Grapple.Notes.failure"),outcome:["failure"]},{text:game.i18n.localize("PF2E.Actions.Grapple.Notes.criticalFailure"),outcome:["criticalFailure"]}]})}n(tn,"sandSnatcher");var Ct="<strong>Spike Skin</strong> effect",Ya="Compendium.idleuh.effects.Item.aJWj25WLTiG67a1y",Va="Compendium.pf2e.feats-srd.Item.9p28s0zg4Vv4r5i2";function rn(e){return e?.itemTypes.effect.find(t=>t.sourceId===Ya)}n(rn,"getEffect");function nn(){ui.notifications.warn(`You need to select an actor with the ${Ct}.`)}n(nn,"effectMissing");async function on(e){let t=rn(e);if(!t)return nn();let r=t.system.duration.value;if(r<=0){ui.notifications.warn(`The ${Ct} is already expired on the selected actor.`);return}await t.update({"system.duration.value":Math.max(0,r-1)}),ui.notifications.info(`The ${Ct} duration has been reduced by 1 minute.`)}n(on,"spikeSkinDuration");async function an(e,t){if(!rn(e))return nn();let o=await fromUuid(Va),i=`${Math.floor((e.level-8)/2)*2+2}[piercing]`;await je({actor:e,token:t,item:o,formula:i})}n(an,"spikeSkinDamage");var Mt="Compendium.idleuh.effects.Item.MqgbuaqGMJ92VRze",_t="Compendium.idleuh.effects.Item.Lz5hNf4dbXKjDWBa",Nt="Compendium.idleuh.effects.Item.8BxBB5ztfRI9vFfZ",sn="Compendium.pf2e.conditionitems.Item.AJh5ex99aV6VTggg";async function un(e,t,r){if(e.ctrlKey){game.user.isGM?Ft():me({type:"clean-exploit-vulnerability"}),ui.notifications.notify("All effects are being removed.");return}let o=game.user.targets,[i]=o,a=i?.actor;if(!t||!t.isOwner||!t.isOfType("character")||o.size!==1||!a||!a.isOfType("creature")){ui.notifications.warn("You must select a character token you own and target another one.");return}let u=Fe(t);if(!u)return;let c="action:recall-knowledge",f=getDcByLevel(a.level),l=t.getRollOptions(["all","skill-check","Esoteric"]);l.push(c),l.push("secret");let m=a.system.attributes.weaknesses,p=m.reduce((I,pe)=>pe.value>I?pe.value:I,0),y=m.filter(I=>I.value===p).map(I=>I.type),d=y.join(", "),h=d?`<strong>[ ${d} ]</strong> = ${p}<br>`:"",A=(await u.roll({extraRollOptions:l,dc:{value:f},rollMode:"roll",label:'<span class="pf2-icon">A</span> <b>Exploit Vulnerability</b> <span">(Esoteric Check)</span>',extraRollNotes:[{outcome:["criticalFailure"],text:"<strong>Critical Failure</strong> You couldn't remember the right object to use and become distracted while you rummage through your esoterica. You become flat-footed until the beginning of your next turn."},{outcome:["failure"],text:"<strong>Failure</strong> Failing to recall a salient weakness about the creature, you instead attempt to exploit a more personal vulnerability. You can exploit only the creature's personal antithesis. Your unarmed and weapon Strikes against the creature also become magical if they weren't already."},{outcome:["success"],text:`${h}<strong>Success</strong> You recall an important fact about the creature, learning its highest weakness (or one of its highest weaknesses, if it has multiple with the same value) but not its other weaknesses, resistances, or immunities. You can exploit either the creature's mortal weakness or personal antithesis. Your unarmed and weapon Strikes against the creature also become magical if they weren't already.`},{outcome:["criticalSuccess"],text:`${h}<strong>Critical Success</strong> You remember the creature's weaknesses, and as you empower your esoterica, you have a flash of insight that grants even more knowledge about the creature. You learn all of the creature's resistances, weaknesses, and immunities, including the amounts of the resistances and weaknesses and any unusual weaknesses or vulnerabilities, such as what spells will pass through a golem's antimagic. You can exploit either the creature's mortal weakness or personal antithesis (see the Exploit Vulnerability class feature). Your unarmed and weapon Strikes against the creature also become magical if they weren't already.`}]})).degreeOfSuccess,x=w(t,Mt,["effect"]);if(A>=1&&!x){let I=(await fromUuid(Mt)).toObject();t.createEmbeddedDocuments("Item",[I])}else if(A<1&&(x?.delete(),!zt(t,sn,["condition"]))){let pe=(await fromUuid(sn)).toObject();t.createEmbeddedDocuments("Item",[pe])}let F=y.filter(I=>!r.includes(I)),E={type:"exploit-vulnerability",actorId:t.id,targetId:i.id,vulnerability:F.length?p:0,success:A};game.user.isGM?Pt(E):me(E)}n(un,"exploitVulnerability");async function Pt({actorId:e,targetId:t,vulnerability:r,success:o}){let i=game.actors.get(e),a=canvas.tokens.get(t)?.actor;if(!i||!a)return;let u=2+Math.floor(i.level/2),c=o>1&&r>=u,f=(await fromUuid(Nt)).toObject(),l={key:"Weakness",type:"piercing",value:r,predicate:["origin:effect:exploit-vulnerability"]};f.system.rules.push(l);for(let m of canvas.tokens.placeables){let p=m.actor;if(!p||p===i)continue;let y=w(p,_t,["effect"]),d=w(p,Nt,["effect"]);if(await y?.delete(),await d?.delete(),!(o<1))if(p===a){let h=(await fromUuid(_t)).toObject(),v={key:"Weakness",type:"piercing",value:c?r:u,predicate:["origin:effect:exploit-vulnerability"]};h.system.rules.push(v),p.createEmbeddedDocuments("Item",[h])}else c&&p.id===a.id&&p.createEmbeddedDocuments("Item",[f])}}n(Pt,"exploitVulnerabilityGM");function Ft(){for(let e of canvas.tokens.placeables){let t=e.actor;if(!t)continue;let r=w(t,Mt,["effect"]),o=w(t,_t,["effect"]),i=w(t,Nt,["effect"]);r?.delete(),o?.delete(),i?.delete()}}n(Ft,"cleanExploitVulnerabilityGM");$t("idleuh");Hooks.once("init",()=>{Array.prototype.toReversed||(Array.prototype.toReversed=function(){let e=[];for(let t=this.length-1;t>=0;t--)e.push(this[t]);return e}),game.modules.get(b.id).api={macros:{exploitVulnerability:un,esotericCheck:Br,groupPerception:en,identify:Yr,ripImaginarium:Vr,marshalInspiration:Jr,sandSnatcher:tn,extractElement:Hr,thermalNimbus:Zr,spikeSkinDuration:on,spikeSkinDamage:an}},game.settings.register(b.id,"jquery",{name:"Disable JQuery Animations",hint:"Will cancel sliding animations on different parts of the UI.",type:Boolean,default:!1,config:!0,scope:"client",onChange:cn})});Hooks.once("ready",()=>{game.user.isGM&&Gt(Ka),Ge("jquery")&&cn(!0)});function cn(e){jQuery.fx.off=e}n(cn,"setJQueryFx");function Ka(e){e.type==="exploit-vulnerability"?Pt(e):e.type==="clean-exploit-vulnerability"&&Ft()}n(Ka,"onPacketReceived");})();
//# sourceMappingURL=main.js.map
