{"version":3,"file":"main.js","mappings":"mBAAO,IAAI,EAAY,GCGhB,SAASA,EAA0BC,GACtC,OAAOC,KAAKC,SAASC,IAAI,EAAWH,EACxC,CCHA,MAAMI,EAAW,wBAEV,SAASC,EAAUC,GACjBL,KAAKM,KAAKC,MAEfC,MADeH,EAAS,KAAO,OACjB,cAAeI,EACjC,CAEA,SAASC,EAAUC,GACf,OAAOA,EAAMC,UAAUC,OAAOC,MAAKC,GAAKA,EAAEC,QAAQ,OAAQ,cAAgBb,GAC9E,CAEA,SAASM,EAAYQ,EAAsBC,GACvC,MAAMP,EAAQM,EAAMN,MACpB,KAAM,MAAOO,MAAQ,MAAOA,KAAUP,EAAO,OAC7C,MAAMQ,EAAST,EAAUC,GACrBQ,GAGR,SAAmBC,EAA2BC,GAC1C,IAAIC,EACAC,EAEJ,MAAMC,EAASC,OAAOD,OAAOE,WAC7B,IAAK,MAAMT,KAASO,EAAQ,CACxB,MAAMG,EAAaV,EAAMN,MACzB,IAAKgB,GAAcA,IAAeP,EAAWT,MAAO,SACpD,MAAMQ,EAAST,EAAUiB,GACzB,GAAKR,EAAL,CACAG,EAAaL,EACbM,EAAcJ,EACd,KAHqB,C,CAMzB,IAAKG,IAAeC,EAEhB,YADAF,EAAYO,OAAO,CAAE,qBAAsB,IAI/C,MAEMT,EAFWM,OAAOI,KAAKC,gBAAgBV,EAAYE,EAAY,CAAES,YAAY,IACxD,GACDjC,EAAmB,eAAiB,EAAI,EAElEuB,EAAYO,OAAO,CAAE,qBAAsBT,IAC3CI,EAAYK,OAAO,CAAE,qBAAsBT,GAC/C,CA7BgBa,CAAUf,EAAOE,EACjC,CCnBA,MAAMc,EAAc,6CAEb,SAASC,EAAiBvB,GAC7B,MAAMwB,EAAY,CAAC,WAAY,gBAAiB,iBAC1CC,EAAQC,OAAOC,OAAO3B,EAAM4B,QAAQzB,MAAKC,GAAKoB,EAAUK,SAASzB,EAAG0B,QAG1E,OADKL,GAAOM,GAAGC,cAAcC,KAAK,oDAC3BR,CACX,CAEO,SAASS,IACZ,OAAO7C,KAAK8C,KAAKC,OAAO,0BAA2B,CAAEC,UAAW,YACpE,CAEO,SAASC,EAAetC,GAC3B,OAAOA,EAAMC,UAAUsC,KAAKC,MAAKpC,GAAKA,EAAEC,QAAQ,OAAQ,cAAgBiB,GAC5E,CCbA,MAAMmB,EAAW,wBACXC,EAAa,6CACbC,EAAS,kDAERC,eAAeC,EAAqBC,EAA8B9C,GACrE,MAAM+C,EAAU1D,KAAKM,KAAKoD,SACnBC,GAAUD,EACXE,EAAcD,GAAQhD,MAE5B,KACKA,GACAA,EAAMkD,SACNlD,EAAMmD,SAAS,cACC,IAAjBJ,EAAQK,MACPH,GACAA,EAAYE,SAAS,aAGtB,YADApB,GAAGC,cAAcC,KAAK,qEAI1B,MAAMR,EAAQF,EAAiBvB,GAC/B,IAAKyB,EAAO,OAEZ,MAEM4B,EAAcJ,EAAYK,OAAOC,QAAQC,MAAMC,MAC/CC,EAAKL,EAAc,EAAI,GAFX,CAAC,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,IAE3EA,GAEtCM,EAAU3D,EAAM4D,eAAe,CAAC,MAAO,cAAe,aAC5DD,EAAQE,KANW,2BAOnBF,EAAQE,KAAK,UAEb,MAAMC,EAAKb,EAAYK,OAAOS,WAAWC,WACnCC,EAAgBH,EAAGI,QAAO,CAACC,EAAMC,IAC/BA,EAAKX,MAAQU,EAAaC,EAAKX,MAC5BU,GACR,GAEGH,EAAaF,EAAGO,QAAOjE,GAAKA,EAAEqD,QAAUQ,IAAeK,KAAIlE,GAAKA,EAAEmE,OAElEC,QAAcnF,KAAKoF,KAAKC,MAAMF,KAChC,IAAInF,KAAKoF,KAAKE,cAAc,OAAQlD,GACpC,CACIzB,QACAgD,OAAQ,CAAEhD,MAAOiD,EAAa3C,MAAO0C,EAAO4B,UAC5CC,MAAO3C,IACPqC,KAAM,cACNZ,UACAD,GAAI,CAAED,MAAOC,GACboB,eAAe,GAEnBhC,GAGEiC,EAAqC,CACvCR,KAAM,wBACNS,QAAShF,EAAMiF,GACfC,SAAUlC,EAAOiC,GACjBhB,gBACAD,aACAN,KACAyB,MAAOX,EAAKW,OAAS,EACrBC,IAAKZ,EAAKa,KAAK,GAAGF,OAAS,GAG3B9F,KAAKM,KAAKC,KAAM0F,EAAuBP,GC/DxC,SAA2DA,GAC9D1F,KAAKkG,OAAOC,KAAK,UAAU,IAAaT,EAC5C,CD8DSU,CAAWV,EACpB,CAEOnC,eAAe0C,GAAuB,QACzCN,EAAO,SACPE,EAAQ,cACRjB,EAAa,WACbD,EAAU,GACVN,EAAE,MACFyB,EAAK,IACLC,IAEA,MAAMpF,EAAQX,KAAKqG,OAAOnG,IAAmByF,GACvC/B,EAAcnC,OAAOD,OAAOtB,IAAI2F,IAAWlF,MACjD,IAAKA,IAAUiD,EAAa,OAE5B,MAAM0C,EAAUC,EAAWT,EAAOC,EAAK1B,GAEvC5C,OAAOD,OAAOE,WAAW8E,SAAQvF,IAC7B,MAAMwF,EAAaxF,EAAMN,MACzB,IAAK8F,GAAcA,IAAe9F,EAAO,OAEzC,MAAME,EAAS6F,EAAUD,GAErBA,IAAe7C,EACX0C,GAAW,GAAKzF,EAAQA,EAAO8F,SAC1BL,GAAW,IAAMzF,GAAQ+F,EAAUH,GACrC5F,GACPA,EAAO8F,Q,IAIf,MAAM9F,EAAS6F,EAAU/F,GACzB,GAAI2F,GAAW,EAAG,CACd,MAAMO,EAASP,GAAW,GAAK1B,GAAkB,EAC5C/D,EACIA,EAAOgG,OAAOzC,QAAUyC,GAAOhG,EAAOe,OAAO,CAAE,qBAAsBiF,IADjED,EAAUjG,EAAOkG,E,MAG9BhG,GAAQ8F,SAmGhBpD,eAA6B5C,GAEzB,GADkBA,EAAMC,UAAUkG,UAAU3D,MAAKpC,GAAKA,EAAEC,QAAQ,OAAQ,cAAgBsC,IACzE,OAEf,MAAMpC,SAAe6F,SAASzD,IAA2B0D,WACzDrG,EAAMsG,wBAAwB,OAAQ,CAAC/F,GAC3C,CAxGQgG,CAAcvG,IAatB,SACIA,EACAgD,EACAU,EACAyB,EACAC,EACAO,EACA1B,EACAD,GAEA,MAAMwC,EAAKrB,EAAQzB,EACb+C,EAAMtB,EAAQC,EACdsB,EAAMf,GAAW,EAAI,kBAAgC,IAAZA,EAAgB,UAAwB,IAAZA,EAAgB,UAAY,kBACjGgB,EAAMhB,GAAW,EAAI,mBAAiC,IAAZA,EAAgB,UAAwB,IAAZA,EAAgB,UAAY,mBAExG,IAAIiB,EAAS,4SAGC5D,EAAO6D,2EAA2EnD,wHAE/D0B,KAAOqB,GAAO,EAAI,IAAM,OAAOK,KAAKC,IAAIN,OAAStB,qDAC7CuB,MAAQC,yCAA2CH,GAAM,EAAI,IAAM,KAAKA,+BAIzGb,GAAW,GAAK3B,EAAWgD,SAC3BJ,GAAU,kBAAkB5C,EAAWiD,KAAK,sBAAsBhD,WAGtE2C,GAAU,8BAENA,GADAjB,GAAW,EACD,opBAOS,IAAZA,EACG,qaAIS,IAAZA,EACG,mTAKA,kNAGdiB,GAAU,aAENtE,EAAetC,IAAU2F,GAAW,IAAGiB,GAK/C,SAA2B5D,EAAmBmC,EAAeC,GACzD,MACM8B,GADelE,EAAmBM,OAAOC,QAAQ4D,gBAAgB1F,MAAM2F,aAAe,IAC7D9C,KAAIZ,IAC/B,MAAMiC,EAAUC,EAAWT,EAAOC,EAAK1B,GAGvC,MAAO,uBAFOiC,GAAW,EAAI,QAAsB,IAAZA,EAAgB,OAAS,sBAClDA,GAAW,EAAI,mBAAiC,IAAZA,EAAgB,UAAY,cACpBjC,UAAW,IAIzE,MAAO,0HAFKwD,EAAWF,OAAS,+BAA+BE,EAAWD,KAAK,eAAiB,kMAMpG,CAnByDI,CAAkBrE,EAAQmC,EAAOC,IAEtFkC,YAAYC,OAAO,CAAEX,SAAQ5G,SACjC,CAnEIwH,CAAUxH,EAAOiD,EAAaS,EAAIyB,EAAOC,EAAKO,EAAS1B,EAAeD,EAC1E,CAEA,SAAS4B,EAAWT,EAAeC,EAAa1B,GAC5C,IAAIiC,EAAUR,GAASzB,EAAK,GAAK,EAAIyB,GAASzB,EAAK,EAAIyB,EAAQzB,EAAK,GAAK,EAAI,EAG7E,OAFY,KAAR0B,EAAYO,IACC,IAARP,GAAWO,IACbA,CACX,CA6EA,SAASI,EAAU/F,GACf,OAAOA,EAAMC,UAAUC,OAAOC,MAAKD,GAAUA,EAAOG,QAAQ,OAAQ,cAAgBoC,GACxF,CAEAG,eAAeqD,EAAUjG,EAAkBkG,GACvC,MAAM3F,SAAe6F,SAAS1D,IAA4B2D,WACtDH,GAAOuB,YAAYlH,EAAM,qBAAsB2F,GACnDlG,EAAMsG,wBAAwB,OAAQ,CAAC/F,GAC3C,CE3MO,SAASmH,EAAc5E,EAA8B9C,GACxD,IAAKA,IAAUA,EAAMkD,UAAYlD,EAAMmD,SAAS,aAE5C,YADApB,GAAGC,cAAcC,KAAK,8CAI1B,MAAMR,EAAQF,EAAiBvB,GAC/B,IAAKyB,EAAO,OAEZ,MAAMkC,EAAU,IAAIgE,IACd9C,EAAQ3C,IAEd,IAAI0E,EAAS,sBAAsB/B,0LAG/B/B,EAAM8E,SAAWtF,EAAetC,KAChC2D,EAAQkE,IAAI,gBAEZjB,GAAU,4MAIdvH,KAAKoF,KAAKC,MAAMF,KACZ,IAAInF,KAAKoF,KAAKE,cAAciC,EAAQnF,GACpC,CACIzB,QACA6E,QACAN,KAAM,cACNuD,SAAU,YACVnE,WAEJb,EAER,CCzBO,SAASiF,KAAgBC,GAE5B,OADAA,EAAOA,EAAK3D,QAAOjE,GAAkB,iBAANA,IACxB,WAAW,eAAuB4H,EAAKf,KAAK,MACvD,CCXO,MAAMgB,UAAoBC,gBAClBC,4BACP,OAAOC,YAAYC,MAAMF,eAAgB,CACrClD,GAAI,sBACJqD,SAAUP,EAAa,qBACvBlD,MAAO,sBACP0D,MAAO,KAEf,CAEAC,kBAAkBC,GACdJ,MAAMG,kBAAkBC,GAExBA,EAAKtI,KAAK,uBAAuBuI,GAAG,SAAS,IAAMC,KAAKC,UAExD,MAAMC,EAAQJ,EAAKtI,KAAK,qBAClB2I,EAAaD,EAAME,KAAK,QAC9BF,EAAMH,GAAG,SAAS,KACd,MAAMM,EAAMH,EAAM,GAAGI,cACrBH,EAAWI,KAAKF,EAAIG,QAAQ,GAAG,IAGnC,MAAMjI,EAAOuH,EAAKtI,KAAK,oBACjBiJ,EAAYlI,EAAK6H,KAAK,QAC5B7H,EAAKwH,GAAG,SAAS,KACb,MAAMM,EAAM9H,EAAK,GAAG+H,cACpBG,EAAUF,KAAKF,EAAIG,QAAQ,GAAG,GAEtC,CAEUvG,oBAAoBE,EAAcuG,GACxC,MAAM9I,EAAOoI,KAAKW,OAEZC,EAAU,CACZ,YAAiBC,OAAOH,EAASxC,MACjC,YAAiB2C,OAAOH,EAASI,IACjC,cAAiBJ,EAASK,IAC1B,+BAAkCL,EAASM,KAC3C,MAAWH,OAAOH,EAASnI,MAC3B,OAAYsI,OAAOH,EAASnI,MAC5B,iBAAoBsI,OAAOH,EAASR,OACpC,iBAAoBW,OAAOH,EAASR,QAGlC5H,EAAS,CAAC,EAChB,IAAK,MAAO2I,EAAGC,KAAMnI,OAAOoI,QAAQP,GAC5BQ,YAAYxJ,EAAMqJ,KAAOC,GAC7BpC,YAAYxG,EAAQ2I,EAAGC,GAGvBnI,OAAOsI,KAAK/I,GAAQ+F,QAAQ2B,KAAKW,OAAOrI,OAAOA,EACvD,ECnDG2B,eAAeqH,EAAY3J,GACzBA,GAAUA,EAAM4C,QAIrB,IAAI+E,EAAY3H,EAAMsE,UAAUsF,QAAO,GAHnCnI,GAAGC,cAAcC,KAAK,qCAI9B,CCRA,MAAMkI,EAAc,CAAC,UAAW,SAAU,SAAU,YAAa,aAE1DvH,eAAewH,IAClB,IAAK/K,KAAKM,KAAKC,KAEX,YADAmC,GAAGC,cAAcC,KAAK,sBAI1B,IAAIoI,EAAS,OAEb,MAAMxJ,EAASC,OAAOD,OACtB,IAAK,MAAMP,KAASO,EAAOE,WAAY,CACnC,MAAMf,EAAQM,EAAMN,MACfA,GAAUA,EAAMmD,SAAS,YAAa,QAAWnD,EAAMsK,gBAAmBtK,EAAM+D,WAAWwG,aAChGF,SAAgBG,EAAexK,G,CAGnCsH,YAAYC,OAAO,CAAEkD,QAASJ,EAAQzD,OAAQ,0BAA2B8D,QAAS,CAACrL,KAAKM,KAAKsF,KACjG,CAEArC,eAAe4H,EAAexK,GAC1B,MAAMuK,EAAavK,EAAM+D,WAAWwG,WAC9BI,EAAQ,IAAItL,KAAKoF,KAAKE,cAAc,GAAI4F,GACxC/F,QAAanF,KAAKoF,KAAKC,MAAMF,KAAKmG,EAAO,CAAE3K,MAAOA,EAAOuE,KAAM,cAAeO,eAAe,EAAO8F,YAAY,IACtH,IAAKpG,EAAM,MAAO,GAElB,MAAMqG,EAAOV,GAAaI,EAAWM,MAAQ,GAAK,GAC5CzF,EAAMZ,EAAKa,KAAK,GAAGF,MACzB,QAAY2F,IAAR1F,EAAmB,MAAO,GAE9B,IAAIiF,EAAS,mEAAmE7F,EAAK6F,WAKrF,OAJAA,GAAU,SAASrK,EAAM6G,SAASgE,iBACvB,IAAPzF,EAAWiF,GAAU,yBACT,GAAPjF,IAAUiF,GAAU,wBAEtB,GAAGA,KAAU7F,EAAKW,oBAC7B,CCpCA,MAAM4F,EAAY,IAAIC,IACtBD,EAAUE,KAAK,EAAG,IAClBF,EAAUE,IAAI,EAAG,IACjBF,EAAUE,IAAI,EAAG,IACjBF,EAAUE,IAAI,EAAG,IACjBF,EAAUE,IAAI,EAAG,IACjBF,EAAUE,IAAI,EAAG,IACjBF,EAAUE,IAAI,EAAG,IACjBF,EAAUE,IAAI,EAAG,IACjBF,EAAUE,IAAI,EAAG,IACjBF,EAAUE,IAAI,EAAG,IACjBF,EAAUE,IAAI,EAAG,IACjBF,EAAUE,IAAI,GAAI,IAClBF,EAAUE,IAAI,GAAI,IAClBF,EAAUE,IAAI,GAAI,IAClBF,EAAUE,IAAI,GAAI,IAClBF,EAAUE,IAAI,GAAI,IAClBF,EAAUE,IAAI,GAAI,IAClBF,EAAUE,IAAI,GAAI,IAClBF,EAAUE,IAAI,GAAI,IAClBF,EAAUE,IAAI,GAAI,IAClBF,EAAUE,IAAI,GAAI,IAClBF,EAAUE,IAAI,GAAI,IAClBF,EAAUE,IAAI,GAAI,IAClBF,EAAUE,IAAI,GAAI,IAClBF,EAAUE,IAAI,GAAI,IAClBF,EAAUE,IAAI,GAAI,IAClBF,EAAUE,IAAI,GAAI,IAElB,MAAMC,EAAgB,IAAIF,IA2BnB,SAASG,EAAiBzH,EAAY0H,EAAiB,UAC1D,OAGG,SAAkB1H,EAAY2H,EAA2B,UAC5D,OAAO3H,GAAMwH,EAAc3L,IAAI8L,IAAe,EAClD,CALWC,CAAS5H,EAOb,SAA8B0H,EAAiB,UAClD,MAAe,aAAXA,EACO,OACW,SAAXA,EACA,YACW,WAAXA,EACA,kBAEA,QAEf,CAjBwBG,CAAqBH,GAC7C,CA5BAF,EAAcD,IAAI,mBAAoB,IACtCC,EAAcD,IAAI,aAAc,GAChCC,EAAcD,IAAI,QAAS,GAC3BC,EAAcD,IAAI,SAAU,GAC5BC,EAAcD,IAAI,OAAQ,GAC1BC,EAAcD,IAAI,YAAa,GAC/BC,EAAcD,IAAI,kBAAmB,IClC9B,MAAMO,EAAmB,IAAI7D,IAAI,CAAC,SAAU,SAAU,SAAU,WAIjE8D,EAAqC,GA8B3C,MAAMC,EAA8C,CAChD,EAAG,mBACH,EAAG,mBACH,EAAG,mBACH,EAAG,mBACH,EAAG,mBACH,EAAG,mBACH,EAAG,mBACH,EAAG,mBACH,EAAG,mBACH,GAAI,oBC9CD,MAAMC,EAAmB,CAC5BC,IAAK,aACLC,IAAK,SACLC,IAAK,YACLC,IAAK,WACLC,IAAK,YACLC,IAAK,YACLC,IAAK,eACLC,IAAK,WACLC,IAAK,SACLC,IAAK,YACLC,IAAK,cACLC,IAAK,WACLC,IAAK,UACLC,IAAK,UACLC,IAAK,WACLC,IAAK,YAG0BjL,OAAOsI,KAAK2B,GAEfjK,OAAOC,OAAOgK,GCjBvC,MAAMiB,UAAiBC,YAC1BC,MAEAC,YAAYD,EAA2BnJ,GACnC0E,MAAM1E,GACNgF,KAAKmE,MAAQA,CACjB,CAEW3E,4BACP,OAAOC,YAAYC,MAAMF,eAAgB,CACrClD,GAAI,kBACJJ,MAAO,iBACPyD,SAAUP,EAAa,iBACvBQ,MAAO,KAEf,CAEAyE,QAAQrJ,GACJ,OAAOyE,YAAYC,MAAM2E,QAAQrJ,GAAU,CACvCmJ,MAAOnE,KAAKmE,MAAMxI,KAAI2I,IAClB,MAAM1M,EAAO0M,EAAK3J,OAAO6D,eAAe+F,WAClCA,EAAaD,EAAKE,aAClBC,GAAWF,GAAeD,EAAK5M,QAAQ,QAAS,oBAEhDgN,EAAU,GAIhB,OAHIH,GAAYG,EAAQxJ,KAAK,cACzBuJ,GAASC,EAAQxJ,KAAK,WAEnB,CACHyJ,KAAML,EAAKK,KACX5D,IAAKnJ,EAAKmJ,IACV7C,KAAMoG,EAAK9J,SAAS,YAAc,OAAO5C,EAAKsG,OAAStG,EAAKsG,KAC5DH,IAAK2G,EAAQpG,KAAK,KAClBiG,aACAE,UACH,KAGb,CAEA5E,kBAAkBC,GAGdA,EAAKtI,KAAK,wBAAwBuI,GAAG,QAASC,MAAK,EAAQ4E,KAAK5E,OAChEF,EAAKtI,KAAK,0BAA0BuI,GAAG,QAASC,MAAK,EAAU4E,KAAK5E,OACpEF,EAAKtI,KAAK,4BAA4BuI,GAAG,QAASC,MAAK,EAAY4E,KAAK5E,OACxEF,EAAKtI,KAAK,0BAA0BuI,GAAG,QAASC,MAAK,EAAU4E,KAAK5E,OACpEF,EAAKtI,KAAK,yBAAyBuI,GAAG,QAASC,MAAK,EAAS4E,KAAK5E,MACtE,CAEA/F,QAAcE,UACS0K,EAAiB1K,KAC9B2K,eAAU3C,EAAW,CAAEvD,QAAQ,GACzC,CAEA3E,QAAgBE,GACZ,MAAMmK,QAAaO,EAAiB1K,GACpC,IAAKmK,EAAM,OAEX,MAAMS,EAAUT,EAAK3J,OAAO6D,eAAewG,aAAajE,IAClDkE,EAAWX,EAAK3J,OAAO6D,eAAewG,aAAa9G,KACnDgH,EAAiBZ,EAAK3J,OAAO6D,eAAe+F,WAAWrG,KAEvDiH,EAA+BzO,KAAKC,SAASC,IAAI,OAAQ,6CAEzDwO,ECjEP,SACHd,GACA,wBAAEe,GAA0B,EAAK,6BAAEF,IAEnC,MAAMG,EJmCH,SAAqBzK,GAAe,wBAAEwK,GAA0B,EAAK,OAAE5C,EAAS,UAAwB,CAAC,GAG5G,MAAM1H,EAAKqH,EAAUxL,IAAIiE,IAAU,GACnC,OAGW2H,EAHP6C,EAGwBtK,EAAKoD,KAAKoH,IAAI1K,EAAO,GAErBE,EAFyB0H,EAIzD,CI9CmB+C,CAAYlB,EAAKzJ,MAAO,CAAEwK,4BACnC5C,EAYV,SAAqB6B,GACjB,OAAOA,EAAKmB,OAAOC,IAAI,UAAY,SAAWpB,EAAK7B,MACvD,CAdmBkD,CAAYrB,GACrBvJ,EAAKyH,EAAiB8C,EAAQ7C,GACpC,OAAI6B,EAAKsB,UAcb,SAAuBtB,EAAwBuB,EAAgBV,GAC3D,MAAMzD,EAAS,CACXoE,OAAQD,EACRE,OAAQF,EACRG,OAAQH,EACRI,OAAQJ,GAENK,EAcV,SAA4B5B,GACxB,MAAMmB,EAAmBnB,EAAK3J,OAAO8K,OAAO3K,MAC5C,OAAO,IAAIkE,IAAIyG,EAAO/J,QAAQyK,IAA2BC,OC/CCtL,ED+C+BqL,EAAlBtD,EC9C5D6C,IAAI5K,GADZ,IAAuDA,CD+CiC,IAC/F,CAjBuBuL,CAAmB/B,GACtC,IAAK,MAAM7N,KAAOoM,EAGVqD,EAAWzL,KAAO,IAAMyL,EAAWR,IAAIjP,KACvCiL,EAAOjL,GAAOoP,EAASV,GAG/B,MAAO,CAAEjC,IAAKxB,EAAOuE,OAAQxC,IAAK/B,EAAOqE,OAAQnC,IAAKlC,EAAOsE,OAAQtC,IAAKhC,EAAOoE,OACrF,CA7BeQ,CAAchC,EAAMvJ,EAAIoK,GACxBb,EAAKiC,aACL,CAAEnD,IAAKrI,GAEP,CAAEA,GAAIA,EAErB,CDmDoByL,CAAalC,EAAM,CAAEe,wBADmD,4BAApD3O,KAAKC,SAASC,IAAI,OAAQ,sBACAuO,iCAEpDlM,EAASF,OAAOoI,QAAQiE,GAAKzJ,KAAI,EAAE8K,EAAW1L,MAGzC,CAAE0L,UAFTA,EAA0B,OAAdA,EAAqB,MAAQA,EAErB1L,KAAImD,KADXxH,KAAK8C,KAAKkN,SAAS1D,EAAiByD,QAI/C3E,QAAgB6E,eAAe,oEAAqE,CACtG5B,UACAE,WACAC,iBACAjM,iBAGE0F,YAAYC,OAAO,CAAE5H,KAAMN,KAAKM,KAAKsF,GAAIwF,WACnD,CAEA7H,QAAkBE,GACd,MAAMmK,QAAaO,EAAiB1K,GAC/BmK,UAECA,EAAKhM,OAAO,CACd,+BAAgCgM,EAAKE,aAAe,eAAiB,aACrE,qCAAsCF,EAAKsC,iBAAiB,gBAC5D,gCAAgC,IAGpC5G,KAAKuB,SACT,CAEAtH,QAAgBE,GACZ,MAAMmK,QAAaO,EAAiB1K,GACpC,IAAKmK,EAAM,OAEX,MAAMG,EAAUH,EAAK5M,QAAQ,QAAS,0BAChC4M,EAAKuC,QAAQ,QAAS,oBAAqBpC,GAEjDzE,KAAKuB,QACT,CAEAtH,QAAeE,GACXA,EAAM2M,iBAEN,IAAK,MAAMxC,KAAQtE,KAAKmE,OAChBG,EAAKE,cAAiBF,EAAK5M,QAAQ,QAAS,2BAC1C4M,EAAKuC,QAAQ,QAAS,oBAAoB,GAGpD7G,KAAKuB,QACT,EAGJtH,eAAe4K,EAAiB1K,GAC5B,MAAM4M,EAASC,EAAE7M,EAAM8M,eAAeC,QAAQ,eACxCvC,EAAOoC,EAAOI,KAAK,aACnB7C,QAAa7G,SAASkH,GAE5B,OADKL,GAAMyC,EAAOK,SACX9C,CACX,CG9HO,SAAS+C,IACZ,IAAK3Q,KAAKM,KAAKC,KAEX,YADAmC,GAAGC,cAAcC,KAAK,sBAI1B,MACM6K,EADSzN,KAAKqG,OACCxB,QAAO,CAAC+L,EAAKjQ,KAC9B,IAAKA,EAAMsK,eAAgB,OAAO2F,EAClC,MAAMC,EAAWlQ,EAAM8M,MAAMzI,QAAO4I,GAAQA,EAAK9J,SAAS,cAAgB8J,EAAKE,eAE/E,OADA8C,EAAIpM,QAAQqM,GACLD,CAAG,GACX,IAEH,IAAIrD,EAASE,GAAO5C,QAAO,EAC/B,CCfA,MAAMiG,EAAS,kBACTC,EAAS,wBAERxN,eAAeyN,EAAerQ,GACjC,IAAKA,EAAO,OAAO+B,GAAGC,cAAcC,KAAK,iDAEzC,MAAMqO,EAAOtQ,EAAMC,UAAUsQ,UAAUpQ,MAAKC,GAAKA,EAAEC,QAAQ,OAAQ,cAAgB+P,IACnF,IAAKE,GAA2C,YAAnCA,EAAKhN,OAAOkN,SAASC,UAC9B,OAAO1O,GAAGC,cAAcC,KAAK,+DAEjC,MAAMuB,EAAQsD,KAAK4J,MAAM1Q,EAAMwD,MAAQ,GACjCmN,EAAOtR,KAAKuR,MAAMrR,IAAI4Q,GAGtBU,SAFcF,EAAKG,SAAS,CAAEC,OAAQ,CAAC,qBAAsB,gBAAiB,4BAE/D1M,QACjBjE,GACIA,EAAEkD,OAAOE,MAAMC,OAASD,IACvBpD,EAAEkD,OAAO8K,OAAO3K,MAAM5B,SAAS,YACJ,WAA5BzB,EAAEkD,OAAO0N,SAASvN,OACU,UAA5BrD,EAAEkD,OAAO0N,SAASvN,OACS,WAA3BrD,EAAEkD,OAAO8K,OAAOhD,SAIlB6F,EAAQJ,EADD/J,KAAK4J,MAAM5J,KAAKoK,SAAWL,EAAO7J,SAEzCsG,EAAO,cAAc6C,KAAUc,EAAME,MAE3C,IAAIC,EAAc9D,EACd+D,EAAe,GACnB,MAAMC,QNxBH1O,eAAiC0K,EAAgB9J,EAAyB+N,GAAO,GACpF,MAAMN,SAAe7K,SAAoBkH,KAAQjH,WACjD,IAAK4K,EAAO,OAAO,MAEL,IAAVzN,IAAiBA,EAAQyN,EAAM3N,OAAOE,MAAMC,OAEhD,MAAM+N,EAmBV,SAAiChO,GAC7B,MAAO,iCAAiCkI,EAAoBlI,IAChE,CArBuBiO,CAAwBjO,GAC3CiI,EAAQjI,WAAiB4C,SAAyBoL,GAElD,MAAMF,EAAS7F,EAAQjI,IAAQ6C,WAC/B,IAAKiL,EAAQ,OAAO,KAEpBL,EAAM3N,OAAOoO,SAASC,gBAAkBnO,EAExC8N,EAAOzK,KAAO,aAAaoK,EAAMpK,eAAerD,KAChD8N,EAAOhO,OAAOsO,UAAYL,EAC1BD,EAAOhO,OAAO2N,MAAQA,EACtBK,EAAOhO,OAAO8K,OAAO3K,MAAMI,QAAQoN,EAAM3N,OAAOuL,WAAWpL,OAE3D,MAAMoO,EAAWZ,EAAMa,MAAMC,MAAMF,SAGnC,OAFIA,IAAUP,EAAOhO,OAAO0O,YAAYvO,MAAQ,GO3B7C,SAAkB6J,EAAczG,GACnC,MACO,SAASyG,IACpB,CPwBuD2E,CAASJ,aAAoBP,EAAOhO,OAAO0O,YAAYvO,SAEnG6N,CACX,CMCyBY,CAAkB5E,EAAM9J,GAC7C,GAAI8N,EAAQ,CACRA,EAAOzK,KAAOyK,EAAOzK,KAAO,KAC5B,MAAOoG,SAAejN,EAAMsG,wBAAwB,OAAQ,CAACgL,IAC7DD,EAAe,+BACfD,EAAcnE,EAAKK,I,CAGvBhG,YAAYC,OAAO,CACfkD,QAAS,6CAA6C4G,iBAA4BD,SAClFe,QAAS7K,YAAY8K,WAAW,CAAEpS,MAAOA,KAEjD,CEUA,SAASqS,EAAiBtN,GACF,0BAAhBA,EAAOR,MAAkCe,EAAuBP,EACxE,CpBpDS,IAAW,EoBSR,UAEZlF,MAAMyS,KAAK,QAAQ,MCPZ,SAAsErN,GACzE,OAAO5F,KAAKkT,QAAQhT,IAAI0F,EAC5B,CAGWuN,CAAU,IDGaC,IAAM,CAChCC,OAAQ,CACJ7P,qBAAoB,EACpB6E,cAAa,EACbuC,YAAW,EACXG,gBAAe,EACf4F,SAAQ,EACRK,eAAc,IAItBhR,KAAKC,SAASqT,SAAS,EAAW,MAAO,CACrC9L,KAAM,mBACN+L,KAAM,mCACNrO,KAAMsO,QACNC,SAAS,EACTC,QAAQ,EACRC,MAAO,QACPC,SAAUxT,IAGdJ,KAAKC,SAASqT,SAAS,EAAW,cAAe,CAC7C9L,KAAM,qBACN+L,KAAM,gDACNrO,KAAMiF,OACNsJ,QAAS,EACTC,QAAQ,EACRC,MAAO,SACT,IAGNnT,MAAMyS,KAAK,SAAS,Kf5Cb,IAAyDY,Ee6CxD/T,EAAW,QAAQM,GAAU,GAC7BJ,KAAKM,KAAKC,Of9C8CsT,Ee+C/Cb,Ef9CbhT,KAAKkG,OAAOmD,GAAG,UAAU,IAAawK,G","sources":["webpack:///../../../../foundryVTT-projects/@utils/module.ts","webpack:///../../../../foundryVTT-projects/@utils/foundry/settings.ts","webpack:///./src/modules/bff.ts","webpack:///./src/macros/shared/esoteric.ts","webpack:///./src/macros/exploit-vulnerability.ts","webpack:///../../../../foundryVTT-projects/@utils/socket.ts","webpack:///./src/macros/esoteric.ts","webpack:///../../../../foundryVTT-projects/@utils/foundry/path.ts","webpack:///./src/apps/manual-token.ts","webpack:///./src/macros/manual-token.ts","webpack:///./src/macros/perception.ts","webpack:///../../../../foundryVTT-projects/@utils/pf2e/dc.ts","webpack:///../../../../foundryVTT-projects/@utils/pf2e/spell.ts","webpack:///../../../../foundryVTT-projects/@utils/pf2e/skills.ts","webpack:///./src/apps/identify.ts","webpack:///../../../../foundryVTT-projects/@utils/pf2e/item.ts","webpack:///../../../../foundryVTT-projects/@utils/pf2e/utils.ts","webpack:///./src/macros/identify.ts","webpack:///./src/macros/imaginarium.ts","webpack:///../../../../foundryVTT-projects/@utils/foundry/uuid.ts","webpack:///./src/main.ts","webpack:///../../../../foundryVTT-projects/@utils/foundry/module.ts"],"sourcesContent":["export let MODULE_ID = ''\r\n\r\nexport function setModuleID(id: string) {\r\n    if (!MODULE_ID) MODULE_ID = id\r\n}\r\n","import { MODULE_ID } from '@utils/module'\r\nimport { getSettingLocalizationPath } from '@utils/foundry/path'\r\n\r\nexport function getSetting<T extends any>(key: string) {\r\n    return game.settings.get(MODULE_ID, key) as T\r\n}\r\n\r\nexport function setSetting(key: string, value: unknown) {\r\n    return game.settings.set(MODULE_ID, key, value)\r\n}\r\n\r\n/**\r\n * options.scope = 'world'\r\n *\r\n * options.config = false\r\n */\r\nexport function registerSetting<\r\n    TType extends number | string | boolean | object | Function,\r\n    TChoices extends Record<string, unknown> | undefined\r\n>(options: Omit<SettingRegistration<TType, TChoices>, 'choices'> & { choices?: string[] | Record<string, unknown> }) {\r\n    const name = options.name\r\n    options.scope = options.scope ?? 'world'\r\n    options.config = options.config ?? false\r\n    if (options.config) {\r\n        options.name = getSettingLocalizationPath(name, 'name')\r\n        options.hint = getSettingLocalizationPath(name, 'hint')\r\n    }\r\n    if (Array.isArray(options.choices)) {\r\n        options.choices = options.choices.reduce((choices, choice) => {\r\n            choices[choice] = getSettingLocalizationPath(name, 'choices', choice)\r\n            return choices\r\n        }, {} as Record<string, unknown>)\r\n    }\r\n    game.settings.register(MODULE_ID, name, options as SettingRegistration<TType, TChoices>)\r\n}\r\n\r\n/**\r\n * options.restricted = true\r\n *\r\n * options.icon = 'fas fa-cogs'\r\n */\r\nexport function registerSettingMenu(\r\n    options: RequiredBy<Partial<Omit<SettingSubmenuConfig, 'type'>>, 'name'> & { type: ConstructorOf<FormApplication> }\r\n) {\r\n    const name = options.name\r\n    options.name = getSettingLocalizationPath('menus', name, 'name')\r\n    options.label = getSettingLocalizationPath('menus', name, 'label')\r\n    options.hint = getSettingLocalizationPath('menus', name, 'hint')\r\n    options.restricted = options.restricted ?? true\r\n    options.icon = options.icon ?? 'fas fa-cogs'\r\n    game.settings.registerMenu(MODULE_ID, name, options as SettingSubmenuConfig)\r\n}\r\n\r\nexport function getCombatTrackerConfig() {\r\n    return game.settings.get('core', 'combatTrackerConfig') as { resource: string; skipDefeated: boolean }\r\n}\r\n","import { getSetting } from '@utils/foundry/settings'\r\n\r\nconst effectId = 'Item.pFguo7KVVjFMqHhe'\r\n\r\nexport function enableBFF(enable: boolean) {\r\n    if (!game.user.isGM) return\r\n    const method = enable ? 'on' : 'off'\r\n    Hooks[method]('updateToken', updateToken)\r\n}\r\n\r\nfunction getDebuff(actor: ActorPF2e) {\r\n    return actor.itemTypes.effect.find(x => x.getFlag('core', 'sourceId') === effectId)\r\n}\r\n\r\nfunction updateToken(token: TokenDocument, data: DocumentUpdateData<TokenDocument>) {\r\n    const actor = token.actor as ActorPF2e | undefined\r\n    if (!('x' in data || 'y' in data) || !actor) return\r\n    const debuff = getDebuff(actor)\r\n    if (debuff) setDebuff(token, debuff)\r\n}\r\n\r\nfunction setDebuff(firstToken: TokenDocument, firstDebuff: EffectPF2e) {\r\n    let otherToken\r\n    let otherDebuff\r\n\r\n    const tokens = canvas.tokens.placeables\r\n    for (const token of tokens) {\r\n        const otherActor = token.actor\r\n        if (!otherActor || otherActor === firstToken.actor) continue\r\n        const debuff = getDebuff(otherActor)\r\n        if (!debuff) continue\r\n        otherToken = token\r\n        otherDebuff = debuff\r\n        break\r\n    }\r\n\r\n    if (!otherToken || !otherDebuff) {\r\n        firstDebuff.update({ 'system.badge.value': 0 })\r\n        return\r\n    }\r\n\r\n    const distance = canvas.grid.measureDistance(firstToken, otherToken, { gridSpaces: true })\r\n    const squares = distance / 5\r\n    const debuff = squares <= getSetting<number>('bffDistance') ? 1 : 0\r\n\r\n    firstDebuff.update({ 'system.badge.value': debuff })\r\n    otherDebuff.update({ 'system.badge.value': debuff })\r\n}\r\n","const diverseUUID = 'Compendium.pf2e.feats-srd.KlqKpeq5OmTRxVHb'\r\n\r\nexport function getEsotericSkill(actor: CharacterPF2e) {\r\n    const skillKeys = ['esoteric', 'esoteric-lore', 'lore-esoteric']\r\n    const skill = Object.values(actor.skills).find(x => skillKeys.includes(x!.slug))\r\n\r\n    if (!skill) ui.notifications.warn(`This character doesn't have the 'Esoteric' skill`)\r\n    return skill\r\n}\r\n\r\nexport function esotericCheckTitle() {\r\n    return game.i18n.format('PF2E.SkillCheckWithName', { skillName: 'Esoteric' })\r\n}\r\n\r\nexport function hasDiverseLore(actor: CharacterPF2e) {\r\n    return actor.itemTypes.feat.some(x => x.getFlag('core', 'sourceId') === diverseUUID)\r\n}\r\n","import { socketEmit } from '@utils/socket'\r\nimport { esotericCheckTitle, getEsotericSkill, hasDiverseLore } from './shared/esoteric'\r\n\r\nconst effectID = 'Item.bPm8eSVCrpYiWW2y'\r\nconst effectUUID = 'Compendium.idleuh.effects.MqgbuaqGMJ92VRze'\r\nconst ffUUID = 'Compendium.pf2e.conditionitems.AJh5ex99aV6VTggg'\r\n\r\nexport async function exploitVulnerability(event: JQuery.TriggeredEvent, actor: ActorPF2e) {\r\n    const targets = game.user.targets as Set<TokenPF2e>\r\n    const [target] = targets\r\n    const targetActor = target?.actor\r\n\r\n    if (\r\n        !actor ||\r\n        !actor.isOwner ||\r\n        !actor.isOfType('character') ||\r\n        targets.size !== 1 ||\r\n        !targetActor ||\r\n        !targetActor.isOfType('creature')\r\n    ) {\r\n        ui.notifications.warn('You must select a character token you own and target another one.')\r\n        return\r\n    }\r\n\r\n    const skill = getEsotericSkill(actor)\r\n    if (!skill) return\r\n\r\n    const actionSlug = 'action:recall-knowledge'\r\n    const DCbyLevel = [14, 15, 16, 18, 19, 20, 22, 23, 24, 26, 27, 28, 30, 31, 32, 34, 35, 36, 38, 39, 40, 42, 44, 46, 48, 50]\r\n    const targetLevel = targetActor.system.details.level.value\r\n    const dc = targetLevel < 0 ? 13 : DCbyLevel[targetLevel]\r\n\r\n    const options = actor.getRollOptions(['all', 'skill-check', 'Esoteric'])\r\n    options.push(actionSlug)\r\n    options.push(`secret`)\r\n\r\n    const dv = targetActor.system.attributes.weaknesses\r\n    const vulnerability = dv.reduce((prev, curr) => {\r\n        if (curr.value > prev) return curr.value\r\n        return prev\r\n    }, 0)\r\n\r\n    const weaknesses = dv.filter(x => x.value === vulnerability).map(x => x.type)\r\n\r\n    const roll = (await game.pf2e.Check.roll(\r\n        new game.pf2e.CheckModifier('test', skill),\r\n        {\r\n            actor,\r\n            target: { actor: targetActor, token: target.document },\r\n            title: esotericCheckTitle(),\r\n            type: 'skill-check',\r\n            options,\r\n            dc: { value: dc },\r\n            createMessage: false,\r\n        },\r\n        event\r\n    ))!\r\n\r\n    const packet: ExploitVulnerabilityPacket = {\r\n        type: 'exploit-vulnerability',\r\n        actorId: actor.id,\r\n        targetId: target.id,\r\n        vulnerability,\r\n        weaknesses,\r\n        dc,\r\n        total: roll.total ?? 0,\r\n        die: roll.dice[0].total ?? 0,\r\n    }\r\n\r\n    if (game.user.isGM) exploitVulnerabilityGM(packet)\r\n    else socketEmit(packet)\r\n}\r\n\r\nexport async function exploitVulnerabilityGM({\r\n    actorId,\r\n    targetId,\r\n    vulnerability,\r\n    weaknesses,\r\n    dc,\r\n    total,\r\n    die,\r\n}: ExploitVulnerabilityPacket) {\r\n    const actor = game.actors.get<CharacterPF2e>(actorId)\r\n    const targetActor = canvas.tokens.get(targetId)?.actor as ActorPF2e | undefined | null\r\n    if (!actor || !targetActor) return\r\n\r\n    const success = getSuccess(total, die, dc)\r\n\r\n    canvas.tokens.placeables.forEach(token => {\r\n        const tokenActor = token.actor as ActorPF2e\r\n        if (!tokenActor || tokenActor === actor) return\r\n\r\n        const effect = getEffect(tokenActor)\r\n\r\n        if (tokenActor === targetActor) {\r\n            if (success <= 0 && effect) effect.delete()\r\n            else if (success >= 1 && !effect) addEffect(tokenActor)\r\n        } else if (effect) {\r\n            effect.delete()\r\n        }\r\n    })\r\n\r\n    const effect = getEffect(actor)\r\n    if (success >= 1) {\r\n        const badge = (success >= 2 && vulnerability) || 1\r\n        if (!effect) addEffect(actor, badge)\r\n        else if (effect.badge?.value !== badge) effect.update({ 'system.badge.value': badge })\r\n    } else {\r\n        effect?.delete()\r\n        addFlatFooted(actor)\r\n    }\r\n\r\n    createMsg(actor, targetActor, dc, total, die, success, vulnerability, weaknesses)\r\n}\r\n\r\nfunction getSuccess(total: number, die: number, dc: number) {\r\n    let success = total >= dc + 10 ? 3 : total >= dc ? 2 : total > dc - 10 ? 1 : 0\r\n    if (die === 20) success++\r\n    else if (die === 1) success--\r\n    return success\r\n}\r\n\r\nfunction createMsg(\r\n    actor: CharacterPF2e,\r\n    target: ActorPF2e,\r\n    dc: number,\r\n    total: number,\r\n    die: number,\r\n    success: number,\r\n    vulnerability: number,\r\n    weaknesses: string[]\r\n) {\r\n    const by = total - dc\r\n    const mod = total - die\r\n    const css = success >= 3 ? 'criticalSuccess' : success === 2 ? 'success' : success === 1 ? 'failure' : 'criticalFailure'\r\n    const txt = success >= 3 ? 'Critical Success' : success === 2 ? 'Success' : success === 1 ? 'Failure' : 'Critical Failure'\r\n\r\n    let flavor = `<h4 class=\"action\"><span class=\"pf2-icon\">A</span> <b>Exploit Vulnerability</b> <p class=\"compact-text\">(Esoteric Check)</p></h4>\r\n<div class=\"target-dc-result\" data-visibility=\"gm\">\r\n    <div class=\"target-dc\" data-visibility=\"gm\"><span data-visibility=\"gm\" data-whose=\"target\">\r\n        Target: ${target.name}</span> <span data-visibility=\"gm\" data-whose=\"target\">(Standard DC ${dc})</span></div>\r\n    <div class=\"result degree-of-success\" data-visibility=\"gm\">\r\n        Result: <span title=\"Roll: ${die} ${mod >= 0 ? '+' : '-'} ${Math.abs(mod)}\">${total}</span> \r\n        <span data-whose=\"self\" class=\"${css}\">${txt}</span> <span data-whose=\"target\">by ${by >= 0 ? '+' : ''}${by}</span>\r\n    </div>\r\n</div>`\r\n\r\n    if (success >= 2 && weaknesses.length) {\r\n        flavor += `<div><strong>[ ${weaknesses.join(', ')} ]</strong> = ${vulnerability}</div>`\r\n    }\r\n\r\n    flavor += '<section class=\"roll-note\">'\r\n    if (success >= 3) {\r\n        flavor += `<strong>Critical Success</strong> You remember the creature's weaknesses, and as you empower your esoterica, \r\nyou have a flash of insight that grants even more knowledge about the creature. \r\nYou learn all of the creature's resistances, weaknesses, and immunities, \r\nincluding the amounts of the resistances and weaknesses and any unusual weaknesses or vulnerabilities, \r\nsuch as what spells will pass through a golem's antimagic. \r\nYou can exploit either the creature's mortal weakness or personal antithesis (see the Exploit Vulnerability class feature). \r\nYour unarmed and weapon Strikes against the creature also become magical if they weren't already.`\r\n    } else if (success === 2) {\r\n        flavor += `<strong>Success</strong> You recall an important fact about the creature, \r\nlearning its highest weakness (or one of its highest weaknesses, if it has multiple with the same value) but not its other weaknesses, \r\nresistances, or immunities. You can exploit either the creature's mortal weakness or personal antithesis. \r\nYour unarmed and weapon Strikes against the creature also become magical if they weren't already.`\r\n    } else if (success === 1) {\r\n        flavor += `<strong>Failure</strong> Failing to recall a salient weakness about the creature, \r\nyou instead attempt to exploit a more personal vulnerability. \r\nYou can exploit only the creature's personal antithesis. \r\nYour unarmed and weapon Strikes against the creature also become magical if they weren't already.`\r\n    } else {\r\n        flavor += `<strong>Critical Failure</strong> You couldn't remember the right object to use and become distracted while you rummage \r\nthrough your esoterica. You become flat-footed until the beginning of your next turn.`\r\n    }\r\n    flavor += '</section>'\r\n\r\n    if (hasDiverseLore(actor) && success >= 2) flavor += getDiverseLoreMsg(target, total, die)\r\n\r\n    ChatMessage.create({ flavor, actor })\r\n}\r\n\r\nfunction getDiverseLoreMsg(target: ActorPF2e, total: number, die: number) {\r\n    const progression = (target as NPCPF2e).system.details.identification?.skill.progression ?? []\r\n    const knowledges = progression.map(dc => {\r\n        const success = getSuccess(total, die, dc)\r\n        const color = success >= 3 ? 'green' : success === 2 ? 'blue' : '#ff4500'\r\n        const title = success >= 3 ? 'Critical Success' : success === 2 ? 'Success' : 'Failure'\r\n        return `<span style=\"color: ${color};\" title=\"${title}\">${dc}</span>`\r\n    })\r\n    const dcs = knowledges.length ? ` <span data-visibility=\"gm\">${knowledges.join(', ')}</span>` : ''\r\n\r\n    return `<section class=\"roll-note\">\r\n    <strong>Diverse Lore</strong> Compare the result of your Esoteric Lore check to the DC${dcs} to Recall Knowledge for that creature; \r\n    if that number would be a success or a critical success, you gain information as if you had succeeded at the Recall Knowledge check.\r\n</section>`\r\n}\r\n\r\nfunction getEffect(actor: ActorPF2e) {\r\n    return actor.itemTypes.effect.find(effect => effect.getFlag('core', 'sourceId') === effectID)\r\n}\r\n\r\nasync function addEffect(actor: ActorPF2e, badge?: number) {\r\n    const data = ((await fromUuid(effectUUID)) as EffectPF2e).toObject()\r\n    if (badge) setProperty(data, 'system.badge.value', badge)\r\n    actor.createEmbeddedDocuments('Item', [data])\r\n}\r\n\r\nasync function addFlatFooted(actor: ActorPF2e) {\r\n    const hasEffect = actor.itemTypes.condition.some(x => x.getFlag('core', 'sourceId') === ffUUID)\r\n    if (hasEffect) return\r\n\r\n    const data = ((await fromUuid(ffUUID)) as ConditionPF2e).toObject()\r\n    actor.createEmbeddedDocuments('Item', [data])\r\n}\r\n","import { MODULE_ID } from '@utils/module'\r\n\r\nexport function socketOn<T extends SocketPacket = SocketPacket>(callback: SocketCallback<T>) {\r\n    game.socket.on(`module.${MODULE_ID}`, callback)\r\n}\r\n\r\nexport function socketEmit<T extends SocketPacket = SocketPacket>(packet: T) {\r\n    game.socket.emit(`module.${MODULE_ID}`, packet)\r\n}\r\n","import { esotericCheckTitle, getEsotericSkill, hasDiverseLore } from './shared/esoteric'\r\n\r\nexport function esotericCheck(event: JQuery.TriggeredEvent, actor: ActorPF2e) {\r\n    if (!actor || !actor.isOwner || !actor.isOfType('character')) {\r\n        ui.notifications.warn('You must select a character token you own.')\r\n        return\r\n    }\r\n\r\n    const skill = getEsotericSkill(actor)\r\n    if (!skill) return\r\n\r\n    const options = new Set<string>()\r\n    const title = esotericCheckTitle()\r\n\r\n    let flavor = `<h4 class=\"action\">${title}</h4><section class=\"roll-note\">Can be used to Recall Knowledge regarding haunts, curses \r\nand creatures of any type, but can't be used to Recall Knowledge of other topics.</section>`\r\n\r\n    if (event.ctrlKey && hasDiverseLore(actor)) {\r\n        options.add('diverse-lore')\r\n\r\n        flavor += `<section class=\"roll-note\"><strong>Diverse Lore</strong> You can take a -2 penalty to your check to Recall \r\nKnowledge about any topic, not just the usual topics available for Esoteric Lore.</section>`\r\n    }\r\n\r\n    game.pf2e.Check.roll(\r\n        new game.pf2e.CheckModifier(flavor, skill),\r\n        {\r\n            actor,\r\n            title,\r\n            type: 'skill-check',\r\n            rollMode: 'blindroll',\r\n            options,\r\n        },\r\n        event\r\n    )\r\n}\r\n","import { MODULE_ID } from '@utils/module'\r\n\r\nexport function getSettingLocalizationPath(...path: string[]) {\r\n    return `${MODULE_ID}.settings.${path.join('.')}`\r\n}\r\n\r\nexport function flagsUpdatePath(...path: string[]) {\r\n    return `flags.${MODULE_ID}.${path.join('/')}`\r\n}\r\n\r\nexport function templatePath(...path: string[]) {\r\n    path = path.filter(x => typeof x === 'string')\r\n    return `modules/${MODULE_ID}/templates/${path.join('/')}`\r\n}\r\n\r\nexport function imagePath(...path: string[]) {\r\n    return `modules/${MODULE_ID}/images/${path.join('/')}`\r\n}\r\n","import { templatePath } from '@utils/foundry/path'\r\n\r\nexport class ManualToken extends FormApplication<TokenDocumentPF2e> {\r\n    static get defaultOptions(): FormApplicationOptions {\r\n        return mergeObject(super.defaultOptions, {\r\n            id: 'idleuh-manual-token',\r\n            template: templatePath('manual-token.html'),\r\n            title: 'Manual Token Update',\r\n            width: 500,\r\n        })\r\n    }\r\n\r\n    activateListeners(html: JQuery<HTMLElement>): void {\r\n        super.activateListeners(html)\r\n\r\n        html.find('button[type=button]').on('click', () => this.close())\r\n\r\n        const scale = html.find('input[name=scale]') as JQuery<HTMLInputElement>\r\n        const scaleValue = scale.next('span')\r\n        scale.on('input', () => {\r\n            const val = scale[0].valueAsNumber\r\n            scaleValue.text(val.toFixed(2))\r\n        })\r\n\r\n        const grid = html.find('input[name=grid]') as JQuery<HTMLInputElement>\r\n        const gridValue = grid.next('span')\r\n        grid.on('input', () => {\r\n            const val = grid[0].valueAsNumber\r\n            gridValue.text(val.toFixed(1))\r\n        })\r\n    }\r\n\r\n    protected async _updateObject(event: Event, formData: Record<string, unknown>) {\r\n        const data = this.object\r\n\r\n        const newData = {\r\n            ['displayName']: Number(formData.name),\r\n            ['displayBars']: Number(formData.hp),\r\n            ['texture.src']: formData.img,\r\n            ['flags.pf2e.linkToActorSize']: !!formData.link,\r\n            ['width']: Number(formData.grid),\r\n            ['height']: Number(formData.grid),\r\n            ['texture.scaleX']: Number(formData.scale),\r\n            ['texture.scaleY']: Number(formData.scale),\r\n        }\r\n\r\n        const update = {}\r\n        for (const [k, v] of Object.entries(newData)) {\r\n            if (getProperty(data, k) === v) continue\r\n            setProperty(update, k, v)\r\n        }\r\n\r\n        if (Object.keys(update).length) this.object.update(update)\r\n    }\r\n}\r\n","import { ManualToken } from '@apps/manual-token'\r\n\r\nexport async function manualToken(token: TokenPF2e) {\r\n    if (!token || !token.isOwner) {\r\n        ui.notifications.warn('You need to select an owned token.')\r\n        return\r\n    }\r\n    new ManualToken(token.document).render(true)\r\n}\r\n","const proficiency = ['trained', 'expert', 'master', 'legendary', 'untrained']\r\n\r\nexport async function groupPerception() {\r\n    if (!game.user.isGM) {\r\n        ui.notifications.warn('You not the GM yo!')\r\n        return\r\n    }\r\n\r\n    let result = '<hr>'\r\n\r\n    const tokens = canvas.tokens\r\n    for (const token of tokens.placeables) {\r\n        const actor = token.actor\r\n        if (!actor || !actor.isOfType('character', 'npc') || !actor.hasPlayerOwner || !actor.attributes.perception) continue\r\n        result += await rollPerception(actor)\r\n    }\r\n\r\n    ChatMessage.create({ content: result, flavor: 'Group Perception Checks', whisper: [game.user.id] })\r\n}\r\n\r\nasync function rollPerception(actor: CharacterPF2e | NPCPF2e) {\r\n    const perception = actor.attributes.perception\r\n    const check = new game.pf2e.CheckModifier('', perception)\r\n    const roll = await game.pf2e.Check.roll(check, { actor: actor, type: 'skill-check', createMessage: false, skipDialog: true })\r\n    if (!roll) return ''\r\n\r\n    const rank = proficiency[(perception.rank ?? 1) - 1]\r\n    const die = roll.dice[0].total\r\n    if (die === undefined) return ''\r\n\r\n    let result = `<div style=\"display:flex;justify-content:space-between;\" title=\"${roll.result}\">`\r\n    result += `<span>${actor.name} (${rank})</span><span`\r\n    if (die == 20) result += ' style=\"color: green;\"'\r\n    else if (die == 1) result += ' style=\"color: red;\"'\r\n\r\n    return `${result}>${roll.total}</span></div>`\r\n}\r\n","const dcByLevel = new Map<number, number>()\r\ndcByLevel.set(-1, 13)\r\ndcByLevel.set(0, 14)\r\ndcByLevel.set(1, 15)\r\ndcByLevel.set(2, 16)\r\ndcByLevel.set(3, 18)\r\ndcByLevel.set(4, 19)\r\ndcByLevel.set(5, 20)\r\ndcByLevel.set(6, 22)\r\ndcByLevel.set(7, 23)\r\ndcByLevel.set(8, 24)\r\ndcByLevel.set(9, 26)\r\ndcByLevel.set(10, 27)\r\ndcByLevel.set(11, 28)\r\ndcByLevel.set(12, 30)\r\ndcByLevel.set(13, 31)\r\ndcByLevel.set(14, 32)\r\ndcByLevel.set(15, 34)\r\ndcByLevel.set(16, 35)\r\ndcByLevel.set(17, 36)\r\ndcByLevel.set(18, 38)\r\ndcByLevel.set(19, 39)\r\ndcByLevel.set(20, 40)\r\ndcByLevel.set(21, 42)\r\ndcByLevel.set(22, 44)\r\ndcByLevel.set(23, 46)\r\ndcByLevel.set(24, 48)\r\ndcByLevel.set(25, 50)\r\n\r\nconst dcAdjustments = new Map<DCAdjustment, number>()\r\ndcAdjustments.set('incredibly easy', -10)\r\ndcAdjustments.set('very easy', -5)\r\ndcAdjustments.set('easy', -2)\r\ndcAdjustments.set('normal', 0)\r\ndcAdjustments.set('hard', 2)\r\ndcAdjustments.set('very hard', 5)\r\ndcAdjustments.set('incredibly hard', 10)\r\n\r\n/**\r\n * Normal Level Based DCs\r\n * @param level\r\n * @param proficiencyWithoutLevel\r\n */\r\nexport function calculateDC(level: number, { proficiencyWithoutLevel = false, rarity = 'common' }: DCOptions = {}): number {\r\n    // assume level 0 if garbage comes in. We cast level to number because the backing data may actually have it\r\n    // stored as a string, which we can't catch at compile time\r\n    const dc = dcByLevel.get(level) ?? 14\r\n    if (proficiencyWithoutLevel) {\r\n        // -1 shouldn't be subtracted since it's just\r\n        // a creature level and not related to PC levels\r\n        return adjustDCByRarity(dc - Math.max(level, 0), rarity)\r\n    } else {\r\n        return adjustDCByRarity(dc, rarity)\r\n    }\r\n}\r\n\r\nexport function adjustDCByRarity(dc: number, rarity: Rarity = 'common') {\r\n    return adjustDC(dc, rarityToDCAdjustment(rarity))\r\n}\r\n\r\nexport function adjustDC(dc: number, adjustment: DCAdjustment = 'normal') {\r\n    return dc + (dcAdjustments.get(adjustment) ?? 0)\r\n}\r\n\r\nexport function rarityToDCAdjustment(rarity: Rarity = 'common'): PositiveDCAdjustment {\r\n    if (rarity === 'uncommon') {\r\n        return 'hard'\r\n    } else if (rarity === 'rare') {\r\n        return 'very hard'\r\n    } else if (rarity === 'unique') {\r\n        return 'incredibly hard'\r\n    } else {\r\n        return 'normal'\r\n    }\r\n}\r\n","import { chatUUID } from '@utils/foundry/uuid'\r\n\r\nexport const MAGIC_TRADITIONS = new Set(['arcane', 'divine', 'occult', 'primal'] as const)\r\n\r\nexport const SPELL_COMPONENTS = ['focus', 'material', 'somatic', 'verbal'] as const\r\n\r\nconst scrolls: (ConsumablePF2e | null)[] = []\r\nexport async function createSpellScroll(uuid: ItemUUID, level: OneToTen | false, temp = false) {\r\n    const spell = (await fromUuid<SpellPF2e>(uuid))?.toObject()\r\n    if (!spell) return null\r\n\r\n    if (level === false) level = spell.system.level.value\r\n\r\n    const scrollUUID = getScrollCompendiumUUID(level)\r\n    scrolls[level] ??= await fromUuid<ConsumablePF2e>(scrollUUID)\r\n\r\n    const scroll = scrolls[level]?.toObject()\r\n    if (!scroll) return null\r\n\r\n    spell.system.location.heightenedLevel = level\r\n\r\n    scroll.name = `Scroll of ${spell.name} (Level ${level})`\r\n    scroll.system.temporary = temp\r\n    scroll.system.spell = spell\r\n    scroll.system.traits.value.push(...spell.system.traditions.value)\r\n\r\n    const sourceId = spell.flags.core?.sourceId\r\n    if (sourceId) scroll.system.description.value = `${chatUUID(sourceId)}\\n<hr />${scroll.system.description.value}`\r\n\r\n    return scroll\r\n}\r\n\r\nfunction getScrollCompendiumUUID(level: OneToTen): ItemUUID {\r\n    return `Compendium.pf2e.equipment-srd.${scrollCompendiumIds[level]}`\r\n}\r\n\r\nconst scrollCompendiumIds: Record<number, string> = {\r\n    1: 'RjuupS9xyXDLgyIr', // Compendium.pf2e.equipment-srd.RjuupS9xyXDLgyIr\r\n    2: 'Y7UD64foDbDMV9sx',\r\n    3: 'ZmefGBXGJF3CFDbn',\r\n    4: 'QSQZJ5BC3DeHv153',\r\n    5: 'tjLvRWklAylFhBHQ',\r\n    6: '4sGIy77COooxhQuC',\r\n    7: 'fomEZZ4MxVVK3uVu',\r\n    8: 'iPki3yuoucnj7bIt',\r\n    9: 'cFHomF3tty8Wi1e5',\r\n    10: 'o1XIHJ4MJyroAHfF',\r\n}\r\n","export const SKILL_DICTIONARY = {\r\n    acr: 'acrobatics',\r\n    arc: 'arcana',\r\n    ath: 'athletics',\r\n    cra: 'crafting',\r\n    dec: 'deception',\r\n    dip: 'diplomacy',\r\n    itm: 'intimidation',\r\n    med: 'medicine',\r\n    nat: 'nature',\r\n    occ: 'occultism',\r\n    prf: 'performance',\r\n    rel: 'religion',\r\n    soc: 'society',\r\n    ste: 'stealth',\r\n    sur: 'survival',\r\n    thi: 'thievery',\r\n} as const\r\n\r\nexport const SKILL_ABBREVIATIONS = Object.keys(SKILL_DICTIONARY) as (keyof typeof SKILL_DICTIONARY)[]\r\n\r\nexport const SKILL_LONG_FORMS = Object.values(SKILL_DICTIONARY)\r\n","import { templatePath } from '@utils/foundry/path'\r\nimport { identifyItem } from '@utils/pf2e/item'\r\nimport { SKILL_ABBREVIATIONS, SKILL_DICTIONARY } from '@utils/pf2e/skills'\r\n\r\nexport class Identify extends Application {\r\n    items: PhysicalItemPF2e[]\r\n\r\n    constructor(items: PhysicalItemPF2e[], options?: Partial<ApplicationOptions>) {\r\n        super(options)\r\n        this.items = items\r\n    }\r\n\r\n    static get defaultOptions() {\r\n        return mergeObject(super.defaultOptions, {\r\n            id: 'idleuh-identify',\r\n            title: 'Identify Items',\r\n            template: templatePath('identify.html'),\r\n            width: 500,\r\n        })\r\n    }\r\n\r\n    getData(options?: Partial<ApplicationOptions> | undefined) {\r\n        return mergeObject(super.getData(options), {\r\n            items: this.items.map(item => {\r\n                const data = item.system.identification.identified\r\n                const identified = item.isIdentified\r\n                const checked = !identified && (item.getFlag('world', 'identify.checked') as boolean)\r\n\r\n                const classes = [] as string[]\r\n                if (identified) classes.push('identified')\r\n                if (checked) classes.push('checked')\r\n\r\n                return {\r\n                    uuid: item.uuid,\r\n                    img: data.img,\r\n                    name: item.isOfType('treasure') ? `($) ${data.name}` : data.name,\r\n                    css: classes.join(' '),\r\n                    identified,\r\n                    checked,\r\n                }\r\n            }),\r\n        })\r\n    }\r\n\r\n    activateListeners(html: JQuery<HTMLElement>) {\r\n        // super.activateListeners(html)\r\n\r\n        html.find('[data-action=\"chat\"]').on('click', this.#onChat.bind(this))\r\n        html.find('[data-action=\"checks\"]').on('click', this.#onChecks.bind(this))\r\n        html.find('[data-action=\"identify\"]').on('click', this.#onIdentify.bind(this))\r\n        html.find('[data-action=\"remove\"]').on('click', this.#onRemove.bind(this))\r\n        html.find('[data-action=\"reset\"]').on('click', this.#onReset.bind(this))\r\n    }\r\n\r\n    async #onChat(event: JQuery.ClickEvent<any, any, HTMLElement>) {\r\n        const item = await getItemFromEvent(event)\r\n        item?.toMessage(undefined, { create: true })\r\n    }\r\n\r\n    async #onChecks(event: JQuery.ClickEvent<any, any, HTMLElement>) {\r\n        const item = await getItemFromEvent(event)\r\n        if (!item) return\r\n\r\n        const itemImg = item.system.identification.unidentified.img\r\n        const itemName = item.system.identification.unidentified.name\r\n        const identifiedName = item.system.identification.identified.name\r\n\r\n        const notMatchingTraditionModifier = game.settings.get('pf2e', 'identifyMagicNotMatchingTraditionModifier') as number\r\n        const proficiencyWithoutLevel = game.settings.get('pf2e', 'proficiencyVariant') === 'ProficiencyWithoutLevel'\r\n        const dcs = identifyItem(item, { proficiencyWithoutLevel, notMatchingTraditionModifier })\r\n\r\n        const skills = Object.entries(dcs).map(([shortForm, dc]) => {\r\n            shortForm = shortForm === 'dc' ? 'cra' : shortForm\r\n            const name = game.i18n.localize(SKILL_DICTIONARY[shortForm as SkillAbbreviation])\r\n            return { shortForm, dc, name }\r\n        })\r\n\r\n        const content = await renderTemplate('systems/pf2e/templates/actors/identify-item-chat-skill-checks.hbs', {\r\n            itemImg,\r\n            itemName,\r\n            identifiedName,\r\n            skills,\r\n        })\r\n\r\n        await ChatMessage.create({ user: game.user.id, content })\r\n    }\r\n\r\n    async #onIdentify(event: JQuery.ClickEvent<any, any, HTMLElement>) {\r\n        const item = await getItemFromEvent(event)\r\n        if (!item) return\r\n\r\n        await item.update({\r\n            'system.identification.status': item.isIdentified ? 'unidentified' : 'identified',\r\n            'system.identification.unidentified': item.getMystifiedData('unidentified'),\r\n            'flags.world.identify.checked': false,\r\n        })\r\n\r\n        this.render()\r\n    }\r\n\r\n    async #onRemove(event: JQuery.ClickEvent<any, any, HTMLElement>) {\r\n        const item = await getItemFromEvent(event)\r\n        if (!item) return\r\n\r\n        const checked = item.getFlag('world', 'identify.checked')\r\n        await item.setFlag('world', 'identify.checked', !checked)\r\n\r\n        this.render()\r\n    }\r\n\r\n    async #onReset(event: JQuery.ClickEvent) {\r\n        event.preventDefault()\r\n\r\n        for (const item of this.items) {\r\n            if (item.isIdentified || !item.getFlag('world', 'identify.checked')) continue\r\n            await item.setFlag('world', 'identify.checked', false)\r\n        }\r\n\r\n        this.render()\r\n    }\r\n}\r\n\r\nasync function getItemFromEvent(event: JQuery.TriggeredEvent<any, any, HTMLElement>) {\r\n    const parent = $(event.currentTarget).closest('[data-item]')\r\n    const uuid = parent.attr('data-item') as string\r\n    const item = await fromUuid(uuid)\r\n    if (!item) parent.remove()\r\n    return item as PhysicalItemPF2e | null\r\n}\r\n","import { adjustDCByRarity, calculateDC } from '@utils/pf2e/dc'\r\nimport { MAGIC_TRADITIONS } from '@utils/pf2e/spell'\r\nimport { setHasElement } from '@utils/pf2e/utils'\r\n\r\nexport function identifyItem(\r\n    item: PhysicalItemPF2e,\r\n    { proficiencyWithoutLevel = false, notMatchingTraditionModifier }: IdentifyItemOptions\r\n): GenericIdentifyDCs | IdentifyMagicDCs | IdentifyAlchemyDCs {\r\n    const baseDC = calculateDC(item.level, { proficiencyWithoutLevel })\r\n    const rarity = getDcRarity(item)\r\n    const dc = adjustDCByRarity(baseDC, rarity)\r\n    if (item.isMagical) {\r\n        return identifyMagic(item, dc, notMatchingTraditionModifier)\r\n    } else if (item.isAlchemical) {\r\n        return { cra: dc }\r\n    } else {\r\n        return { dc: dc }\r\n    }\r\n}\r\n\r\n/** All cursed items are incredibly hard to identify */\r\nfunction getDcRarity(item: PhysicalItemPF2e): Rarity {\r\n    return item.traits.has('cursed') ? 'unique' : item.rarity\r\n}\r\n\r\nfunction identifyMagic(item: PhysicalItemPF2e, baseDc: number, notMatchingTraditionModifier: number) {\r\n    const result = {\r\n        occult: baseDc,\r\n        primal: baseDc,\r\n        divine: baseDc,\r\n        arcane: baseDc,\r\n    }\r\n    const traditions = getMagicTraditions(item)\r\n    for (const key of MAGIC_TRADITIONS) {\r\n        // once an item has a magic tradition, all skills\r\n        // that don't match the tradition are hard\r\n        if (traditions.size > 0 && !traditions.has(key)) {\r\n            result[key] = baseDc + notMatchingTraditionModifier\r\n        }\r\n    }\r\n    return { arc: result.arcane, nat: result.primal, rel: result.divine, occ: result.occult }\r\n}\r\n\r\n/**\r\n * Extract all traits from an item, that match a magic tradition\r\n */\r\nfunction getMagicTraditions(item: PhysicalItemPF2e): Set<MagicTradition> {\r\n    const traits: string[] = item.system.traits.value\r\n    return new Set(traits.filter((t): t is MagicTradition => setHasElement(MAGIC_TRADITIONS, t)))\r\n}\r\n","/** Check if an element is present in the provided set. Especially useful for checking against literal sets */\r\nexport function setHasElement<T extends Set<unknown>>(set: T, value: unknown): value is SetElement<T> {\r\n    return set.has(value)\r\n}\r\n","import { Identify } from '@apps/identify'\r\n\r\nexport function identify() {\r\n    if (!game.user.isGM) {\r\n        ui.notifications.warn('You not the GM yo!')\r\n        return\r\n    }\r\n\r\n    const actors = game.actors\r\n    const items = actors.reduce((acc, actor) => {\r\n        if (!actor.hasPlayerOwner) return acc\r\n        const filtered = actor.items.filter(item => item.isOfType('physical') && !item.isIdentified) as PhysicalItemPF2e[]\r\n        acc.push(...filtered)\r\n        return acc\r\n    }, [] as PhysicalItemPF2e[])\r\n\r\n    new Identify(items).render(true)\r\n}\r\n","import { createSpellScroll } from '@utils/pf2e/spell'\r\n\r\nconst packId = 'pf2e.spells-srd'\r\nconst bookId = 'Item.dcALVAyJbYSovzqt'\r\n\r\nexport async function ripImaginarium(actor: ActorPF2e) {\r\n    if (!actor) return ui.notifications.warn('You must select an actor with the Imaginarium')\r\n\r\n    const book = actor.itemTypes.equipment.find(x => x.getFlag('core', 'sourceId') === bookId)\r\n    if (!book || book.system.equipped.carryType === 'dropped')\r\n        return ui.notifications.warn(\"This actor doesn't have the Imaginarium in their possession\")\r\n\r\n    const level = Math.floor(actor.level / 2) as OneToTen\r\n    const pack = game.packs.get(packId)!\r\n    const index = await pack.getIndex({ fields: ['system.level.value', 'system.traits', 'system.category.value'] })\r\n\r\n    const spells = index.filter(\r\n        x =>\r\n            x.system.level.value <= level &&\r\n            !x.system.traits.value.includes('cantrip') &&\r\n            x.system.category.value !== 'ritual' &&\r\n            x.system.category.value !== 'focus' &&\r\n            x.system.traits.rarity === 'common'\r\n    )\r\n\r\n    const roll = Math.floor(Math.random() * spells.length)\r\n    const spell = spells[roll]\r\n    const uuid = `Compendium.${packId}.${spell._id}` as ItemUUID\r\n\r\n    let messageUUID = uuid\r\n    let extraMessage = ''\r\n    const scroll = await createSpellScroll(uuid, level)\r\n    if (scroll) {\r\n        scroll.name = scroll.name + ' *'\r\n        const [item] = (await actor.createEmbeddedDocuments('Item', [scroll])) as ItemPF2e[]\r\n        extraMessage = ' and received the following:'\r\n        messageUUID = item.uuid\r\n    }\r\n\r\n    ChatMessage.create({\r\n        content: `<p>Ripped the last page of the Imaginarium${extraMessage}</p><p>@UUID[${messageUUID}]</p>`,\r\n        speaker: ChatMessage.getSpeaker({ actor: actor as Actor }),\r\n    })\r\n}\r\n","export function chatUUID(uuid: string, name?: string) {\r\n    if (name) return `@UUID[${uuid}]{${name}}`\r\n    return `@UUID[${uuid}]`\r\n}\r\n\r\nexport function fakeChatUUID(name: string) {\r\n    return `<span style=\"background: #DDD;\r\n    padding: 1px 4px;\r\n    border: 1px solid var(--color-border-dark-tertiary);\r\n    border-radius: 2px;\r\n    white-space: nowrap;\r\n    word-break: break-all;\">${name}</span>`\r\n}\r\n","import { MODULE_ID, setModuleID } from '@utils/module'\r\nimport { socketOn } from '@utils/socket'\r\nimport { getCurrentModule } from '@utils/foundry/module'\r\nimport { getSetting } from '@utils/foundry/settings'\r\nimport { enableBFF } from './modules/bff'\r\nimport { exploitVulnerability, exploitVulnerabilityGM } from './macros/exploit-vulnerability'\r\nimport { esotericCheck } from './macros/esoteric'\r\nimport { manualToken } from './macros/manual-token'\r\nimport { groupPerception } from './macros/perception'\r\nimport { identify } from './macros/identify'\r\nimport { ripImaginarium } from './macros/imaginarium'\r\n\r\nsetModuleID('idleuh')\r\n\r\nHooks.once('init', () => {\r\n    getCurrentModule<IdleuhApi>().api = {\r\n        macros: {\r\n            exploitVulnerability,\r\n            esotericCheck,\r\n            manualToken,\r\n            groupPerception,\r\n            identify,\r\n            ripImaginarium,\r\n        },\r\n    }\r\n\r\n    game.settings.register(MODULE_ID, 'bff', {\r\n        name: \"Enable BFF's Ire\",\r\n        hint: \"Should the BFF's Ire be handled.\",\r\n        type: Boolean,\r\n        default: true,\r\n        config: true,\r\n        scope: 'world',\r\n        onChange: enableBFF,\r\n    })\r\n\r\n    game.settings.register(MODULE_ID, 'bffDistance', {\r\n        name: \"BFF's Ire Distance\",\r\n        hint: 'Distance in square(s) for the curse to apply.',\r\n        type: Number,\r\n        default: 1,\r\n        config: true,\r\n        scope: 'world',\r\n    })\r\n})\r\n\r\nHooks.once('ready', () => {\r\n    if (getSetting('bff')) enableBFF(true)\r\n    if (game.user.isGM) {\r\n        socketOn(onPacketReceived)\r\n    }\r\n})\r\n\r\nfunction onPacketReceived(packet: ModulePacket) {\r\n    if (packet.type === 'exploit-vulnerability') exploitVulnerabilityGM(packet)\r\n}\r\n","import { MODULE_ID } from '@utils/module'\r\n\r\ntype OwnModule = 'anonymous' | 'idleuh' | 'pf2e-hero-actions'\r\n\r\ntype ReturnedModule<T extends Record<string, any> | unknown = unknown> = Module<T> | undefined\r\ntype ReturnedModuleApi<T extends Record<string, any>> = Module<T>['api'] | undefined\r\n\r\nexport function getModule<T extends Record<string, any> | unknown = unknown>(id: string | OwnModule) {\r\n    return game.modules.get(id) as ReturnedModule<T>\r\n}\r\n\r\nexport function getCurrentModule<T extends Record<string, any> | unknown = unknown>() {\r\n    return getModule(MODULE_ID) as Module<T>\r\n}\r\n\r\nexport function getModuleApi<T extends Record<string, any>>(id: string | OwnModule) {\r\n    return getModule<T>(id)?.api as ReturnedModuleApi<T>\r\n}\r\n"],"names":["getSetting","key","game","settings","get","effectId","enableBFF","enable","user","isGM","Hooks","updateToken","getDebuff","actor","itemTypes","effect","find","x","getFlag","token","data","debuff","firstToken","firstDebuff","otherToken","otherDebuff","tokens","canvas","placeables","otherActor","update","grid","measureDistance","gridSpaces","setDebuff","diverseUUID","getEsotericSkill","skillKeys","skill","Object","values","skills","includes","slug","ui","notifications","warn","esotericCheckTitle","i18n","format","skillName","hasDiverseLore","feat","some","effectID","effectUUID","ffUUID","async","exploitVulnerability","event","targets","target","targetActor","isOwner","isOfType","size","targetLevel","system","details","level","value","dc","options","getRollOptions","push","dv","attributes","weaknesses","vulnerability","reduce","prev","curr","filter","map","type","roll","pf2e","Check","CheckModifier","document","title","createMessage","packet","actorId","id","targetId","total","die","dice","exploitVulnerabilityGM","socket","emit","socketEmit","actors","success","getSuccess","forEach","tokenActor","getEffect","delete","addEffect","badge","condition","fromUuid","toObject","createEmbeddedDocuments","addFlatFooted","by","mod","css","txt","flavor","name","Math","abs","length","join","knowledges","identification","progression","getDiverseLoreMsg","ChatMessage","create","createMsg","setProperty","esotericCheck","Set","ctrlKey","add","rollMode","templatePath","path","ManualToken","FormApplication","defaultOptions","mergeObject","super","template","width","activateListeners","html","on","this","close","scale","scaleValue","next","val","valueAsNumber","text","toFixed","gridValue","formData","object","newData","Number","hp","img","link","k","v","entries","getProperty","keys","manualToken","render","proficiency","groupPerception","result","hasPlayerOwner","perception","rollPerception","content","whisper","check","skipDialog","rank","undefined","dcByLevel","Map","set","dcAdjustments","adjustDCByRarity","rarity","adjustment","adjustDC","rarityToDCAdjustment","MAGIC_TRADITIONS","scrolls","scrollCompendiumIds","SKILL_DICTIONARY","acr","arc","ath","cra","dec","dip","itm","med","nat","occ","prf","rel","soc","ste","sur","thi","Identify","Application","items","constructor","getData","item","identified","isIdentified","checked","classes","uuid","bind","getItemFromEvent","toMessage","itemImg","unidentified","itemName","identifiedName","notMatchingTraditionModifier","dcs","proficiencyWithoutLevel","baseDC","max","calculateDC","traits","has","getDcRarity","isMagical","baseDc","occult","primal","divine","arcane","traditions","t","setHasElement","getMagicTraditions","identifyMagic","isAlchemical","identifyItem","shortForm","localize","renderTemplate","getMystifiedData","setFlag","preventDefault","parent","$","currentTarget","closest","attr","remove","identify","acc","filtered","packId","bookId","ripImaginarium","book","equipment","equipped","carryType","floor","pack","packs","spells","getIndex","fields","category","spell","random","_id","messageUUID","extraMessage","scroll","temp","scrollUUID","getScrollCompendiumUUID","location","heightenedLevel","temporary","sourceId","flags","core","description","chatUUID","createSpellScroll","speaker","getSpeaker","onPacketReceived","once","modules","getModule","api","macros","register","hint","Boolean","default","config","scope","onChange","callback"],"sourceRoot":""}