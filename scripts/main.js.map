{
  "version": 3,
  "sources": ["../src/macros/shared/esoteric.js", "../src/macros/esoteric.js", "../src/module.js", "../src/pf2e.js", "../src/apps/identify.js", "../src/macros/identify.js", "../src/macros/imaginarium.js", "../src/macros/marshal.js", "../src/macros/perception.js", "../src/macros/vulnerability.js", "../src/main.js"],
  "sourcesContent": ["export function getEsotericSkill(actor) {\r\n    const skillKeys = ['esoteric', 'esoteric-lore', 'lore-esoteric']\r\n    const skill = Object.values(actor.skills).find(x => skillKeys.includes(x.slug))\r\n\r\n    if (!skill) ui.notifications.warn(`This character doesn't have the 'Esoteric' skill`)\r\n    return skill\r\n}\r\n", "import { getEsotericSkill } from './shared/esoteric'\r\n\r\nexport function esotericCheck(event, actor) {\r\n    if (!actor || !actor.isOwner || !actor.isOfType('character')) {\r\n        ui.notifications.warn('You must select a character token you own.')\r\n        return\r\n    }\r\n\r\n    const skill = getEsotericSkill(actor)\r\n    if (!skill) return\r\n\r\n    const extraRollOptions = new Set()\r\n\r\n    const extraRollNotes = [\r\n        {\r\n            text: `Can be used to Recall Knowledge regarding haunts, curses \r\n    and creatures of any type, but can't be used to Recall Knowledge of other topics.`,\r\n        },\r\n    ]\r\n\r\n    skill.roll({\r\n        rollMode: 'blindroll',\r\n        extraRollNotes,\r\n        options: extraRollOptions,\r\n    })\r\n}\r\n", "export const MODULE_ID = 'idleuh'\r\n\r\nexport function getSetting(key) {\r\n    return game.settings.get(MODULE_ID, key)\r\n}\r\n\r\nexport function socketOn(callback) {\r\n    game.socket.on(`module.${MODULE_ID}`, callback)\r\n}\r\n\r\nexport function socketEmit(packet) {\r\n    game.socket.emit(`module.${MODULE_ID}`, packet)\r\n}\r\n\r\nexport function templatePath(...path) {\r\n    path = path.filter(x => typeof x === 'string')\r\n    return `modules/${MODULE_ID}/templates/${path.join('/')}`\r\n}\r\n\r\nexport function chatUUID(uuid, name) {\r\n    if (name) return `@UUID[${uuid}]{${name}}`\r\n    return `@UUID[${uuid}]`\r\n}\r\n\r\nfunction getItemSourceIdCondition(sourceId) {\r\n    return Array.isArray(sourceId) ? item => includesSourceId(item, sourceId) : item => getSourceId(item) === sourceId\r\n}\r\n\r\nexport function getItems(actor, itemTypes) {\r\n    return itemTypes ? itemTypes.flatMap(type => actor.itemTypes[type]) : actor.items\r\n}\r\n\r\nexport function findItemWithSourceId(actor, sourceId, itemTypes) {\r\n    return getItems(actor, itemTypes).find(getItemSourceIdCondition(sourceId))\r\n}\r\n\r\nexport function getSourceId(doc) {\r\n    return doc.getFlag('core', 'sourceId')\r\n}\r\n\r\nexport function includesSourceId(doc, list) {\r\n    const sourceId = getSourceId(doc)\r\n    return sourceId ? list.includes(sourceId) : false\r\n}\r\n\r\nexport function hasItemWithSourceId(actor, sourceId, itemTypes) {\r\n    return getItems(actor, itemTypes).some(getItemSourceIdCondition(sourceId))\r\n}\r\n", "import { chatUUID } from './module'\r\n\r\nconst MAGIC_TRADITIONS = new Set(['arcane', 'divine', 'occult', 'primal'])\r\n\r\nexport function getItemIdentificationDCs(item, { proficiencyWithoutLevel = false, notMatchingTraditionModifier }) {\r\n    const baseDC = calculateDC(item.level, { proficiencyWithoutLevel })\r\n    const rarity = getDcRarity(item)\r\n    const dc = adjustDCByRarity(baseDC, rarity)\r\n    if (item.isMagical) {\r\n        return getIdentifyMagicDCs(item, dc, notMatchingTraditionModifier)\r\n    } else if (item.isAlchemical) {\r\n        return { crafting: dc }\r\n    } else {\r\n        return { dc: dc }\r\n    }\r\n}\r\n\r\nfunction setHasElement(set, value) {\r\n    return set.has(value)\r\n}\r\n\r\nfunction getMagicTraditions(item) {\r\n    const traits = item.system.traits.value\r\n    return new Set(traits.filter(t => setHasElement(MAGIC_TRADITIONS, t)))\r\n}\r\n\r\nfunction getIdentifyMagicDCs(item, baseDC, notMatchingTraditionModifier) {\r\n    const result = {\r\n        occult: baseDC,\r\n        primal: baseDC,\r\n        divine: baseDC,\r\n        arcane: baseDC,\r\n    }\r\n    const traditions = getMagicTraditions(item)\r\n    for (const key of MAGIC_TRADITIONS) {\r\n        // once an item has a magic tradition, all skills\r\n        // that don't match the tradition are hard\r\n        if (traditions.size > 0 && !traditions.has(key)) {\r\n            result[key] = baseDC + notMatchingTraditionModifier\r\n        }\r\n    }\r\n    return { arcana: result.arcane, nature: result.primal, religion: result.divine, occultism: result.occult }\r\n}\r\n\r\nfunction getDcRarity(item) {\r\n    return item.traits.has('cursed') ? 'unique' : item.rarity\r\n}\r\n\r\nconst dcByLevel = new Map([\r\n    [-1, 13],\r\n    [0, 14],\r\n    [1, 15],\r\n    [2, 16],\r\n    [3, 18],\r\n    [4, 19],\r\n    [5, 20],\r\n    [6, 22],\r\n    [7, 23],\r\n    [8, 24],\r\n    [9, 26],\r\n    [10, 27],\r\n    [11, 28],\r\n    [12, 30],\r\n    [13, 31],\r\n    [14, 32],\r\n    [15, 34],\r\n    [16, 35],\r\n    [17, 36],\r\n    [18, 38],\r\n    [19, 39],\r\n    [20, 40],\r\n    [21, 42],\r\n    [22, 44],\r\n    [23, 46],\r\n    [24, 48],\r\n    [25, 50],\r\n])\r\n\r\nconst dcAdjustments = new Map([\r\n    ['incredibly-easy', -10],\r\n    ['very-easy', -5],\r\n    ['easy', -2],\r\n    ['normal', 0],\r\n    ['hard', 2],\r\n    ['very-hard', 5],\r\n    ['incredibly-hard', 10],\r\n])\r\n\r\nfunction rarityToDCAdjustment(rarity = 'common') {\r\n    switch (rarity) {\r\n        case 'uncommon':\r\n            return 'hard'\r\n        case 'rare':\r\n            return 'very-hard'\r\n        case 'unique':\r\n            return 'incredibly-hard'\r\n        default:\r\n            return 'normal'\r\n    }\r\n}\r\n\r\nfunction adjustDC(dc, adjustment = 'normal') {\r\n    return dc + (dcAdjustments.get(adjustment) ?? 0)\r\n}\r\n\r\nfunction adjustDCByRarity(dc, rarity = 'common') {\r\n    return adjustDC(dc, rarityToDCAdjustment(rarity))\r\n}\r\n\r\nfunction calculateDC(level, { proficiencyWithoutLevel, rarity = 'common' } = {}) {\r\n    const pwlSetting = game.settings.get('pf2e', 'proficiencyVariant')\r\n    proficiencyWithoutLevel ??= pwlSetting === 'ProficiencyWithoutLevel'\r\n\r\n    // assume level 0 if garbage comes in. We cast level to number because the backing data may actually have it\r\n    // stored as a string, which we can't catch at compile time\r\n    const dc = dcByLevel.get(level) ?? 14\r\n    if (proficiencyWithoutLevel) {\r\n        // -1 shouldn't be subtracted since it's just\r\n        // a creature level and not related to PC levels\r\n        return adjustDCByRarity(dc - Math.max(level, 0), rarity)\r\n    } else {\r\n        return adjustDCByRarity(dc, rarity)\r\n    }\r\n}\r\n\r\nconst scrollCompendiumIds = {\r\n    1: 'RjuupS9xyXDLgyIr', // Compendium.pf2e.equipment-srd.Item.RjuupS9xyXDLgyIr\r\n    2: 'Y7UD64foDbDMV9sx',\r\n    3: 'ZmefGBXGJF3CFDbn',\r\n    4: 'QSQZJ5BC3DeHv153',\r\n    5: 'tjLvRWklAylFhBHQ',\r\n    6: '4sGIy77COooxhQuC',\r\n    7: 'fomEZZ4MxVVK3uVu',\r\n    8: 'iPki3yuoucnj7bIt',\r\n    9: 'cFHomF3tty8Wi1e5',\r\n    10: 'o1XIHJ4MJyroAHfF',\r\n}\r\n\r\nfunction getScrollCompendiumUUID(level) {\r\n    return `Compendium.pf2e.equipment-srd.Item.${scrollCompendiumIds[level]}`\r\n}\r\n\r\nconst scrolls = []\r\nexport async function createSpellScroll(uuid, level, temp = false) {\r\n    const spell = (await fromUuid(uuid))?.toObject()\r\n    if (!spell) return null\r\n\r\n    if (level === false) level = spell.system.level.value\r\n\r\n    const scrollUUID = getScrollCompendiumUUID(level)\r\n    scrolls[level] ??= await fromUuid(scrollUUID)\r\n\r\n    const scroll = scrolls[level]?.toObject()\r\n    if (!scroll) return null\r\n\r\n    spell.system.location.heightenedLevel = level\r\n\r\n    scroll.name = `Scroll of ${spell.name} (Level ${level})`\r\n    scroll.system.temporary = temp\r\n    scroll.system.spell = spell\r\n    scroll.system.traits.value.push(...spell.system.traditions.value)\r\n\r\n    const sourceId = spell.flags.core?.sourceId\r\n    if (sourceId) scroll.system.description.value = `${chatUUID(sourceId)}\\n<hr />${scroll.system.description.value}`\r\n\r\n    return scroll\r\n}\r\n\r\nexport function getDcByLevel(actor) {\r\n    const level = Math.clamped(actor.level, -1, 25)\r\n    return dcByLevel.get(level)\r\n}\r\n", "import { templatePath } from '../module'\r\nimport { getItemIdentificationDCs } from '../pf2e'\r\n\r\nexport class Identify extends Application {\r\n    constructor(items, options) {\r\n        super(options)\r\n        this.items = items\r\n    }\r\n\r\n    static get defaultOptions() {\r\n        return mergeObject(super.defaultOptions, {\r\n            id: 'idleuh-identify',\r\n            title: 'Identify Items',\r\n            template: templatePath('identify.html'),\r\n            width: 500,\r\n        })\r\n    }\r\n\r\n    getData(options) {\r\n        return mergeObject(super.getData(options), {\r\n            items: this.items.map(item => {\r\n                const data = item.system.identification.identified\r\n                const identified = item.isIdentified\r\n                const checked = !identified && item.getFlag('world', 'identify.checked')\r\n\r\n                const classes = []\r\n                if (identified) classes.push('identified')\r\n                if (checked) classes.push('checked')\r\n\r\n                return {\r\n                    uuid: item.uuid,\r\n                    img: data.img,\r\n                    name: item.isOfType('treasure') ? `($) ${data.name}` : data.name,\r\n                    css: classes.join(' '),\r\n                    identified,\r\n                    checked,\r\n                }\r\n            }),\r\n        })\r\n    }\r\n\r\n    activateListeners(html) {\r\n        html.find('[data-action=\"chat\"]').on('click', this.#onChat.bind(this))\r\n        html.find('[data-action=\"checks\"]').on('click', this.#onChecks.bind(this))\r\n        html.find('[data-action=\"identify\"]').on('click', this.#onIdentify.bind(this))\r\n        html.find('[data-action=\"remove\"]').on('click', this.#onRemove.bind(this))\r\n        html.find('[data-action=\"reset\"]').on('click', this.#onReset.bind(this))\r\n    }\r\n\r\n    async #onChat(event) {\r\n        const item = await getItemFromEvent(event)\r\n        item?.toMessage(undefined, { create: true })\r\n    }\r\n\r\n    async #onChecks(event) {\r\n        const item = await getItemFromEvent(event)\r\n        if (!item) return\r\n\r\n        const itemImg = item.system.identification.unidentified.img\r\n        const itemName = item.system.identification.unidentified.name\r\n        const identifiedName = item.system.identification.identified.name\r\n\r\n        const notMatchingTraditionModifier = game.settings.get('pf2e', 'identifyMagicNotMatchingTraditionModifier')\r\n        const proficiencyWithoutLevel = game.settings.get('pf2e', 'proficiencyVariant') === 'ProficiencyWithoutLevel'\r\n        const dcs = getItemIdentificationDCs(item, { proficiencyWithoutLevel, notMatchingTraditionModifier })\r\n\r\n        const skills = Object.entries(dcs).map(([slug, dc]) => {\r\n            slug = slug === 'dc' ? 'crafting' : slug\r\n            const name = game.i18n.localize(CONFIG.PF2E.skillList[slug])\r\n            return { slug, name, dc }\r\n        })\r\n\r\n        const actionOption = item.isMagical ? 'action:identify-magic' : item.isAlchemical ? 'action:identify-alchemy' : null\r\n\r\n        const content = await renderTemplate('systems/pf2e/templates/actors/identify-item-chat-skill-checks.hbs', {\r\n            itemImg,\r\n            itemName,\r\n            identifiedName,\r\n            rollOptions: ['concentrate', 'exploration', 'secret', actionOption].filter(Boolean),\r\n            skills,\r\n        })\r\n\r\n        await CONFIG.ChatMessage.documentClass.create({ user: game.user.id, content })\r\n    }\r\n\r\n    async #onIdentify(event) {\r\n        const item = await getItemFromEvent(event)\r\n        if (!item) return\r\n        await item.setIdentificationStatus(item.isIdentified ? 'unidentified' : 'identified')\r\n        this.render()\r\n    }\r\n\r\n    async #onRemove(event) {\r\n        const item = await getItemFromEvent(event)\r\n        if (!item) return\r\n\r\n        const checked = item.getFlag('world', 'identify.checked')\r\n        await item.setFlag('world', 'identify.checked', !checked)\r\n\r\n        this.render()\r\n    }\r\n\r\n    async #onReset(event) {\r\n        event.preventDefault()\r\n\r\n        for (const item of this.items) {\r\n            if (item.isIdentified || !item.getFlag('world', 'identify.checked')) continue\r\n            await item.setFlag('world', 'identify.checked', false)\r\n        }\r\n\r\n        this.render()\r\n    }\r\n}\r\n\r\nasync function getItemFromEvent(event) {\r\n    const parent = $(event.currentTarget).closest('[data-item]')\r\n    const uuid = parent.attr('data-item')\r\n    const item = await fromUuid(uuid)\r\n    if (!item) parent.remove()\r\n    return item\r\n}\r\n", "import { Identify } from '../apps/identify'\r\n\r\nexport function identify() {\r\n    if (!game.user.isGM) {\r\n        ui.notifications.warn('You not the GM yo!')\r\n        return\r\n    }\r\n\r\n    const actors = game.actors\r\n    const items = actors.reduce((acc, actor) => {\r\n        if (!actor.hasPlayerOwner) return acc\r\n        const filtered = actor.items.filter(item => item.isOfType('physical') && !item.isIdentified)\r\n        acc.push(...filtered)\r\n        return acc\r\n    }, [])\r\n\r\n    new Identify(items).render(true)\r\n}\r\n", "import { createSpellScroll } from '../pf2e'\r\n\r\nconst packId = 'pf2e.spells-srd'\r\nconst bookId = 'Item.dcALVAyJbYSovzqt'\r\n\r\nexport async function ripImaginarium(actor) {\r\n    if (!actor) return ui.notifications.warn('You must select an actor with the Imaginarium')\r\n\r\n    const book = actor.itemTypes.equipment.find(x => x.getFlag('core', 'sourceId') === bookId)\r\n    if (!book || book.system.equipped.carryType === 'dropped')\r\n        return ui.notifications.warn(\"This actor doesn't have the Imaginarium in their possession\")\r\n\r\n    const level = Math.floor(actor.level / 2) || 1\r\n    const pack = game.packs.get(packId)\r\n    const index = await pack.getIndex({ fields: ['system.level.value', 'system.traits', 'system.category.value'] })\r\n\r\n    const spells = index.filter(\r\n        x =>\r\n            x.system.level.value <= level &&\r\n            !x.system.traits.value.includes('cantrip') &&\r\n            x.system.category.value !== 'ritual' &&\r\n            x.system.category.value !== 'focus' &&\r\n            x.system.traits.rarity === 'common'\r\n    )\r\n\r\n    const roll = Math.floor(Math.random() * spells.length)\r\n    const spell = spells[roll]\r\n    const uuid = `Compendium.${packId}.${spell._id}`\r\n\r\n    let messageUUID = uuid\r\n    let extraMessage = ''\r\n    const scroll = await createSpellScroll(uuid, level)\r\n    if (scroll) {\r\n        scroll.name = scroll.name + ' *'\r\n        const [item] = await actor.createEmbeddedDocuments('Item', [scroll])\r\n        extraMessage = ' and received the following:'\r\n        messageUUID = item.uuid\r\n    }\r\n\r\n    ChatMessage.create({\r\n        content: `<p>Ripped the last page of the Imaginarium${extraMessage}</p><p>@UUID[${messageUUID}]</p>`,\r\n        speaker: ChatMessage.getSpeaker({ actor: actor }),\r\n    })\r\n}\r\n", "import { findItemWithSourceId } from '../module'\r\nimport { getDcByLevel } from '../pf2e'\r\n\r\nconst effectUUID = 'Compendium.idleuh.effects.Item.jjFsfolNR04KzPVh'\r\nconst featUUID = 'Compendium.idleuh.feats.Item.X3SZ0gTpBkGw3UGX'\r\nconst debuffUUID = 'Compendium.idleuh.effects.Item.r0hicuQPY0OEAC6g'\r\n\r\nexport async function marshalInspiration(event, actor) {\r\n    if (!actor || !actor.isOwner || !actor.isOfType('character')) {\r\n        ui.notifications.warn('You must select a character token you own.')\r\n        return\r\n    }\r\n\r\n    if (!findItemWithSourceId(actor, featUUID, ['feat'])) {\r\n        ui.notifications.warn(\"This character doesn't have <strong>Inspiring Marshal Stance</strong> feat.\")\r\n        return\r\n    }\r\n\r\n    if (findItemWithSourceId(actor, debuffUUID, ['effect'])) {\r\n        ui.notifications.warn('This character cannot enter <strong>Inspiring Marshal Stance</strong>.')\r\n        return\r\n    }\r\n\r\n    const dc = getDcByLevel(actor)\r\n\r\n    const roll = await actor.skills.diplomacy.roll({\r\n        dc: { value: dc },\r\n        rollMode: 'roll',\r\n        label: '<span class=\"pf2-icon\">A</span> <b>Marshal Inspiration</b> <span>(Diplomacy Check)</span>',\r\n        extraRollNotes: [\r\n            {\r\n                outcome: ['criticalFailure'],\r\n                text: `<strong>Critical Failure</strong> You fail to enter the stance and can't take this action again for 1 minute.`,\r\n            },\r\n            {\r\n                outcome: ['failure'],\r\n                text: `<strong>Failure</strong> You fail to enter the stance.`,\r\n            },\r\n            {\r\n                outcome: ['success'],\r\n                text: `<strong>Success</strong> Your marshal's aura grants you and allies a +1 status bonus to attack rolls and saves against mental effects.`,\r\n            },\r\n            {\r\n                outcome: ['criticalSuccess'],\r\n                text: `<strong>Critical Success</strong> Your marshal's aura increases to a 20ft. emanation and grants you and allies a +1 status bonus to attack rolls and saves against mental effects.`,\r\n            },\r\n        ],\r\n    })\r\n\r\n    const success = roll.degreeOfSuccess\r\n\r\n    if (success >= 2) {\r\n        await setEffect(actor, success)\r\n    } else {\r\n        await (await getEffect(actor))?.delete()\r\n        if (success === 0) await setDebuff(actor)\r\n    }\r\n}\r\n\r\nasync function setDebuff(actor) {\r\n    const effect = await fromUuid(debuffUUID)\r\n    if (!effect) return\r\n    await actor.createEmbeddedDocuments('Item', [effect.toObject()])\r\n}\r\n\r\nasync function setEffect(actor, success) {\r\n    const radius = success === 3 ? 20 : 10\r\n    const existing = await getEffect(actor)\r\n\r\n    if (existing) {\r\n        const rules = deepClone(existing._source.system.rules)\r\n        const rule = rules.find(rule => rule.key === 'ChoiceSet')\r\n        if (rule.selection === radius) return\r\n\r\n        rule.selection = radius\r\n        existing.update({ 'system.rules': rules })\r\n        return\r\n    }\r\n\r\n    const effect = await fromUuid(effectUUID)\r\n    if (!effect) return\r\n\r\n    const source = effect.toObject()\r\n    const rule = source.system.rules.find(rule => rule.key === 'ChoiceSet')\r\n\r\n    rule.selection = radius\r\n    await actor.createEmbeddedDocuments('Item', [source])\r\n}\r\n\r\nasync function getEffect(actor) {\r\n    return findItemWithSourceId(actor, effectUUID, ['effect'])\r\n}\r\n", "const proficiency = ['trained', 'expert', 'master', 'legendary', 'untrained']\r\n\r\nexport async function groupPerception() {\r\n    if (!game.user.isGM) {\r\n        ui.notifications.warn('You not the GM yo!')\r\n        return\r\n    }\r\n\r\n    let result = '<hr>'\r\n\r\n    const tokens = canvas.tokens\r\n    for (const token of tokens.placeables) {\r\n        const actor = token.actor\r\n        if (!actor || !actor.isOfType('character', 'npc') || !actor.hasPlayerOwner || !actor.attributes.perception) continue\r\n        result += await rollPerception(actor)\r\n    }\r\n\r\n    ChatMessage.create({ content: result, flavor: 'Group Perception Checks', whisper: [game.user.id] })\r\n}\r\n\r\nasync function rollPerception(actor) {\r\n    const perception = actor.attributes.perception\r\n    const check = new game.pf2e.CheckModifier('', perception)\r\n    const roll = await game.pf2e.Check.roll(check, { actor: actor, type: 'skill-check', createMessage: false, skipDialog: true })\r\n    if (!roll) return ''\r\n\r\n    const rank = proficiency[(perception.rank ?? 1) - 1]\r\n    const die = roll.dice[0].total\r\n    if (die === undefined) return ''\r\n\r\n    let result = `<div style=\"display:flex;justify-content:space-between;\" title=\"${roll.result}\">`\r\n    result += `<span>${actor.name} (${rank})</span><span`\r\n    if (die == 20) result += ' style=\"color: green;\"'\r\n    else if (die == 1) result += ' style=\"color: red;\"'\r\n\r\n    return `${result}>${roll.total}</span></div>`\r\n}\r\n", "import { findItemWithSourceId, hasItemWithSourceId, socketEmit } from '../module'\r\nimport { getDcByLevel } from '../pf2e'\r\nimport { getEsotericSkill } from './shared/esoteric'\r\n\r\nconst effectUUID = 'Compendium.idleuh.effects.Item.MqgbuaqGMJ92VRze'\r\nconst targetUUID = 'Compendium.idleuh.effects.Item.Lz5hNf4dbXKjDWBa'\r\nconst mortalUUID = 'Compendium.idleuh.effects.Item.8BxBB5ztfRI9vFfZ'\r\nconst ffUUID = 'Compendium.pf2e.conditionitems.Item.AJh5ex99aV6VTggg'\r\n\r\nexport async function exploitVulnerability(event, actor, filterTypes) {\r\n    if (event.ctrlKey) {\r\n        if (game.user.isGM) cleanExploitVulnerabilityGM()\r\n        else socketEmit({ type: 'clean-exploit-vulnerability' })\r\n        ui.notifications.notify('All effects are being removed.')\r\n        return\r\n    }\r\n\r\n    const targets = game.user.targets\r\n    const [target] = targets\r\n    const targetActor = target?.actor\r\n\r\n    if (\r\n        !actor ||\r\n        !actor.isOwner ||\r\n        !actor.isOfType('character') ||\r\n        targets.size !== 1 ||\r\n        !targetActor ||\r\n        !targetActor.isOfType('creature')\r\n    ) {\r\n        ui.notifications.warn('You must select a character token you own and target another one.')\r\n        return\r\n    }\r\n\r\n    const skill = getEsotericSkill(actor)\r\n    if (!skill) return\r\n\r\n    const actionSlug = 'action:recall-knowledge'\r\n    const dc = getDcByLevel(targetActor)\r\n\r\n    const extraRollOptions = actor.getRollOptions(['all', 'skill-check', 'Esoteric'])\r\n    extraRollOptions.push(actionSlug)\r\n    extraRollOptions.push(`secret`)\r\n\r\n    const dv = targetActor.system.attributes.weaknesses\r\n    const vulnerability = dv.reduce((prev, curr) => {\r\n        if (curr.value > prev) return curr.value\r\n        return prev\r\n    }, 0)\r\n\r\n    const weaknesses = dv.filter(x => x.value === vulnerability).map(x => x.type)\r\n\r\n    const joinedWeaknessess = weaknesses.join(', ')\r\n\r\n    const roll = await skill.roll({\r\n        extraRollOptions,\r\n        dc: { value: dc },\r\n        rollMode: 'roll',\r\n        label: `<span class=\"pf2-icon\">A</span> <b>Exploit Vulnerability</b> <span\">(Esoteric Check)</span>`,\r\n        extraRollNotes: [\r\n            {\r\n                outcome: ['criticalFailure'],\r\n                text: `<strong>Critical Failure</strong> You couldn't remember the right object to use and become distracted while you rummage through your esoterica. You become flat-footed until the beginning of your next turn.`,\r\n            },\r\n            {\r\n                outcome: ['failure'],\r\n                text: `<strong>Failure</strong> Failing to recall a salient weakness about the creature, you instead attempt to exploit a more personal vulnerability. You can exploit only the creature's personal antithesis. Your unarmed and weapon Strikes against the creature also become magical if they weren't already.`,\r\n            },\r\n            {\r\n                outcome: ['success'],\r\n                text: `<strong>[ ${joinedWeaknessess} ]</strong> = ${vulnerability}<br><strong>Success</strong> You recall an important fact about the creature, learning its highest weakness (or one of its highest weaknesses, if it has multiple with the same value) but not its other weaknesses, resistances, or immunities. You can exploit either the creature's mortal weakness or personal antithesis. Your unarmed and weapon Strikes against the creature also become magical if they weren't already.`,\r\n            },\r\n            {\r\n                outcome: ['criticalSuccess'],\r\n                text: `<strong>[ ${joinedWeaknessess} ]</strong> = ${vulnerability}<br><strong>Critical Success</strong> You remember the creature's weaknesses, and as you empower your esoterica, you have a flash of insight that grants even more knowledge about the creature. You learn all of the creature's resistances, weaknesses, and immunities, including the amounts of the resistances and weaknesses and any unusual weaknesses or vulnerabilities, such as what spells will pass through a golem's antimagic. You can exploit either the creature's mortal weakness or personal antithesis (see the Exploit Vulnerability class feature). Your unarmed and weapon Strikes against the creature also become magical if they weren't already.`,\r\n            },\r\n        ],\r\n    })\r\n\r\n    const success = roll.degreeOfSuccess\r\n\r\n    const effect = findItemWithSourceId(actor, effectUUID, ['effect'])\r\n    if (success >= 1 && !effect) {\r\n        const data = (await fromUuid(effectUUID)).toObject()\r\n        actor.createEmbeddedDocuments('Item', [data])\r\n    } else if (success < 1) {\r\n        effect?.delete()\r\n        const flatEffect = hasItemWithSourceId(actor, ffUUID, ['condition'])\r\n        if (!flatEffect) {\r\n            const data = (await fromUuid(ffUUID)).toObject()\r\n            actor.createEmbeddedDocuments('Item', [data])\r\n        }\r\n    }\r\n\r\n    const filteredWeaknesses = weaknesses.filter(x => !filterTypes.includes(x))\r\n\r\n    const packet = {\r\n        type: 'exploit-vulnerability',\r\n        actorId: actor.id,\r\n        targetId: target.id,\r\n        vulnerability: filteredWeaknesses.length ? vulnerability : 0,\r\n        success,\r\n    }\r\n\r\n    if (game.user.isGM) exploitVulnerabilityGM(packet)\r\n    else socketEmit(packet)\r\n}\r\n\r\nexport async function exploitVulnerabilityGM({ actorId, targetId, vulnerability, success }) {\r\n    const actor = game.actors.get(actorId)\r\n    const targetActor = canvas.tokens.get(targetId)?.actor\r\n    if (!actor || !targetActor) return\r\n\r\n    const personal = 2 + Math.floor(actor.level / 2)\r\n    const isMortal = success > 1 && vulnerability >= personal\r\n\r\n    const mortalData = (await fromUuid(mortalUUID)).toObject()\r\n    const rule = {\r\n        key: 'Weakness',\r\n        type: 'piercing',\r\n        value: vulnerability,\r\n        predicate: ['origin:effect:exploit-vulnerability'],\r\n    }\r\n    mortalData.system.rules.push(rule)\r\n\r\n    for (const token of canvas.tokens.placeables) {\r\n        const tokenActor = token.actor\r\n        if (!tokenActor || tokenActor === actor) continue\r\n\r\n        const targetEffect = findItemWithSourceId(tokenActor, targetUUID, ['effect'])\r\n        const mortalsEffect = findItemWithSourceId(tokenActor, mortalUUID, ['effect'])\r\n\r\n        await targetEffect?.delete()\r\n        await mortalsEffect?.delete()\r\n\r\n        if (success < 1) continue\r\n\r\n        if (tokenActor === targetActor) {\r\n            const data = (await fromUuid(targetUUID)).toObject()\r\n            const rule = {\r\n                key: 'Weakness',\r\n                type: 'piercing',\r\n                value: isMortal ? vulnerability : personal,\r\n                predicate: ['origin:effect:exploit-vulnerability'],\r\n            }\r\n            data.system.rules.push(rule)\r\n            tokenActor.createEmbeddedDocuments('Item', [data])\r\n        } else if (isMortal && tokenActor.id === targetActor.id) {\r\n            tokenActor.createEmbeddedDocuments('Item', [mortalData])\r\n        }\r\n    }\r\n}\r\n\r\nexport function cleanExploitVulnerabilityGM() {\r\n    for (const token of canvas.tokens.placeables) {\r\n        const tokenActor = token.actor\r\n        if (!tokenActor) continue\r\n\r\n        const effect = findItemWithSourceId(tokenActor, effectUUID, ['effect'])\r\n        const targetEffect = findItemWithSourceId(tokenActor, targetUUID, ['effect'])\r\n        const mortalsEffect = findItemWithSourceId(tokenActor, mortalUUID, ['effect'])\r\n\r\n        effect?.delete()\r\n        targetEffect?.delete()\r\n        mortalsEffect?.delete()\r\n    }\r\n}\r\n", "import { esotericCheck } from './macros/esoteric'\r\nimport { identify } from './macros/identify'\r\nimport { ripImaginarium } from './macros/imaginarium'\r\nimport { marshalInspiration } from './macros/marshal'\r\nimport { groupPerception } from './macros/perception'\r\nimport { cleanExploitVulnerabilityGM, exploitVulnerability, exploitVulnerabilityGM } from './macros/vulnerability'\r\nimport { MODULE_ID, getSetting, socketOn } from './module'\r\n\r\nHooks.once('init', () => {\r\n    game.modules.get(MODULE_ID).api = {\r\n        macros: {\r\n            exploitVulnerability,\r\n            esotericCheck,\r\n            groupPerception,\r\n            identify,\r\n            ripImaginarium,\r\n            marshalInspiration,\r\n        },\r\n    }\r\n\r\n    game.settings.register(MODULE_ID, 'jquery', {\r\n        name: 'Disable JQuery Animations',\r\n        hint: 'Will cancel sliding animations on different parts of the UI.',\r\n        type: Boolean,\r\n        default: false,\r\n        config: true,\r\n        scope: 'client',\r\n        onChange: setJQueryFx,\r\n    })\r\n})\r\n\r\nHooks.once('ready', () => {\r\n    if (game.user.isGM) {\r\n        socketOn(onPacketReceived)\r\n    }\r\n\r\n    if (getSetting('jquery')) setJQueryFx(true)\r\n})\r\n\r\nfunction setJQueryFx(disabled) {\r\n    jQuery.fx.off = disabled\r\n}\r\n\r\nfunction onPacketReceived(packet) {\r\n    if (packet.type === 'exploit-vulnerability') exploitVulnerabilityGM(packet)\r\n    else if (packet.type === 'clean-exploit-vulnerability') cleanExploitVulnerabilityGM()\r\n}\r\n"],
  "mappings": "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",
  "names": ["rule", "effectUUID", "rule"]
}
